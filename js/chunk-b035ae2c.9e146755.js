(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b035ae2c"],{a87f:function(e,t,a){},cfc7:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContent",[a("layContentHeader",{attrs:{title:"资源权限管理",buttons:e.headerBtns}}),a("v-layout",[a("layContentLeft",{attrs:{title:"角色"}},[a("v-card",{staticClass:"d-inline-block elevation-3"},[a("v-navigation-drawer",{attrs:{permanent:""}},[a("v-list",e._l(e.rolelist,(function(t){return a("v-list-tile",{key:t.id,on:{click:function(a){return e.rolelistselected(t)}}},[a("v-list-tile-content",[a("v-list-tile-title",{class:e.selectColor[t.id],domProps:{textContent:e._s(t.rname)}})],1)],1)})),1)],1)],1)],1),a("layContentRight",[a("v-container",e._l(e.rows,(function(t){return a("v-card",{key:t.id,staticClass:"authoriCard",attrs:{dark:"",color:"#546E7A"}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{staticClass:"align-center ",staticStyle:{"border-right":"1px solid #eee"},attrs:{"d-flex":"",xs2:""}},[a("v-checkbox",{staticStyle:{"margin-left":"5px"},attrs:{label:t.rChineseName,indeterminate:e.partIndeterminates[t.id],readonly:e.ckeckBoxReadonly},on:{change:e.selectRowChange},model:{value:e.selectRow[t.id],callback:function(a){e.$set(e.selectRow,t.id,a)},expression:"selectRow[row.id]"}})],1),a("v-flex",{staticClass:"align-center ",staticStyle:{"margin-left":"30px"},attrs:{"d-flex":""}},e._l(e.dataDicts,(function(i){return a("div",{key:t.id+" "+i.dvalue},[a("v-checkbox",{attrs:{label:i.dname,readonly:e.ckeckBoxReadonly},on:{change:e.selectDataDictChange},model:{value:e.selectDataDict[t.id+" "+i.dvalue],callback:function(a){e.$set(e.selectDataDict,t.id+" "+i.dvalue,a)},expression:"selectDataDict[row.id+' '+dataDict.dvalue]"}})],1)})),0)],1)],1)})),1)],1)],1)],1),a("contentModal",{attrs:{title:e.ModalTittle,IsShow:e.IsShow},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[a("v-container",[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-text-field",{attrs:{label:"角色名称",disabled:e.cannotEdit,"prepend-inner-icon":"star",rules:[e.rules.required]},model:{value:e.editItem.rname,callback:function(t){e.$set(e.editItem,"rname",t)},expression:"editItem.rname"}}),a("v-text-field",{attrs:{label:"角色描述",disabled:e.cannotEdit},model:{value:e.editItem.description,callback:function(t){e.$set(e.editItem,"description",t)},expression:"editItem.description"}}),a("v-radio-group",{attrs:{label:"是否为管理员",row:"",disabled:e.cannotEdit},model:{value:e.editItem.isAdministrative,callback:function(t){e.$set(e.editItem,"isAdministrative",t)},expression:"editItem.isAdministrative"}},[a("v-radio",{attrs:{label:"是",value:"1"}}),a("v-radio",{attrs:{label:"否",value:"0"}})],1)],1)],1)],1),a("comfirmModal",{attrs:{title:"提示",IsShow:e.IsComfirmShow,text:"是否确定删除所选角色？"},on:{modalComfirmedClose:function(t){return e.modalCancel()},modalComfirmed:function(t){return e.deleteConfirm()}}})],1)},n=[],r=(a("4634"),a("e6d1"),a("7300")),o=a("5873"),l=a("ddf2"),s=a("80ea"),c=a("ae0a"),d=a("97a3"),u=a("652a"),f=a("1269"),m=new u["a"],h=function(e){function t(){var e,a;Object(r["a"])(this,t);for(var i=arguments.length,n=new Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=Object(o["a"])(this,(e=Object(l["a"])(t)).call.apply(e,[this].concat(n))),Object(d["a"])(Object(s["a"])(a),"__name","Resources"),Object(d["a"])(Object(s["a"])(a),"id",m.charField({require:!0,fieldName:"id"})),Object(d["a"])(Object(s["a"])(a),"rChineseName",m.charField({require:!0,fieldName:"中文名"})),Object(d["a"])(Object(s["a"])(a),"rEnglishName",m.charField({require:!0,fieldName:"英文名"})),a}return Object(c["a"])(t,e),t}(f["a"]),v=a("6722"),I=a("a7fe"),w=new u["a"],b=function(e){function t(){var e,a;Object(r["a"])(this,t);for(var i=arguments.length,n=new Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=Object(o["a"])(this,(e=Object(l["a"])(t)).call.apply(e,[this].concat(n))),Object(d["a"])(Object(s["a"])(a),"__name","RoleResources"),Object(d["a"])(Object(s["a"])(a),"id",w.charField({require:!0,fieldName:"id"})),Object(d["a"])(Object(s["a"])(a),"resourcesId",w.charField({require:!0,fieldName:"资源id"})),Object(d["a"])(Object(s["a"])(a),"RoleId",w.charField({require:!0,fieldName:"角色id"})),Object(d["a"])(Object(s["a"])(a),"value",w.charField({require:!0,fieldName:"类型"})),a}return Object(c["a"])(t,e),t}(f["a"]),p=a("8333"),C=a("d5b3"),D=a("a2a7"),y=a("23f5"),g=a("1e17"),O=a("07c5"),x=a("8907"),S=a("adf0"),k=new p["a"](new h),M=new p["a"](new I["a"]),j=new p["a"](new v["a"]),R=new p["a"](new b),N={data:function(){var e=this;return{selectColor:{},headerBtns:[{disabled:!1,text:"添加",click:function(){return e.showAddWindow()}},{disabled:!1,text:"编辑",click:function(){return e.showEditWindow()}},{disabled:!1,text:"删除",click:function(){return e.del()}},{disabled:!1,text:"保存",click:function(){return e.save()}}],valid:!0,rules:{required:function(e){return!!e||"必填项"}},ckeckBoxReadonly:!1,indeterminates:{},selectDataDict:{},rolelist:[],ModalTittle:"",IsShow:!1,IsComfirmShow:!1,cannotEdit:!1,IsUpdate:!1,editItem:{},temporary:{},rows:[],selectPermisions:[],permissions:[],selectRow:{},partIndeterminates:{},dataDicts:[],countModel:{},count2Model:{}}},components:{contentModal:D["a"],comfirmModal:y["a"],layContent:g["a"],layContentHeader:O["a"],layContentLeft:x["a"],layContentRight:S["a"]},mounted:function(){this.initialize()},watch:{},computed:{},methods:{selectDataDictChange:function(){var e=this,t=e.rows,a=e.selectDataDict;e.partIndeterminates={},e.countModel={};var i=function(i){var n=i.split(" ")[0];t.forEach((function(t){t.id===n&&a[i]&&(void 0===e.countModel[n]?(e.countModel[n]=1,e.partIndeterminates[n]=!0):(e.countModel[n]=parseInt(e.countModel[n])+1,e.countModel[n]%4===0?(e.selectRow[n]=!0,e.partIndeterminates[n]=!1):(e.partIndeterminates[n]=!0,e.selectRow[n]=!1)))}))};for(var n in a)i(n)},selectRowChange:function(){var e=this,t=e.dataDicts,a=e.selectRow;e.count2Model={};var i=function(i){var n=i.split(" ")[0];a[i]?(e.partIndeterminates[n]=!1,t.forEach((function(t){e.selectDataDict[i+" "+t.dvalue]=!0}))):t.forEach((function(a){e.selectDataDict[i+" "+a.dvalue]&&(void 0===e.count2Model[n]?e.count2Model[n]=1:(e.count2Model[n]=parseInt(e.count2Model[n])+1,e.count2Model[n]%4===0?t.forEach((function(t){e.selectDataDict[i+" "+t.dvalue]=!1,e.partIndeterminates[n]=!1})):e.partIndeterminates[n]=!0))}))};for(var n in a)i(n);e.selectDataDictChange()},init:function(){var e=this;e.$Server.queryAll(j.getModelName()).then((function(t){e.rolelist=t.datas}),(function(e){return C["a"].alert(e)}))},initialize:function(){var e=this;e.$Server.queryAll(j.getModelName()).then((function(t){e.rolelist=t.datas}),(function(e){return C["a"].alert(e)})),e.$Server.queryAll(k.getModelName()).then((function(t){e.rows=t.datas,e.$Server.queryAll(M.getModelName(),null,{dname:"资源权限"}).then((function(t){e.dataDicts=t.datas,e.rows.forEach((function(t){e.selectRow[t.id]=!1,e.dataDicts.forEach((function(a){e.selectDataDict[t.id+" "+a.dvalue]=!1}))}))}),(function(e){return C["a"].alert(e)}))}),(function(e){return C["a"].alert(e)}))},rolelistselected:function(e){var t=this;this.selectColor={},this.selectColor[e.id]="blue--text",this.editItem=JSON.parse(JSON.stringify(e));var a=this.editItem.resourceList;t.rows.forEach((function(e){t.selectRow[e.id]=!1,t.dataDicts.forEach((function(a){t.selectDataDict[e.id+" "+a.dvalue]=!1}))})),t.partIndeterminates={},this.ckeckBoxReadonly=e.administrative,a.forEach((function(e){"1111"===e.value?t.selectRow[e.resourceId]=!0:"0000"===e.value?t.partIndeterminates[e.resourceId]=!1:(t.selectRow[e.resourceId]=!1,t.partIndeterminates[e.resourceId]=!0),t.dataDicts.forEach((function(a,i){"1"===e.value.substring(i,i+1)?t.selectDataDict[e.resourceId+" "+a.dvalue]=!0:t.selectDataDict[e.resourceId+" "+a.dvalue]=!1}))}))},showAddWindow:function(){this.ModalTittle="添加角色",this.cannotEdit=!1,this.IsUpdate=!1,this.editItem={},this.editItem.isAdministrative="0",this.IsShow=!0},modalClosed:function(){this.IsShow=!1,this.editItem=this.temporary},modalComfirmed:function(){if(this.$refs.form.validate()){this.editItem.isAdministrative="1"==this.editItem.isAdministrative;var e=this;this.$Server.addOrUpdate(j.getModelName(),e.editItem,e.IsUpdate).then((function(t){t.success&&(e.IsShow=!1,e.init())}),(function(e){return C["a"].alert(e)}))}},showEditWindow:function(){"{}"!=JSON.stringify(this.editItem)?(this.ModalTittle="编辑角色",this.cannotEdit=!1,this.IsUpdate=!0,this.editItem.isAdministrative=this.editItem.isAdministrative?"1":"0",this.IsShow=!0):C["a"].alert("请选择一个角色")},del:function(){"{}"!=JSON.stringify(this.editItem)?this.IsComfirmShow=!0:C["a"].alert("请选择一个角色")},modalCancel:function(){this.IsComfirmShow=!1},deleteConfirm:function(){var e=this;"{}"!=JSON.stringify(this.editItem)&&this.$Server.delete(j.getModelName(),e.editItem).then((function(t){t.success&&(e.IsComfirmShow=!1,e.initialize())}),(function(e){return C["a"].alert(e)}))},toTree:function(e,t){for(var a,i=this,n=[],r=0;r<e.length;r++)if(e[r].parentId==t){var o=e[r];a=i.toTree(e,e[r].id),a.length>0&&(o.children=a),n.push(o)}return n},save:function(){var e=this;"{}"!=JSON.stringify(this.editItem)?this.editItem.isAdministrative?C["a"].alert("管理员拥有全部权限，无需修改"):function(){var t=[],a=e,i=e.selectDataDict,n=e.selectRow;for(var r in n){var o={};o.roleId=a.editItem.id,o.resourceId=r,o.value="",t.push(o)}var l=function(e){var a=e.split(" ")[0];t.forEach((function(t){t.resourceId===a&&(i[e]?t.value=t.value+"1":t.value=t.value+"0")}))};for(var s in i)l(s);e.$Server.batchSave(R.getModelName(),t).then((function(e){e.success&&(C["a"].alert("修改成功","success"),a.init())}),(function(e){return C["a"].alert(e)}))}():C["a"].alert("请选择一个角色")}}},E=N,A=(a("f576"),a("6691")),$=Object(A["a"])(E,i,n,!1,null,"2a29e9e6",null);t["default"]=$.exports},f576:function(e,t,a){"use strict";var i=a("a87f"),n=a.n(i);n.a}}]);