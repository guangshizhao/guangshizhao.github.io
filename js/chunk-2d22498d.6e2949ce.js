(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22498d"],{e18c:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("layContentHeader",{attrs:{title:"来往单位管理",buttons:e.headerBtns}},[i("v-text-field",{attrs:{label:"输入单位名称或类型","hide-details":"","single-line":"",small:"",clearable:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[i("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1),i("layContent",[i("gridTemplate",{ref:"childGridTemplate",attrs:{title:"来往单位",gridModel:e.Company,initCondition:e.initCondition,sort:e.sort},on:{editorsReCode:e.editorsReCode,beforeEdit:e.beforeEdit,beforeAdd:e.beforeAdd,beforeEditSubmit:e.beforeEditSubmit,rowDbClick:e.rowDbClick}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs4:""}},[i("v-select",{attrs:{label:"行业","return-object":"","item-text":"dname",items:e.industryList,clearable:""},model:{value:e.editItemed.industry,callback:function(t){e.$set(e.editItemed,"industry",t)},expression:"editItemed.industry"}})],1),i("v-flex",{attrs:{xs4:""}},[i("treeView",{ref:"treeView",attrs:{independentCheck:!1,Source:e.regionList,MultipleSelect:!1,label:"区域",independentSingleCheck:!0,IsTree:!0,"return-object":""},model:{value:e.editItemed.region,callback:function(t){e.$set(e.editItemed,"region",t)},expression:"editItemed.region"}})],1),i("v-flex",{attrs:{xs4:""}},[i("v-text-field",{attrs:{label:"地址"},model:{value:e.editItemed.address,callback:function(t){e.$set(e.editItemed,"address",t)},expression:"editItemed.address"}})],1),i("v-flex",{attrs:{xs4:""}},[i("v-text-field",{attrs:{label:"邮政编码"},model:{value:e.editItemed.postalCode,callback:function(t){e.$set(e.editItemed,"postalCode",t)},expression:"editItemed.postalCode"}})],1),i("v-flex",{attrs:{xs4:""}},[i("v-radio-group",{attrs:{row:"",label:"有无合作"},model:{value:e.editItemed.hasCooperate,callback:function(t){e.$set(e.editItemed,"hasCooperate",t)},expression:"editItemed.hasCooperate"}},e._l(e.cooperateList,(function(e){return i("v-radio",{key:e.dvalue,attrs:{label:e.dname,value:e}})})),1)],1)],1),i("simpleDataTable",{attrs:{items:e.contact,allowEdit:!0,editConfig:e.simpleGridEditConfig,headers:e.editContact,hideHeaders:!1}})],1)],1),i("contentModal",{attrs:{title:"来往单位详情",IsShow:e.IsShowDetails,isDetails:!0},on:{modalClosed:function(t){return e.modalClosed()}}},[i("div",{staticStyle:{padding:"24px"}},[i("v-container",{staticStyle:{padding:"0"},attrs:{"grid-list-md":""}},[i("v-layout",{attrs:{row:"",wrap:""}},e._l(e.editCompany,(function(t){return i("v-flex",{key:t.field,attrs:{xs4:""}},["industry"==t.field?i("v-select",{attrs:{label:t.fieldName,"item-text":"dname","item-value":"dvalue",disabled:"",items:e.industryList},model:{value:e.companyDetails[t.field],callback:function(i){e.$set(e.companyDetails,t.field,i)},expression:"companyDetails[item.field]"}}):"region"==t.field?i("v-select",{attrs:{label:t.fieldName,"item-text":"dname","item-value":"dvalue",disabled:"",items:e.regionList},model:{value:e.companyDetails[t.field],callback:function(i){e.$set(e.companyDetails,t.field,i)},expression:"companyDetails[item.field]"}}):"hasCooperate"==t.field?i("v-radio-group",{attrs:{row:"",label:"有无合作",disabled:""},model:{value:e.companyDetails[t.field],callback:function(i){e.$set(e.companyDetails,t.field,i)},expression:"companyDetails[item.field]"}},e._l(e.cooperateList,(function(e){return i("v-radio",{key:e.dvalue,attrs:{label:e.dname,value:e.dname}})})),1):i("v-text-field",{attrs:{label:t.fieldName,disabled:""},model:{value:e.companyDetails[t.field],callback:function(i){e.$set(e.companyDetails,t.field,i)},expression:"companyDetails[item.field]"}})],1)})),1)],1),i("v-divider"),i("v-container",{staticStyle:{padding:"0"},attrs:{"grid-list-md":""}},e._l(e.contactDetails,(function(t){return i("v-layout",{key:t.id,attrs:{row:"",wrap:""}},e._l(e.editContacts,(function(a){return i("v-flex",{key:a.field,attrs:{xs3:""}},[i("v-text-field",{attrs:{label:a.fieldName,disabled:""},model:{value:t[a.field],callback:function(i){e.$set(t,a.field,i)},expression:"con[item.field]"}})],1)})),1)})),1)],1)]),i("contentModal",{attrs:{title:"导入来往单位",IsShow:e.IsShowImport},on:{modalClosed:function(t){return e.modalClosedImport()},modalComfirmed:function(t){return e.ComfirmImport()}}},[i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("v-btn",{staticClass:"mb-2",attrs:{color:"primary",dark:""},on:{click:e.downloadTemp}},[e._v("下载导入模板")]),i("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("\n                (注:文档内标题标红的列为必填项，请勿输入以下非法字符：~、@、$、^、&、《、》、<、>、￥)\n            ")])],1),i("UploadFile",{ref:"uploadFile",attrs:{label:"导入文件"},on:{formData:e.getFormData},model:{value:e.base64,callback:function(t){e.base64=t},expression:"base64"}})],1)],1)},n=[],o=(i("7cfd"),i("bada"),i("4634"),i("f19a")),s=i("b9da"),r=i("58c5"),d=i("815a"),l=i("8333"),c=i("55b3"),m=i("a2a7"),u=i("a7fe"),f=i("d5b3"),p=new l["a"]((new d["a"]).companycontacts.model),h=new l["a"](new d["a"]),v={name:"company",data:function(){var e=this;return{initCondition:{deleted:!1},rules:{required:function(e){return!!e||"这一项必须填"},contactLength:function(e){return e&&e.length>=1||"联系人必须填"}},Company:{},searchValue:"",contact:[],editContact:p.formatGridHeader(),simpleGridEditConfig:[{userfor:"add",click:function(){var t={};p.formatGridHeader().map((function(e){t[e.value]=""})),e.contact.push(t)}},{userfor:"delete",click:function(t,i){e.deleteContact(t,i)}}],headerBtns:[{disabled:!this.$per("Company","c"),text:"添加",icon:"self_add",click:function(){return e.$refs.childGridTemplate.GridAdd()}},{disabled:!this.$per("Company","u"),text:"编辑",icon:"self_edit",click:function(){return e.$refs.childGridTemplate.GridEdit()}},{disabled:!this.$per("Company","d"),text:"删除",icon:"self_delete",click:function(){return e.$refs.childGridTemplate.GridDelete()}},{disabled:!this.$per("Company","import"),text:"导入",icon:"self_import",click:function(){return e.importCompany()}},{disabled:!this.$per("Company","e"),text:"导出",icon:"self_export",click:function(){return e.exportCompany()}}],IsShowImport:!1,base64:"",sort:!0,IsShowDetails:!1,contactDetails:[],companyDetails:{},editCompany:[],editContacts:p.getEditFields(),cooperateList:[],industryList:[],regionList:[],region:"",hasCooperateList:[],editItemed:{}}},components:{gridTemplate:s["a"],simpleDataTable:r["a"],UploadFile:c["a"],contentModal:m["a"],treeView:o["a"]},mounted:function(){this.Company=new d["a"],this.init()},computed:{tree:function(){var e=[];this.regionList&&(e=this.toTree(this.regionList,"-1"));var t=[];return e&&e.length>0&&e.forEach((function(e){t=t.concat(e.children)})),t}},methods:{init:function(){var e=this;this.$Server.queryAll((new u["a"]).__name,{},{dname:"有无合作"}).then((function(t){e.cooperateList=t.datas})),this.$Server.queryAll((new u["a"]).__name,{},{dname:"来往单位行业"}).then((function(t){e.industryList=t.datas})),this.$Server.queryAll((new u["a"]).__name,{},{tree:"来往单位区域"}).then((function(t){e.regionList=t.datas,e.regionList&&e.regionList.length>0&&e.regionList.forEach((function(e){e.name=e.dname}))}))},doSearch:function(){this.$refs.childGridTemplate.doSearch({searchfx:this.searchValue})},clearMessage:function(){this.$refs.childGridTemplate.doSearch({})},editorsReCode:function(e){e=e.filter((function(e){return e.field&&"companycontacts"!=e.field})),this.editCompany=e,this.$refs.childGridTemplate.editors=e.filter((function(e){return"cname"==e.field||"comCode"==e.field||"ctypeList"==e.field}))},beforeEdit:function(e,t){var i=this;if(this.contact=[],this.editItemed.region="",this.editItemed.industry=t.industry,this.editItemed.address=t.address,this.editItemed.postalCode=t.postalCode,this.editItemed.hasCooperate=this.cooperateList.find((function(e){return e.dname==t.hasCooperate.dname})),t.region){var a=this.regionList.find((function(e){return e.dname==t.region.dname}));a&&(this.editItemed.region=a.id)}this.$Server.queryAll(p.getModelName(),{page:"-1",rowsPerPage:"-1"},{companyId:e.id}).then((function(e){i.contact=e.datas}),(function(e){return f["a"].alert(e)}))},deleteContact:function(e,t){this.contact.length>1?this.contact.splice(t,1):f["a"].alert("必须有一个联系人信息")},beforeAdd:function(e){this.editItemed={},this.editItemed.hasCooperate=this.cooperateList.find((function(e){return"有"==e.dname})),this.editItemed.region="",this.contact=[],this.contact.push({})},beforeEditSubmit:function(e){var t=this;e.region=this.regionList.find((function(e){return e.id==t.editItemed.region})),0==this.contact.length?f["a"].alert("联系人不能为空"):(e.industry=this.editItemed.industry,e.address=this.editItemed.address,e.postalCode=this.editItemed.postalCode,e.hasCooperate=this.editItemed.hasCooperate,e.companycontacts=this.contact)},addRow:function(){this.contact=[],this.contact.push({})},exportCompany:function(){this.$Server.exportFile(h.getModelName(),"来往单位管理"+this.$Utils.getLocalFotmatTime())},rowDbClick:function(e){this.contactDetails=e.companycontacts;var t=e.id,i=e.comCode,a=e.ctypeName,n=e.cname,o=e.hasCooperate,s=e.region,r=e.address,d=e.postalCode,l=e.industry;this.companyDetails={id:t,comCode:i,ctypeName:a,cname:n,hasCooperate:o,region:s,address:r,postalCode:d,industry:l},this.companyDetails.hasCooperate=this.companyDetails.hasCooperate.dname,this.IsShowDetails=!0},importCompany:function(){this.$refs.uploadFile.clearFile(),this.IsShowImport=!0},ComfirmImport:function(){var e=this,t=this.$refs.uploadFile.filename,i={base64:this.base64,fileName:t,fileType:"xls"};this.$Server.importFile(h.getModelName(),i).then((function(t){t.success?(f["a"].alert("导入成功","success"),e.IsShowImport=!1,e.$refs.uploadFile.clearFile(),e.$refs.childGridTemplate.init()):f["a"].alert(t.datas.error)}),(function(e){return f["a"].alert(e)}))},getFormData:function(e){var t=this,i=e.get("data");if(i){var a=i.name.substring(i.name.lastIndexOf(".")+1,i.name.length);"xls"!=a&&"xlsx"!=a&&(f["a"].alert("请检查文件是否为Excel文件"),t.$refs.uploadFile.clearFile())}},modalClosedImport:function(){this.IsShowImport=!1,this.$refs.uploadFile.clearFile()},downloadTemp:function(){var e=document.createElement("a");e.href="/imporTemp/company.xls",e.download="来往单位.xls",e.click()},modalClosed:function(){this.IsShowDetails=!1},toTree:function(e,t){if(e&&e.length){for(var i,a=this,n=[],o=0;o<e.length;o++)if(e[o].parentId==t){a.parentIds.push(t);var s=e[o];i=a.toTree(e,e[o].id),i.length>0&&(s.children=i),n.push(s)}return n}}}},y=v,b=i("6691"),C=Object(b["a"])(y,a,n,!1,null,null,null);t["default"]=C.exports}}]);