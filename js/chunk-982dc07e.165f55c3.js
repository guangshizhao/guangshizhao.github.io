(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-982dc07e"],{"0f50":function(e,t,i){"use strict";var n=i("6eb3"),s=i.n(n);s.a},"20b0":function(e,t,i){},"6eb3":function(e,t,i){},a38a:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("layContent",[i("layContentHeader",{attrs:{title:"权限管理",buttons:e.headerBtns}}),i("v-layout",[i("layContentLeft",{attrs:{title:"角色"}},[i("v-card",{staticClass:"d-inline-block elevation-3"},[i("v-navigation-drawer",{staticStyle:{width:"220px"},attrs:{permanent:""}},[i("v-list",e._l(e.rolelist,(function(t){return i("v-list-tile",{key:t.id,on:{click:function(i){return e.rolelistselected(t)}}},[i("v-list-tile-content",[i("v-list-tile-title",{class:e.selectColor[t.id],domProps:{textContent:e._s(t.rname)}})],1)],1)})),1)],1)],1)],1),i("layContentRight",[i("v-card",{staticClass:"authoriCard",attrs:{light:""}},[i("v-tabs",{attrs:{color:"transparent","slider-color":"primary","show-arrows":""},model:{value:e.actives,callback:function(t){e.actives=t},expression:"actives"}},[e._l(e.rows,(function(t,n){return i("v-tab",{key:n},[i("v-checkbox",{attrs:{indeterminate:e.partIndeterminates[t.id],value:!0,readonly:e.ckeckBoxReadonly,disabled:e.IsSelectRole},on:{change:function(i){return e.selectPartAllChanged(t.id)}},model:{value:e.selectPartAllState[t.id],callback:function(i){e.$set(e.selectPartAllState,t.id,i)},expression:"selectPartAllState[row.id]"}}),i("span",{staticStyle:{"font-size":"16px"}},[e._v(e._s(t.pname))])],1)})),e._l(e.rows,(function(t,n){return i("v-tab-item",{key:n},[i("v-layout",{attrs:{row:"",wrap:""}},e._l(t.children,(function(t){return e.actives==n?i("v-flex",{key:t.id,staticClass:"authoriItem",attrs:{"d-flex":"",xs12:""}},[i("v-flex",{staticClass:"align-center text-lg-center secondary",staticStyle:{"border-right":"1px solid #b6b6b8"},attrs:{"d-flex":"",xs2:""}},[i("v-checkbox",{staticStyle:{"margin-left":"5px"},attrs:{label:t.pname,indeterminate:e.indeterminates[t.id],value:!0,readonly:e.ckeckBoxReadonly,disabled:e.IsSelectRole},on:{change:function(i){return e.selectAllChanged(t.id)}},model:{value:e.selectAllState[t.id],callback:function(i){e.$set(e.selectAllState,t.id,i)},expression:"selectAllState[child.id]"}})],1),i("v-flex",{attrs:{"d-flex":"",xs10:""}},[i("v-layout",{staticStyle:{"padding-left":"10px"},attrs:{wrap:"",row:"","justify-start":""}},e._l(t.children,(function(t){return e.actives==n?i("v-flex",{key:t.id,staticStyle:{"min-width":"150px"},attrs:{lg1:""}},[i("v-checkbox",{attrs:{value:t.id,label:t.pname,readonly:e.ckeckBoxReadonly,disabled:e.IsSelectRole},model:{value:e.selectPermisions,callback:function(t){e.selectPermisions=t},expression:"selectPermisions"}})],1):e._e()})),1)],1)],1):e._e()})),1)],1)}))],2)],1)],1)],1)],1),i("contentModal",{attrs:{title:e.ModalTittle,IsShow:e.IsShow},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[i("v-container",[i("v-form",{ref:"form"},[i("v-text-field",{attrs:{disabled:e.cannotEdit,rules:[e.rules.required]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                        角色名称"),i("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.editItem.rname,callback:function(t){e.$set(e.editItem,"rname",t)},expression:"editItem.rname"}}),i("v-text-field",{attrs:{label:"角色描述",disabled:e.cannotEdit},model:{value:e.editItem.description,callback:function(t){e.$set(e.editItem,"description",t)},expression:"editItem.description"}}),i("v-radio-group",{attrs:{label:"是否为管理员",row:"",disabled:e.cannotEdit},model:{value:e.editItem.isAdministrative,callback:function(t){e.$set(e.editItem,"isAdministrative",t)},expression:"editItem.isAdministrative"}},[i("v-radio",{attrs:{label:"是",value:!0}}),i("v-radio",{attrs:{label:"否",value:!1}})],1)],1)],1)],1),i("comfirmModal",{attrs:{title:"提示",IsShow:e.IsComfirmShow,text:"确定删除所选角色？"},on:{modalComfirmedClose:function(t){return e.modalCancel()},modalComfirmed:function(t){return e.deleteConfirm()}}})],1)},s=[],r=i("dea4"),a=(i("fafd"),i("8062"),i("bada"),i("4634"),i("97a3")),l=i("7300"),o=i("5873"),c=i("ddf2"),d=i("80ea"),u=i("ae0a"),m=i("652a"),f=i("1269"),h=new m["a"],v=function(e){function t(){var e,i;Object(l["a"])(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return i=Object(o["a"])(this,(e=Object(c["a"])(t)).call.apply(e,[this].concat(s))),Object(a["a"])(Object(d["a"])(i),"__name","Permission"),Object(a["a"])(Object(d["a"])(i),"pname",h.charField({require:!0,fieldName:"权限名"})),Object(a["a"])(Object(d["a"])(i),"parentId",h.charField({require:!0,fieldName:"父级"})),Object(a["a"])(Object(d["a"])(i),"pvalue",h.charField({require:!0,fieldName:"权限值"})),Object(a["a"])(Object(d["a"])(i),"method",h.charField({require:!0,fieldName:"方法"})),i}return Object(u["a"])(t,e),t}(f["a"]),p=i("6722"),b=new m["a"],I=function(e){function t(){var e,i;Object(l["a"])(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return i=Object(o["a"])(this,(e=Object(c["a"])(t)).call.apply(e,[this].concat(s))),Object(a["a"])(Object(d["a"])(i),"__name","RolePermission"),Object(a["a"])(Object(d["a"])(i),"roleId",b.charField({require:!0,fieldName:"角色id"})),Object(a["a"])(Object(d["a"])(i),"permissionId",b.charField({require:!0,fieldName:"权限id"})),i}return Object(u["a"])(t,e),t}(f["a"]),S=i("8333"),w=i("d5b3"),P=i("a2a7"),y=i("23f5"),x=i("1e17"),C=i("07c5"),O=i("8907"),j=i("adf0"),A=new S["a"](new v),k=new S["a"](new p["a"]),g=new S["a"](new I),_={data:function(){var e,t=this;return e={actives:null,selectColor:{},headerBtns:[{disabled:!this.$per("Role","c"),text:"添加",icon:"self_add",click:function(){return t.showAddWindow()}},{disabled:!this.$per("Role","u"),text:"编辑",icon:"self_edit",click:function(){return t.showEditWindow()}},{disabled:!this.$per("Role","d"),text:"删除",icon:"self_delete",click:function(){return t.del()}},{disabled:!this.$per("Role","u"),text:"保存",icon:"self_save",click:function(){return t.save()}}],valid:!0,rules:{required:function(e){return!!e||"必填项"}},ckeckBoxReadonly:!1,indeterminates:{},selectAllState:{},rolelist:[],ModalTittle:"",IsShow:!1,IsComfirmShow:!1,cannotEdit:!1,IsUpdate:!1,editItem:{isAdministrative:!1},_PermissionSever:{},_RoleServer:{}},Object(a["a"])(e,"_PermissionSever",{}),Object(a["a"])(e,"_rolePermissionServer",{}),Object(a["a"])(e,"rows",[]),Object(a["a"])(e,"selectPermisions",[]),Object(a["a"])(e,"permissions",[]),Object(a["a"])(e,"selectPartAllState",{}),Object(a["a"])(e,"partIndeterminates",{}),Object(a["a"])(e,"IsSelectRole",!0),e},components:{contentModal:P["a"],comfirmModal:y["a"],layContent:x["a"],layContentHeader:C["a"],layContentLeft:O["a"],layContentRight:j["a"]},mounted:function(){this.$store.state.oldPermisions=[],this.$store.state.newPermisions=[],this.initialize()},watch:{selectPermisions:{handler:function(e){var t=this,i=this;for(var n in i.$store.state.newPermisions=e,this.indeterminates)this.indeterminates[n]=!1;for(var s in this.selectAllState)this.selectAllState[s]=!1;for(var r in this.partIndeterminates)this.partIndeterminates[r]=!1;for(var a in this.selectPartAllState)this.selectPartAllState[a]=!1;this.selectPermisionsPids&&(this.selectPermisionsPids.forEach((function(i){var n=t.permissions.filter((function(e){return e.parentId==i})).map((function(e){return e.id}));n.every((function(t){return-1!=e.indexOf(t)}))?(t.indeterminates[i]=!1,t.selectAllState[i]=!0):n.some((function(t){return-1!=e.indexOf(t)}))&&(t.indeterminates[i]=!0)})),this.selectPermisionsRids.forEach((function(e){var n=t.permissions.filter((function(t){return t.parentId==e})).map((function(e){return e.id}));n.every((function(e){return i.selectAllState[e]}))&&n.every((function(e){return!i.indeterminates[e]}))?(t.partIndeterminates[e]=!1,t.selectPartAllState[e]=!0):(n.some((function(e){return i.selectAllState[e]}))||n.some((function(e){return i.indeterminates[e]})))&&(t.partIndeterminates[e]=!0)})))},deep:!0}},computed:{selectPermisionsRids:function(){var e=this,t=[];return this.selectPermisionsPids.forEach((function(i){var n,s=e.permissions.find((function(e){return e.id==i}));s&&(n=s.parentId),t.push(n)})),new Set(t)},selectPermisionsPids:function(){var e=this,t=this.selectPermisions.map((function(t){var i,n=e.permissions.find((function(e){return e.id==t}));return n&&(i=n.parentId),i}));return new Set(t)}},destroyed:function(){},methods:{selectAllChanged:function(e){var t=this.permissions.filter((function(t){return t.parentId==e})).map((function(e){return e.id}));this.selectAllState[e]?this.selectPermisions=[].concat(Object(r["a"])(t),Object(r["a"])(this.selectPermisions)):this.selectPermisions=this.selectPermisions.filter((function(e){return-1==t.indexOf(e)}))},selectPartAllChanged:function(e){var t=this,i=this.permissions.filter((function(t){return t.parentId==e})).map((function(e){return e.id}));i.forEach((function(i){t.selectAllState[i]=t.selectPartAllState[e],t.selectAllChanged(i)}))},initialize:function(){var e=this;this.$Server.queryAll(k.getModelName()).then((function(t){e.rolelist=t.datas}),(function(e){return w["a"].alert(e)})),this.$Server.queryAll(A.getModelName()).then((function(t){e.permissions=t.datas.map((function(e){return e})),e.rows=e.toTree(e.permissions,"0")}),(function(e){return w["a"].alert(e)}))},rolelistselected:function(e){this.IsSelectRole=!1,this.selectColor={},this.selectColor[e.id]="blue--text",this.editItem=JSON.parse(JSON.stringify(e));var t=this.editItem.permissionList;this.selectPermisions=[],this.ckeckBoxReadonly=e.administrative;var i=this;e.isAdministrative?i.permissions.forEach((function(e){i.selectPermisions.push(e.id)})):t&&t.length>0&&t.forEach((function(e){i.selectPermisions.push(e.permissionId)})),i.$store.state.oldPermisions=i.selectPermisions,i.$store.state.newPermisions=i.selectPermisions},showAddWindow:function(){this.ModalTittle="添加角色",this.cannotEdit=!1,this.IsUpdate=!1,this.editItem={isAdministrative:!1},this.$refs.form.resetValidation(),this.IsShow=!0},modalClosed:function(){this.IsShow=!1,this.$refs.form.resetValidation()},modalComfirmed:function(){if(this.$refs.form.validate()){var e=this;this.$Server.addOrUpdate(k.getModelName(),e.editItem,e.IsUpdate).then((function(t){t.success&&(e.IsShow=!1,w["a"].alert("保存成功","success"),e.editItem.id=t.model.id,e.rolelistselected(e.editItem),e.initialize())}),(function(e){return w["a"].alert(e)}))}else w["a"].alert("验证不通过")},showEditWindow:function(){this.IsSelectRole?w["a"].alert("请选择一个角色"):(this.ModalTittle="编辑角色",this.cannotEdit=!1,this.IsUpdate=!0,this.IsShow=!0)},del:function(){this.IsSelectRole?w["a"].alert("请选择一个角色"):this.IsComfirmShow=!0},modalCancel:function(){this.IsComfirmShow=!1},deleteConfirm:function(){var e=this;this.IsSelectRole||this.$Server.delete(k.getModelName(),e.editItem).then((function(t){t.success&&(e.IsComfirmShow=!1,e.initialize())}),(function(e){return w["a"].alert(e)}))},toTree:function(e,t){for(var i,n=this,s=[],r=0;r<e.length;r++)if(e[r].parentId==t){var a=e[r];i=n.toTree(e,e[r].id),i.length>0&&(a.children=i),s.push(a)}return s},save:function(){if(this.IsSelectRole)w["a"].alert("请选择一个角色");else{var e=[],t=this;if(this.selectPermisions.forEach((function(i){if(!i.methods){var n={};n.roleId=t.editItem.id,n.permissionId=i,e.push(n)}})),e.length<=0){var i={roleId:t.editItem.id};e.push(i)}this.$Server.batchSave(g.getModelName(),e).then((function(e){e.success&&(t.$store.state.oldPermisions=t.$store.state.newPermisions,w["a"].alert("保存成功","success"),t.initialize())}),(function(e){return w["a"].alert(e)}))}}}},$=_,R=(i("0f50"),i("fc80"),i("6691")),E=Object(R["a"])($,n,s,!1,null,"fe1e9db6",null);t["default"]=E.exports},fc80:function(e,t,i){"use strict";var n=i("20b0"),s=i.n(n);s.a}}]);