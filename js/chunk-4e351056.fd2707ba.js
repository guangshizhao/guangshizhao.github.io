(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e351056"],{"1bcb":function(e,t,i){},5754:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("layContentHeader",{attrs:{title:"故障统计"}}),i("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[i("div",{staticClass:"box"},[i("div",{staticClass:"box-header flex-header",staticStyle:{height:"50px",overflow:"hidden"}},[i("div",{staticClass:"label-title"},[e._v("时间:")]),i("div",{staticClass:"width280 mar-l22"},[i("datePicker",{attrs:{required:!1,rules:[function(e){return!!e||"必填项"}],prependIcon:"star",locale:"zh-cn"},model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}})],1),i("div",{staticClass:"label-title"},[e._v("到")]),i("div",{staticClass:"width280"},[i("datePicker",{attrs:{required:!1,rules:[function(e){return!!e||"必填项"},function(t){return new Date(t)>new Date(e.startDate)||"结束时间应该大于开始时间"}],prependIcon:"star",locale:"zh-cn"},model:{value:e.endDate,callback:function(t){e.endDate=t},expression:"endDate"}})],1),i("div",{staticClass:"label-title"},[e._v("维度:")]),i("div",{staticClass:"width280"},[i("v-select",{staticClass:"self-select",attrs:{items:["月","周","年"]},model:{value:e.timeDimension,callback:function(t){e.timeDimension=t},expression:"timeDimension"}})],1),i("v-btn",{staticClass:"btn-0",attrs:{small:"",depressed:""},on:{click:e.doSearch}},[e._v("查询")])],1)])]),i("div",{staticClass:"box mar-t22"},[i("div",{staticClass:"box-header flex-header",staticStyle:{height:"50px",overflow:"hidden"}},[i("div",{staticClass:"label-title"},[e._v("统计维度:")]),i("div",{staticClass:"width280 mar-l22"},[i("v-select",{staticClass:"self-select",attrs:{items:["工厂","车间与设备仓库","产线与设备库位","设备类型","设备"]},on:{change:e.handleQueryTypeChange},model:{value:e.dimension,callback:function(t){e.dimension=t},expression:"dimension"}})],1),i("div",{staticClass:"label-title"},[e._v(e._s(e.dimension)+":")]),"工厂"===e.dimension?i("v-select",{staticClass:"select self-select",attrs:{items:e.factoryList,"item-text":"fname","item-value":"id"},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}}):e._e(),"车间与设备仓库"===e.dimension?i("div",{staticClass:"width280"},[i("treeComboForNode",{attrs:{itemName:"oname",Source:e.forgList,independentCheck:!1,nodeValue:"1,2",disabled:!1,independentSingleCheck:!0,"return-object":""},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}})],1):e._e(),"产线与设备库位"===e.dimension?i("div",{staticClass:"width280"},[i("treeComboForNode",{attrs:{itemName:"oname",Source:e.forgList,independentCheck:!1,independentSingleCheck:!0,nodeValue:"5,7"},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}})],1):e._e(),"设备类型"===e.dimension?i("v-select",{staticClass:"select self-select",attrs:{items:e.typeList,"item-text":"dname","item-value":"dvalue"},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}}):e._e(),"设备"===e.dimension?i("div",{staticClass:"width280"},[i("treeCombo",{ref:"treeCombos",attrs:{require:!1,Source:e.eqpList,MultipleSelect:!1,disabled:!1,independentCheck:!0,independentSingleCheck:!0,"return-object":""},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}})],1):e._e()],1)]),i("div",{staticClass:"box-wrap mar-t22"},[e._m(0),i("div",{staticClass:"box flex1"},[i("div",{staticClass:"box-header flex-header"},[i("div",{staticClass:"title-0"},[e._v("故障统计")]),i("div",{staticClass:"label-title"},[e._v("统计类容:")]),i("div",{staticClass:"width280"},[i("v-select",{staticClass:"self-select",attrs:{items:["故障类型"]},model:{value:e.typeDimension,callback:function(t){e.typeDimension=t},expression:"typeDimension"}})],1)]),i("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chat2"}})]),e._m(1)]),i("div",{staticClass:"mar-t22"},[i("div",{staticClass:"box"},[i("div",{staticClass:"box-header flex-header"},[i("div",{staticClass:"title-0"},[e._v("故障率统计")]),i("div",{staticClass:"label-title"},[e._v("统计维度:")]),i("div",{staticClass:"width280"},[i("v-select",{staticClass:"self-select",attrs:{items:["工厂","车间","产线","设备类型","设备"]},model:{value:e.dimension1,callback:function(t){e.dimension1=t},expression:"dimension1"}})],1),i("div",{staticClass:"label-title"},[e._v("统计维度:")]),i("div",{staticClass:"width280"},[i("v-select",{staticClass:"self-select",attrs:{items:["工厂","车间","产线","设备类型","设备"]}})],1),i("div",{staticClass:"label-title"},[e._v("停机种类:")]),i("div",{staticClass:"width280"},[i("v-select",{staticClass:"self-select",attrs:{items:["故障停机"]},model:{value:e.stopType1,callback:function(t){e.stopType1=t},expression:"stopType1"}})],1)]),i("div")])])],1)},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"box flex1"},[i("div",{staticClass:"box-header flex-header"},[i("div",{staticClass:"title-0"},[e._v("故障次数统计")])]),i("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chat1"}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"box flex1"},[i("div",{staticClass:"box-header flex-header"},[i("div",{staticClass:"title-0"},[e._v("停机时长统计")])]),i("div",[i("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chat3"}})])])}],s=(i("7cfd"),i("40c5"),i("4634"),i("fafd"),i("63ff"),i("f8f9")),r=i("1d53"),l=i("d5b3"),o=i("6bf2"),c=i.n(o),d=i("0b43"),h=i("b188"),u=i("f19a"),f=i("4027"),p=i("a7fe"),m=i("d685"),v={name:"faultStatistics",components:{datePicker:r["a"],treeComboForLastNode:d["a"],treeComboForNode:h["a"],treeCombo:u["a"]},data:function(){return{valid:!0,startDate:c()((new Date).setMonth((new Date).getMonth()-1)).format("YYYY-MM-DD"),endDate:c()(new Date).format("YYYY-MM-DD"),chatOne:"",chatTwo:"",chatThree:"",timeDimension:"月",showLabel:!1,dimension:"工厂",dimension1:"工厂",id:"",typeList:[],eqpList:[],forgList:[],factoryList:[],typeDimension:"故障类型",stopType:"故障停机时间",stopType1:"故障停机"}},watch:{id:function(e){""!==e&&this.reSearch()}},methods:{initChat:function(){this.chatOne=this.$echarts.init(document.getElementById("chat1")),this.chatTwo=this.$echarts.init(document.getElementById("chat2")),this.chatThree=this.$echarts.init(document.getElementById("chat3"))},doSearch:function(){this.$refs.form.validate()&&(this.getChatInfo(),this.getChat2Info(),this.getChat3Info())},handleQueryTypeChange:function(){this.id="",this.reSearch()},reSearch:function(){this.$refs.form.validate()&&(this.getChatInfo(),this.getChat3Info())},initChatOne:function(e,t,i){var a={xAxis:{type:"category",data:e,axisLabel:{color:"#8b8f98",rotate:"30"}},grid:{containLabel:!0},yAxis:[{type:"value",name:"故障次数"},{type:"value",name:"故障率",boundaryGap:[.2,.2],axisLabel:{formatter:function(e){return 100*e+"%"}},min:0,max:1}],tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},legend:{data:["故障数量","故障率"],right:80},series:[{color:"#dfdfdf",name:"故障数量",data:t,type:"bar",barMaxWidth:window.infoConfig.barMaxWidth,label:{show:!1,position:"top"}},{color:"#ff0202",name:"故障率",yAxisIndex:1,data:i,type:"line",label:{show:!1,position:"top"}}]};this.chatOne.setOption(a)},initChatTwo:function(e,t){var i={xAxis:{type:"category",data:e,axisLabel:{color:"#8b8f98",rotate:"30"}},grid:{containLabel:!0},yAxis:[{type:"value",name:"故障统计"},{type:"value",name:"故障率",boundaryGap:[.2,.2],axisLabel:{formatter:function(e){return 100*e+"%"}},min:0,max:1}],tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},legend:{data:["故障数量"],right:80},series:[{color:"#fbab99",name:"故障数量",data:t,type:"bar",barMaxWidth:window.infoConfig.barMaxWidth,label:{show:!1,position:"top"}}]};this.chatTwo.setOption(i)},initChatThree:function(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n={color:["#fb4444","#364fcc","#1858a6","#969ba6","#ffcb99","#787993"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["故障停机时间","响应时间"]},grid:{containLabel:!0},xAxis:[{type:"category",data:e,axisLabel:{rotate:45}}],yAxis:[{type:"value",name:"时间(分钟)"}],series:[{name:"故障停机时间",type:"bar",stack:"广告",data:i,label:{show:a,color:"#000",position:["50%","50%"]}},{name:"响应时间",type:"bar",barMaxWidth:window.infoConfig.barMaxWidth,stack:"广告",data:t,label:{show:a,color:"#000",position:["50%","50%"]}}]};this.chatThree.setOption(n)},getCondition:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$Server.queryAll((new p["a"]).__name,{},{type:"4"}),i=this.$Server.queryAll((new f["a"]).__name,{},{searchEqpStation:!0}),a=this.$Server.queryAll((new m["a"]).__name,{},{all:"all"}),n=Promise.all([t,i,a]),e.next=6,n;case 6:s=e.sent,this.typeList=s[0].datas,this.forgList=s[1].datas,this.factoryList=s[1].datas.filter((function(e){return e.orgType&&"工厂"===e.orgType.dname})),this.eqpList=this.toEqpTree(s[2].datas);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getChatInfo:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t="",t=Array.isArray(this.id)?this.id[0]:(this.id,this.id),i=this.$Server.queryAll("RepairStoppageStatis",null,{startDate:this.startDate,endDate:this.endDate,dimension:this.dimension,content:"故障次数",objectId:t,timeDimension:this.timeDimension}).catch(l["a"].alert),e.next=5,i;case 5:a=e.sent,n=a.datas[0].repairCountList,s=a.datas[0].platoCountList,r=n.map((function(e){return e.itemName})),o=n.map((function(e){return e.itemValue})),c=s.map((function(e){return e.itemValue})),this.initChatOne(r,o,c);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getChat2Info:function(){var e=this;this.$Server.queryAll("RepairStoppageStatis",null,{startDate:this.startDate,endDate:this.endDate,typeDimension:this.typeDimension,content:"故障统计"}).then((function(t){var i=t.datas[0].repairTypeList,a=i.map((function(e){return e.itemName})),n=i.map((function(e){return e.itemValue}));e.initChatTwo(a,n)})).catch(l["a"].alert)},getChat3Info:function(){var e=this,t="";t=Array.isArray(this.id)?this.id[0]:(this.id,this.id),this.$Server.queryAll("RepairStoppageStatis",null,{startDate:this.startDate,endDate:this.endDate,objectId:t,typeDimension:this.dimension,content:"停机时长统计"}).then((function(t){console.log(t);var i=t.datas[0].responseList,a=t.datas[0].stopTimeList,n=a.map((function(e){return e.itemName})),s=i.map((function(e){return e.itemValue})),r=a.map((function(e){return e.itemValue}));e.initChatThree(n,s,r)})).catch(l["a"].alert)},toEqpTree:function(e){var t=[],i=[];if(e.forEach((function(e){void 0==e.eType||null==e.eType||0==e.eType.length?(e.typeChinese="无",t.push(e)):t.push(e),-1==i.indexOf(e.eType)&&(void 0==e.eType||null==e.eType||0==e.eType.length?i.includes("无")||i.push("无"):i.push(e.eType))})),i.forEach((function(e,i){t.push({name:e,id:i+1,parentId:-1,isshow:!1})})),void 0==e||null==e||0==e.length);else{e.forEach((function(e){e.name=e.nameAndModel}));for(var a=0;a<t.length;a++)for(var n=0;n<t.length;n++)if(t[a].eType==t[n].name){t[a].parentId=t[n].id;break}}return t}},mounted:function(){var e=this;this.initChat(),this.getCondition().then((function(t){e.getChatInfo(),e.getChat2Info(),e.getChat3Info()}))}},b=v,x=(i("d30d"),i("6691")),C=Object(x["a"])(b,a,n,!1,null,"8999983c",null);t["default"]=C.exports},b188:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-menu",{attrs:{"offset-overflow":"","full-width":"",disabled:e.disabled,"close-on-content-click":!1},model:{value:e.showMenu,callback:function(t){e.showMenu=t},expression:"showMenu"}},[i("v-text-field",{attrs:{slot:"activator",label:e.label,"append-icon":"arrow_drop_down",value:e.textValueStr,disabled:e.disabled,clearable:"",readonly:"",rules:e.getRules(e.requireVaild)},on:{"click:clear":function(t){return e.clearfield()}},slot:"activator",scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n        "+e._s(e.label)+" "),e.requireVaild?i("span",{staticStyle:{color:"red"}},[e._v("*")]):e._e()]},proxy:!0}])}),i("v-list",[i("v-text-field",{staticStyle:{width:"97%",margin:"0px auto 12px auto"},attrs:{label:"查询","hide-details":"","single-line":"",primary:"",clearable:"","append-icon":"fa-search"},on:{"click:clear":e.clearMessage,"click:append":e.doSearch},model:{value:e.searchfx,callback:function(t){e.searchfx=t},expression:"searchfx"}}),i("treeView",{ref:"childTreeView",attrs:{Source:e.searchSource,MultipleSelect:e.MultipleSelect,independentCheck:e.independentCheck,independentSingleCheck:e.independentSingleCheck,IsTree:e.IsTree},on:{SelectChanged:e.selectChanged}})],1)],1)},n=[],s=(i("bada"),i("4634"),i("8062"),i("fafd"),i("a9b1"),i("7cfd"),i("ff4f")),r=i("d5b3"),l={name:"treeComboForLastNode",data:function(){return{showMenu:!1,treeValues:[],activeValue:[],selectedItem:[],IsShow:!1,textValueStr:"",requireVaild:"",searchfx:"",searchSource:[]}},components:{treeView:s["a"]},watch:{value:{handler:function(e,t){void 0!=e&&(this.textValueStr=this.getTextValueStr(e),this.$refs.childTreeView.setSelectItems(e))}},Source:{handler:function(e){this.searchSource=e},immediate:!0}},computed:{},mounted:function(){this.requireVaild=this.require},methods:{familyTree:function(e,t){var i=[],a=function t(a,n){for(var s=0;s<a.length;s++){var r=a[s];if(r.id==n){i.push(r),t(e,r.parentId);break}r.children&&t(r.children,n)}};return a(e,t),i},clearMessage:function(){var e=this;e.searchfx="",e.searchSource=e.Source},doSearch:function(){var e=this;if(e.searchfx.length>0){for(var t=[],i=0;i<e.Source.length;i++){var a=[];e.Source[i].name.indexOf(e.searchfx)>-1&&(a=e.familyTree(e.Source,e.Source[i].id),t=t.concat(t,a))}this.searchSource=Array.from(new Set(t))}else e.searchSource=e.Source},getRules:function(e){return e?[function(e){return e&&""!=e||"必填项"}]:void 0},clearfield:function(){this.$refs.childTreeView.clearfield(),this.$emit("cleared")},getTextValueStr:function(e){var t=this;Array.isArray(e)||(e=[e]);var i=this;if(e&&e.length){var a=e.map((function(e){if(!e)return"";var a={};if(a=1==t.IsTree?t.Source.find((function(t){return t.id==e&&"-1"!=t.parentId})):t.Source.find((function(t){return t.id==e})),a&&a.name)return a.name;i.$Console.error("未找到已保存的关联id："+e)}));return a.join("，")}},selectChanged:function(e){if(e&&e.length>0){var t=this.Source.find((function(t){return t.id==e[0]}));t&&t.orgType&&this.nodeValue.indexOf(t.orgType.dvalue)>-1?(this.textValueStr=this.getTextValueStr(e),this.$emit("input",e)):1==this.nodeValue?r["a"].alert("只能选择车间"):5==this.nodeValue?r["a"].alert("只能选择产线"):"1,2"==this.nodeValue||"2,1"==this.nodeValue?r["a"].alert("只能选择车间或设备仓库"):"5,7"!=this.nodeValue&&"7,5"!=thi.nodeValue||r["a"].alert("只能选择产线或库位")}else this.textValueStr=this.getTextValueStr(e),this.$emit("input",e)},setActiveVaules:function(){this.clearMessage(),this.$refs.childTreeView.setActiveVaules(),this.$refs.childTreeView.clearfield()}},props:["label","Source","MultipleSelect","independentCheck","value","independentSingleCheck","require","disabled","IsTree","nodeValue"]},o=l,c=i("6691"),d=Object(c["a"])(o,a,n,!1,null,null,null);t["a"]=d.exports},d30d:function(e,t,i){"use strict";var a=i("1bcb"),n=i.n(a);n.a}}]);