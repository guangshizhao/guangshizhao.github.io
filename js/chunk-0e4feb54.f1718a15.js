(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e4feb54"],{"0c10":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-form",{ref:"form1",attrs:{"lazy-validation":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"取消原因",rules:[e.rules.required]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            取消原因: "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.item.cancelReason,callback:function(t){e.$set(e.item,"cancelReason",t)},expression:"item.cancelReason"}})],1)],1)],1)],1)],1)},n=[],r=(a("d5b3"),{name:"CancelTask",data:function(){return{rules:{required:function(e){return!!e||"必填项"}}}},props:["item"],methods:{validate:function(){return 1==this.$refs.form1.validate()},resetValid:function(){this.$refs.form1.resetValidation(),this.$refs.form1.reset()}}}),i=r,o=a("6691"),d=Object(o["a"])(i,s,n,!1,null,"058eafcc",null);t["a"]=d.exports},"5a0a":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContentHeader",{attrs:{title:"闲置设备处理",buttons:e.headerBtns}},[a("v-text-field",{staticStyle:{width:"260px"},attrs:{label:"输入处理单编号或申请人","hide-details":"","single-line":"",primary:"",clearable:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchfx,callback:function(t){e.searchfx=t},expression:"searchfx"}})],1),a("layContent",[a("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,sort:e.sort,DataSource:e.DataSource,hideOperation:!0,formatFields:e.formatFields,total:e.total},on:{rowDbClick:e.rowDbClick,initialize:e.initTable}}),a("contentModal",{attrs:{title:e.title,IsShow:e.IsShow,width:"1100"},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[a("eqpUnusedTrendTaskDetail",{ref:"addOrUpdate",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:e.titleForSee,IsShow:e.IsShowForSee,width:"1100",isDetails:!0},on:{modalClosed:function(t){return e.modalClosedForSee()}}},[a("eqpUnusedTrendTaskSee",{ref:"See",attrs:{item:e.detailForUpdate}})],1),a(e.currentView,{ref:"componentForm",tag:"component",attrs:{PreviewType:e.PreviewType,objectId:e.objectId},on:{modalComfirmed:e.formComfirmed}}),a("contentModal",{attrs:{title:"取消原因",IsShow:e.IsShowCancelTask,width:"1100"},on:{modalComfirmed:function(t){return e.modalComfirmedCancelTask()},modalClosed:function(t){return e.modalClosedCancelTask()}}},[a("CancelTask",{ref:"CancelTask",attrs:{item:e.detailForUpdate}})],1)],1)],1)},n=[],r=(a("bada"),a("7cfd"),a("4634"),a("e6d1"),a("de90"),a("0c10")),i=a("1d40"),o=a("d5b3"),d=a("8333"),l=a("a2a7"),c=a("23f5"),u=a("f05f"),m=a("681f"),f=a("815a"),p=a("531b"),h=a("a8b8"),g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs6:""}},[e._v("\n               闲置处理单编号："),a("span",[e._v(e._s(e.item.trendCode))])]),a("v-flex",{attrs:{xs6:""}},[e._v("\n               截止日期："),a("span",[e._v(e._s((e.item.deadline||" ").split(" ")[0]))])]),a("v-flex",{attrs:{xs6:""}},[e._v("\n               申请人："),a("span",[e._v(e._s(e.item.applicantName))])]),a("v-flex",{attrs:{xs6:""}},[e._v("\n               处理方式："),a("span",[e._v(e._s(e.item.trendMode.dname))])]),a("v-flex",{attrs:{xs12:""}},[e._v("\n               闲置处理原因："),a("span",[e._v(e._s(e.item.reason))])]),a("v-flex",{attrs:{xs6:""}},[e._v("\n               设备名称："),a("span",[e._v(e._s(e.item.equipment.name))])]),a("v-flex",{attrs:{xs6:""}},[e._v("\n               规格型号："),a("span",[e._v(e._s(e.item.equipment.model))])]),a("v-flex",{attrs:{xs12:""}},[e._v("\n               设备类型："),a("span",[e._v(e._s(e.item.equipment.type.dname))])]),e._l(e.item.rUnusedTrendDocumentList,(function(e,t){return a("v-flex",{key:e.id,attrs:{xs12:""}},[a("view-file",{attrs:{documentViewModel:e.documentViewModel,color:"primary"}})],1)})),e.item.status&&"已取消"==e.item.status.dname?a("v-flex",{staticStyle:{"margin-top":"15px"},attrs:{xs12:""}},[e._v("\n               取消原因："),a("span",[e._v(e._s(e.item.cancelReason))])]):e._e(),e.isImageSrcShow?a("v-flex",[a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("任务进度:")])]),a("div",{staticClass:"image-wrapper"},[e.imagesrc?a("img",{attrs:{src:e.imagesrc}}):e._e()])]):e._e()],2)],1)},v=[],S={name:"eqpUnusedTrendTaskSee",props:["item"],data:function(){return{isImageSrcShow:!1,imagesrc:""}},watch:{item:{handler:function(e){this.isImageSrcShow=!1,e&&e.status&&e.status.dvalue&&0!=e.status.dvalue&&this.getProcessId(e)},deep:!0}},methods:{downloadTemp:function(e,t){var a=document.createElement("a");a.href=t,a.download=e,a.click()},getProcessId:function(e){var t=this;t.imagesrc="",t.isImageSrcShow=!1,p["a"].http(window.processForUrl.getUrlForInstanceId(e.id),"get","",{success:function(e){if(e.data&&e.data.data&&e.data.data.id){var a=e.data.data.id;t.seeImage(a)}}})},seeImage:function(e){var t=this;p["a"].http(window.processForUrl.getUrlForInstanceTrace(e),"get",{},{success:function(e){t.imagesrc=e.data.data.image,t.isImageSrcShow=!0}})}}},T=S,w=a("6691"),b=Object(w["a"])(T,g,v,!1,null,null,null),I=b.exports,k=a("6bf2"),C=a.n(k),U=new d["a"](new i["a"]),F={name:"eqpUnusedTrendTask",data:function(){var e=this;return{initObject:{id:"",trendCode:"",deadline:"",trendMode:{dname:""},applicantName:"",status:{},reason:"",equipment:{id:"",name:"",model:"",type:{dname:""},position:""},rentCompany:"",userViewModel:{},documentList:[],rUnusedTrendDocumentList:[]},IsShowCancelTask:!1,searchfx:"",sort:!0,total:1,DataSource:[],title:"",IsShow:!1,IsAddOp:!0,detailForUpdate:{},IsShowForSee:!1,titleForSee:"",headerBtns:[{disabled:!this.$per("EqpUnusedTrendTask","c"),text:"添加",icon:"self_add",click:function(){return e.tableAdd()}},{disabled:!this.$per("EqpUnusedTrendTask","u"),text:"编辑",icon:"self_edit",click:function(){return e.tableEdit()}},{disabled:!this.$per("EqpUnusedTrendTask","d"),text:"删除",icon:"self_delete",click:function(){return e.tableDelete()}},{disabled:!this.$per("EqpUnusedTrendTask","exe"),text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}},{disabled:!this.$per("EqpUnusedTrendTask","cancel"),text:"取消",icon:"self_cancel",click:function(){return e.cancelTask()}}],leaseCompanyList:[],currentView:"",processKey:window.process.EqpUnusedTrendTask,PreviewType:1,objectId:""}},computed:{headers:function(){var e=U.formatGridHeader();return!0===this.sort&&e.unshift({text:"序号",align:"center",sortable:!1}),e},formatFields:function(){return U.getFormatFields()}},components:{contentModal:l["a"],comfirmModal:c["a"],dataTable:u["a"],eqpUnusedTrendTaskDetail:h["a"],eqpUnusedTrendTaskSee:I,CancelTask:r["a"]},created:function(){this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject))},mounted:function(){var e=this;this.$Server.queryAll((new f["a"]).__name,{},{deleted:"false"}).then((function(t){e.leaseCompanyList=t.datas.filter((function(e){return e.ctypeName&&e.ctypeName.indexOf("租赁厂商")>-1||void 0==e.ctypeName||null==e.ctypeName}))}))},methods:{formComfirmed:function(){this.initTable()},modalComfirmedCancelTask:function(){var e=this;1==e.$refs.CancelTask.validate()?(e.cofirmCancel(e.detailForUpdate),e.IsShowCancelTask=!1):o["a"].alert("验证错误")},modalClosedCancelTask:function(){var e=this;e.IsShowCancelTask=!1},cancelTask:function(){var e=this;1!=e.$refs.childDataTable.getCheckItems().length?o["a"].alert("请选择一项作为你取消的对象"):"进行中"==e.$refs.childDataTable.getCheckItems()[0].status.dname?e.$refs.childDataTable.getCheckItems()[0].applicant!==sessionStorage.getItem("userId")?o["a"].alert("您不是该任务的申请人，不能取消"):(e.detailForUpdate=JSON.parse(JSON.stringify(e.$refs.childDataTable.getCheckItems()[0])),e.$refs.CancelTask.resetValid(),e.IsShowCancelTask=!0):o["a"].alert("只有对进行中的设备闲置处理任务才能取消！")},cofirmCancel:function(e){var t=this;p["a"].http(window.processForUrl.getUrlForInstanceId(e.id),"get","",{success:function(a){a.data&&a.data.data&&a.data.data.id?p["a"].http(window.processForUrl.getUrlForInstance(a.data.data.id),"Delete","",{success:function(a){e.status.dvalue=3,e.equipmentID=e.equipmentID[0],t.$Server.addOrUpdate(U.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),o["a"].alert("取消成功","success"))}),(function(e){o["a"].alert(e)}))},error:function(e){o["a"].alert(e)}}):(e.status.dvalue=3,e.equipmentID=e.equipmentID[0],t.$Server.addOrUpdate(U.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),o["a"].alert("取消成功","success"))}),(function(e){o["a"].alert(e)})))},error:function(e){o["a"].alert(e)}})},getQueryStringArgs:function(e){if(e&&e.length>0){var t=e.length>0?e.substring(1):"",a={},s=t.length?t.split("&"):[],n=null,r=null,i=null,o=0,d=s.length;for(o=0;o<d;o++)n=s[o].split("="),r=decodeURIComponent(n[0]),i=decodeURIComponent(n[1]),r.length&&(a[r]=i);return a}return{}},excuteTask:function(){var e=this;if(1!=e.$refs.childDataTable.getCheckItems().length)o["a"].alert("请选择一项作为你执行的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0];e.objectId=t.id;var a=sessionStorage.getItem("userId");"未开始"==t.status.dname?a==t.applicant?p["a"].http(window.processForUrl.getUrlForFirst(e.processKey),"get","",{success:function(t){var a=t.data.data,s=t.data.data.formKey,n={};s.indexOf("?")>-1&&(n=e.getQueryStringArgs(s.substring(s.indexOf("?"),s.length)),s=s.substring(0,s.indexOf("?")));var r=e.$getFrom("baseForm");r&&-1!=r&&(e.currentView=r,setTimeout((function(){e.$refs.componentForm.modalOpen(s,n,a)}),200))},error:function(e){o["a"].alert(e)}}):o["a"].alert("这条任务的负责人不是你！"):o["a"].alert("只有未开始的设备闲置处理任务才能执行！")}},tableAdd:function(){this.resetForm(),this.IsAddOp=!0,this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject)),this.detailForUpdate.applicantName=window.sessionStorage.getItem("uname"),this.detailForUpdate.userViewModel=[JSON.parse(sessionStorage.getItem("userViewModel"))],this.detailForUpdate.deadline=C()(new Date).format("YYYY-MM-DD"),this.title="添加闲置处理任务",this.IsShow=!0},tableEdit:function(){var e=this;if(e.resetFormValidation(),e.IsAddOp=!1,e.title="编辑闲置处理任务",1!=e.$refs.childDataTable.getCheckItems().length)o["a"].alert("请选择一项作为你修改的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0];"未开始"==t.status.dname?(e.detailForUpdate=JSON.parse(JSON.stringify(t)),e.$refs.addOrUpdate.changeSelected(t.equipmentID),e.detailForUpdate.userViewModel=[e.detailForUpdate.userViewModel],e.detailForUpdate.deadline=e.detailForUpdate.deadline.substring(0,10),e.IsShow=!0):o["a"].alert("只能对未开始的任务进行编辑")}},doSearch:function(){var e=this.$refs.childDataTable.getPagination();1==e.page?this.initTable(e):this.$refs.childDataTable.setPage(1)},clearMessage:function(){this.searchfx="",this.doSearch()},initTable:function(e){var t=this,a=this;e&&e.page||(e=this.$refs.childDataTable.getPagination()),a.$refs.childDataTable.unCheckItems(),a.DataSource=[],a.$Server.queryAll("EqpUnusedTrendTask",{page:e.page,rowsPerPage:e.rowsPerPage},{searchfx:a.searchfx}).then((function(e){a.DataSource=e.datas,t.total=e.page.total,a.DataSource.forEach((function(e){e.equipment&&(e.eqpCode=e.equipment.code,e.eqpName=e.equipment.name),e.equipmentID=[e.equipmentID],e.rentCompany=a.leaseCompanyList.find((function(t){return e.rentCompany==t.id})),e.status&&e.status.dname&&("未开始"==e.status.dname||"已取消"==e.status.dname)?e.statusName=a.$Utils.setStart(e.status.dname):e.status&&e.status.dname&&"进行中"==e.status.dname?e.statusName=a.$Utils.setRed(e.status.dname):e.status&&e.status.dname&&"已完成"==e.status.dname&&(e.statusName=a.$Utils.setSuccess(e.status.dname))}))}))},rowDbClick:function(e){this.detailForUpdate=JSON.parse(JSON.stringify(e)),this.titleForSee="查看任务详情",this.IsShowForSee=!0},modalComfirmed:function(){var e=this;1==e.$refs.addOrUpdate.validate()&&(e.detailForUpdate&&e.detailForUpdate.equipmentID&&Array.isArray(e.detailForUpdate.equipmentID)&&(e.detailForUpdate.equipmentID=e.detailForUpdate.equipmentID[0]),e.$Server.addOrUpdate(U.getModelName(),e.detailForUpdate,!e.IsAddOp).then((function(t){t.success&&(e.IsShow=!1,e.detailForUpdate=JSON.parse(JSON.stringify(e.initObject)),e.initTable(),o["a"].alert("保存成功","success"))}),(function(e){o["a"].alert(e)})))},modalClosed:function(){this.IsShow=!1,this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject))},resetFormValidation:function(){this.$refs.addOrUpdate.$refs.form.resetValidation()},resetForm:function(){this.$refs.addOrUpdate.$refs.form.reset(),this.$refs.addOrUpdate.$refs.form.resetValidation()},modalClosedForSee:function(){this.IsShowForSee=!1},cofirmDelete:function(){var e=this,t=this.$refs.childDataTable.getCheckItems();e.$Server.batchDelete(U.getModelName(),t).then((function(){e.initTable()}),(function(e){o["a"].alert(e)}))},tableDelete:function(){var e=this;if(e.$refs.childDataTable.getCheckItems().length<=0)o["a"].alert("请选中需要删除的项");else{for(var t=!0,a=0;a<e.$refs.childDataTable.getCheckItems().length;a++)if("未开始"!=e.$refs.childDataTable.getCheckItems()[a].status.dname){t=!1;break}t?m["a"].confirm("确定删除所选设备闲置处理?","提示",500,(function(){e.cofirmDelete()}),(function(){})):o["a"].alert("只有对未开始的闲置处理任务才能删除！")}}}},x=F,D=Object(w["a"])(x,s,n,!1,null,"32c53458",null);t["default"]=D.exports}}]);