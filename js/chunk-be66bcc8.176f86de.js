(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-be66bcc8"],{"123d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContentHeader",{attrs:{title:"点巡检计划",buttons:e.headerBtns}},[a("v-text-field",{staticStyle:{width:"330px"},attrs:{label:"请输入点巡检计划名称或计划编号","hide-details":"","single-line":"",clearable:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1),a("gridTemplate",{ref:"childGridTemplate",attrs:{title:"点巡检计划",gridModel:e.PointInspectionPlan,sort:!0},on:{afterInit:e.afterInit,rowDbClick:e.dbclick}}),a("contentModal",{attrs:{title:e.title,IsShow:e.IsShow,isDetails:e.isCannotEdit},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalConfirm()}}},[a("v-container",[a("v-form",{ref:"form"},[a("v-container",[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:"",sm6:"",md6:""}},[a("v-text-field",{attrs:{label:"计划编号",rules:[function(e){return!e||/^[\w|-]+$/.test(e)||"只能是数字,字母,下划线"}],disabled:e.isCannotEdit},model:{value:e.addItem.code,callback:function(t){e.$set(e.addItem,"code",t)},expression:"addItem.code"}})],1),a("v-flex",{attrs:{xs12:"",sm6:"",md6:""}},[a("v-text-field",{attrs:{rules:[e.rules.required],disabled:e.isCannotEdit},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                  点巡检计划名称"),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.addItem.name,callback:function(t){e.$set(e.addItem,"name",t)},expression:"addItem.name"}})],1),a("v-flex",{attrs:{xs12:"",sm6:"",md6:""}},[a("v-datetime-picker",{ref:"startDate",attrs:{label:"计划开始日期",clearText:"",okText:"确定",rules:[e.rules.required],"error-messages":e.startTimeerrorHints,prependIcon:"star",model:"String",locale:"zh-cn"},model:{value:e.addItem.startDate,callback:function(t){e.$set(e.addItem,"startDate",t)},expression:"addItem.startDate"}})],1),a("v-flex",{attrs:{xs12:"",sm6:"",md6:""}},[a("v-datetime-picker",{ref:"endDate",attrs:{label:"计划结束日期",clearText:"",okText:"确定",rules:[e.rules.required],"error-messages":e.errorHints,model:"String",prependIcon:"star",locale:"zh-cn"},model:{value:e.addItem.endDate,callback:function(t){e.$set(e.addItem,"endDate",t)},expression:"addItem.endDate"}})],1)],1)],1)],1),a("div",{attrs:{xs12:"",sm6:"",md6:""}},[a("v-layout",{attrs:{row:""}},[a("p",{staticStyle:{"font-size":"16px"}},[e._v("关联设备")]),a("div",[a("v-icon",{attrs:{disabled:e.isCannotEdit},on:{click:function(t){return e.addEquipment()}}},[e._v("add")]),a("v-icon",{attrs:{disabled:e.isCannotEdit},on:{click:function(t){return e.removeEquipment()}}},[e._v("remove")])],1)]),a("dataTable",{ref:"eqpDataTable",attrs:{headers:e.eqpheaders,DataSource:e.equipments,sort:!0,total:e.eqptotal,btLabel:e.btLabel,allowActive:e.isCannotEdit,hideOperation:!1},on:{rowClick:e.rowClick}}),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[e.isCannotEdit?e._e():a("v-radio-group",{attrs:{label:"生成方式",row:""},model:{value:e.addItem.generation,callback:function(t){e.$set(e.addItem,"generation",t)},expression:"addItem.generation"}},[a("v-radio",{attrs:{label:"立即生成工单",value:"true"}}),a("v-radio",{attrs:{label:"按计划生成工单",value:"false"}})],1)],1)],1)],1),a("EquipmentModalTemplate",{attrs:{IsShow:e.IsChooseEqpModelShow},on:{result:e.getResult,equipmentModalClosed:function(t){return e.equipmentModalClosed()},equipmentModalComfirmed:function(t){return e.equipmentModalComfirmed()}}}),a("contentModal",{attrs:{title:"查看点巡检内容",IsShow:e.IsPointstdShow},on:{modalClosed:function(t){return e.pointstdmodalClosed()},modalComfirmed:function(t){return e.pointstdmodalComfirmed()}}},[a("v-layout",{attrs:{wrap:"","align-end":""}},[a("v-flex",{attrs:{xs12:"",sm3:"",md3:""}},[a("v-layout",{attrs:{row:"","align-center":"","justify-start":""}},[a("v-flex",{attrs:{xs5:""}},[a("v-card",{staticStyle:{"padding-right":"0","margin-right":"0"},attrs:{tile:"",flat:""}},[a("v-card-text",[e._v("设备编号:")])],1)],1),a("v-flex",{attrs:{xs6:""}},[a("v-card",{attrs:{tile:"",flat:""}},[a("v-card-text",{staticClass:"px-0"},[e._v(e._s(e.rowDbClickItme.code))])],1)],1)],1)],1),a("v-flex",{attrs:{xs12:"",sm3:"",md3:""}},[a("v-layout",{attrs:{row:"","align-center":"","justify-start":""}},[a("v-flex",{attrs:{xs5:""}},[a("v-card",{staticStyle:{"padding-right":"0","margin-right":"0"},attrs:{tile:"",flat:""}},[a("v-card-text",[e._v("设备名称:")])],1)],1),a("v-flex",{attrs:{xs6:""}},[a("v-card",{attrs:{tile:"",flat:""}},[a("v-card-text",{staticClass:"px-0"},[e._v(e._s(e.rowDbClickItme.name))])],1)],1)],1)],1),a("v-flex",{attrs:{xs12:"",sm3:"",md3:""}},[a("v-layout",{attrs:{row:"","align-center":"","justify-start":""}},[a("v-flex",{attrs:{xs5:""}},[a("v-card",{staticStyle:{"padding-right":"0","margin-right":"0"},attrs:{tile:"",flat:""}},[a("v-card-text",[e._v("规格型号:")])],1)],1),a("v-flex",{attrs:{xs6:""}},[a("v-card",{attrs:{tile:"",flat:""}},[a("v-card-text",{staticClass:"px-0"},[e._v(e._s(e.rowDbClickItme.model))])],1)],1)],1)],1),a("v-flex",{attrs:{xs12:"",sm3:"",md3:""}},[a("v-layout",{attrs:{row:"","align-center":"","justify-start":""}},[a("v-flex",{attrs:{xs5:""}},[a("v-card",{staticStyle:{"padding-right":"0","margin-right":"0"},attrs:{tile:"",flat:""}},[a("v-card-text",[e._v("设备位置:")])],1)],1),a("v-flex",{attrs:{xs7:""}},[a("v-card",{attrs:{tile:"",flat:""}},[a("v-card-text",{staticClass:"px-0",staticStyle:{"font-size":"14px"}},[e._v(e._s(e.rowDbClickItme.factoryName))])],1)],1)],1)],1)],1),a("dataTable",{ref:"pointstdDataTable",attrs:{headers:e.pointstdheaders,DataSource:e.pointstds,sort:!1,allowActive:e.isCannotEdit,checkboxDisabled:!0,hideOperation:!0}})],1)],1)],1)],1)},r=[],n=a("3596"),s=(a("bada"),a("4634"),a("7300")),l=a("5873"),d=a("ddf2"),o=a("80ea"),c=a("ae0a"),m=a("97a3"),u=a("652a"),h=a("1269"),f=a("a7fe"),p=new u["a"],b=function(e){function t(){var e,a;Object(s["a"])(this,t);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return a=Object(l["a"])(this,(e=Object(d["a"])(t)).call.apply(e,[this].concat(r))),Object(m["a"])(Object(o["a"])(a),"__name","PointInspectionPlan"),Object(m["a"])(Object(o["a"])(a),"code",p.charField({require:!0,fieldName:"点巡检计划编号",editable:!0})),Object(m["a"])(Object(o["a"])(a),"name",p.charField({require:!0,fieldName:"点巡检计划名称",editable:!0})),Object(m["a"])(Object(o["a"])(a),"constructWayName",p.dateField({require:!0,fieldName:"生成方式"})),Object(m["a"])(Object(o["a"])(a),"constructByName",p.dateField({require:!0,fieldName:"生成维度"})),Object(m["a"])(Object(o["a"])(a),"startDate",p.dateField({require:!0,fieldName:"计划开始时间",editable:!0})),Object(m["a"])(Object(o["a"])(a),"endDate",p.dateField({require:!0,fieldName:"计划结束时间",editable:!0})),Object(m["a"])(Object(o["a"])(a),"actualStartDate",p.dateField({require:!0,fieldName:"实际开始时间",editable:!1})),Object(m["a"])(Object(o["a"])(a),"actualEndDate",p.dateField({require:!0,fieldName:"实际结束时间",editable:!1})),Object(m["a"])(Object(o["a"])(a),"statusName",p.dateField({require:!0,fieldName:"状态",editable:!1})),Object(m["a"])(Object(o["a"])(a),"status",p.comboBoxField(f["a"],{require:!1,visible:!1,editable:!1,fieldName:"状态",bindSource:{parms:{dname:"状态"}},format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),a}return Object(c["a"])(t,e),t}(h["a"]),v=a("7c02"),I=a("17cd"),g=a("8333"),S=a("d5b3"),C=a("b9da"),q=a("2edb"),x=a("f05f"),O=a("a2a7"),w=a("6e6d"),j=a("431e");a("8bad");w["default"].use(j["a"]);var k=new g["a"](new b),D=new g["a"](new I["a"]),$={name:"PointInspectionPlan",data:function(){var e=this;return{headerBtns:[{disabled:!this.$per("PointInspectionPlan","c"),text:"手动生成",click:function(){return e.gridAdd()},icon:"self_manualgeneration"},{disabled:!this.$per("PointInspectionPlan","u"),text:"编辑",icon:"self_edit",click:function(){return e.gridEdit()}},{disabled:!this.$per("PointInspectionPlan","d"),text:"删除",icon:"self_delete",click:function(){return e.gridDelete()}},{disabled:!this.$per("PointInspectionPlan","e"),text:"导出",click:function(){return e.exportFile()},icon:"self_export"}],eqpheaders:[{text:"编号",value:"",align:"center",sortable:!1},{text:"设备编号",value:"code",align:"center",sortable:!1},{text:"设备名称",value:"name",align:"center",sortable:!1},{text:"设备位置",value:"factoryName",align:"center",sortable:!1},{text:"操作",value:"",align:"center",sortable:!1}],pointstdheaders:[{text:"点巡检位置",value:"part",align:"center",sortable:!1},{text:"点巡检内容",value:"content",align:"center",sortable:!1},{text:"点巡检目的",value:"purposeName",align:"center",sortable:!1},{text:"点巡检方法",value:"method",align:"center",sortable:!1},{text:"标准描述",value:"standard",align:"center",sortable:!1},{text:"点巡检标准工时(分钟)",value:"spendTime",align:"center",sortable:!1},{text:"点巡检周期",value:"fullTime",align:"center",sortable:!1},{text:"点巡检设备状态",value:"eqpStatusName",align:"center",sortable:!1},{text:"上次点巡检时间",value:"lastInspectionTime",align:"center",sortable:!1}],rules:{required:function(e){return!!e||"必填项"}},isCannotEdit:!1,title:"",addItem:{},PointInspectionPlan:{},rowDbClickItme:{},searchValue:"",startTimeerrorHints:"",errorHints:"",btLabel:"",IsShow:!1,menu:!1,menu1:!1,total:1,IsPointstdShow:!1,IsChooseEqpModelShow:!1,equipments:[],pointstds:[],CCheckpointstds:[],selectPointStds:[],eqptotal:1,endDate:""}},components:{gridTemplate:C["a"],contentModal:O["a"],dataTable:x["a"],EquipmentModalTemplate:q["a"]},mounted:function(){this.PointInspectionPlan=new b,this.initialize()},methods:{afterInit:function(e){var t=this;e.forEach((function(e){(e.status&&"未开始"==e.status.dname||"已取消"==e.status.dname)&&(e.statusName=t.$Utils.setStart(e.status.dname)),e.status&&"进行中"==e.status.dname&&(e.statusName=t.$Utils.setRed(e.status.dname)),e.status&&"已完成"==e.status.dname&&(e.statusName=t.$Utils.setSuccess(e.status.dname))}))},initialize:function(){var e=this;this.$Server.queryAll((new v["a"]).__name,{},{}).then((function(t){e._eqps=t.datas}))},gridAdd:function(){this.addItem=JSON.parse(JSON.stringify({})),this.addItem.generation="false",this.addItem.startDate="",this.addItem.endDate="",this.$refs.form.resetValidation(),this.equipments=[],this.btLabel="选择点巡检标准内容",this.title="手动添加点巡检计划",this.IsShow=!0},gridDelete:function(){var e=this.$refs.childGridTemplate.getCheckItems();if(e.length>=1){this.addItem=JSON.parse(JSON.stringify(e[0]));for(var t=0;t<e.length;t++){if(1==e[t].constructWay)return void S["a"].alert("当前的计划为自动生成计划，不能删除");if(0!==e[t].status.dvalue)return void S["a"].alert("只有未开始的计划才能删除")}this.$refs.childGridTemplate.GridDelete()}else S["a"].alert("请选择一项作为你删除的对象")},gridEdit:function(){this.isCannotEdit=!1;var e=this.$refs.childGridTemplate.getCheckItems();if(1==e.length){var t=this,a=[];if(this.addItem=JSON.parse(JSON.stringify(e[0])),1==this.addItem.constructWay)return void S["a"].alert("当前的计划为自动生成计划，不能修改");if(0!=this.addItem.status.dvalue)return void S["a"].alert("当前的计划已"+this.addItem.status.dname+"，不能修改");this.addItem.pointInspectionStandards.forEach((function(e){0==a.length&&a.push(e.equipmentID),null==a.find((function(t){return t==e.equipmentID}))&&a.push(e.equipmentID)})),this._eqps.forEach((function(e){for(var i in a)e.id==a[i]&&t.equipments.push(e)})),this.addItem.generation="false",this.eqptotal=this.equipments.length,this.btLabel="选择点巡检标准内容",this.title="编辑点巡检计划",this.IsShow=!0}else S["a"].alert("请选择一项作为你编辑的对象")},modalClosed:function(){this.$refs.form.resetValidation(),this.IsShow=!1,this.isCannotEdit=!1,this.addItem=JSON.parse(JSON.stringify({})),this.$refs.endDate.clearHandler(),this.$refs.startDate.clearHandler(),this.errorHints="",this.startTimeerrorHints="",this.equipments=[]},modalConfirm:function(){var e=this;if(this.isCannotEdit)this.modalClosed();else{var t,a=function(){var a=e,i=[];if(a.$refs.form.validate()){if(""!=a.addItem.startDate&&""!=a.addItem.endDate){var r=Date.parse(a.addItem.startDate),n=Date.parse(a.addItem.endDate);if(t=new Date,r<t)return a.startTimeerrorHints="开始日期必须大于现在",{v:void 0};if(r>n)return a.errorHints=a.startTimeerrorHints="开始日期必须小于结束日期",{v:void 0};a.errorHints=a.startTimeerrorHints=""}var s=!(void 0==a.addItem.id);if(a.equipments.length>0){for(var l in a.equipments)void 0!=a.equipments[l].stdCheckItems&&a.equipments[l].stdCheckItems.length>0&&a.equipments[l].stdCheckItems.forEach((function(e){i.push(e)}));i.length>0?(a.addItem.pointInspectionStandards=i,a.$Server.addOrUpdate(k.getModelName(),a.addItem,s).then((function(e){e.success&&(a.modalClosed(),a.$refs.childGridTemplate.init(),S["a"].alert("保存成功","success"),a.addItem=JSON.parse(JSON.stringify({})),a.$refs.endDate.clearHandler(),a.$refs.startDate.clearHandler())}),(function(e){S["a"].alert(e)}))):void 0!=a.addItem.pointInspectionStandards&&a.addItem.pointInspectionStandards.length>0?a.$Server.addOrUpdate(k.getModelName(),a.addItem,s).then((function(e){e.success&&(a.modalClosed(),a.$refs.childGridTemplate.init(),S["a"].alert("保存成功","success"),a.addItem=JSON.parse(JSON.stringify({})),a.$refs.endDate.clearHandler(),a.$refs.startDate.clearHandler())}),(function(e){S["a"].alert(e)})):S["a"].alert("点巡检信息为空")}else S["a"].alert("设备信息为空")}}();if("object"===Object(n["a"])(a))return a.v}},addEquipment:function(){this.IsChooseEqpModelShow=!0},removeEquipment:function(){var e=this,t=this.$refs.eqpDataTable.getCheckItems();0===t.length?S["a"].alert("请选择删除的设备"):t.forEach((function(t){e.equipments.forEach((function(e,a,i){e.code==t.code&&i.splice(a,1)}))}))},getResult:function(e){var t=this;e.forEach((function(e){e.typeChinese=e.type.dname;var a=t.equipments.filter((function(t){return t.code===e.code}));0===a.length&&t.equipments.push(e)})),this.eqptotal=this.equipments.length},equipmentModalClosed:function(){this.IsChooseEqpModelShow=!1},equipmentModalComfirmed:function(){this.IsChooseEqpModelShow=!1},rowClick:function(e){this.rowDbClickItme=e;var t=this;this.$Server.queryAll(D.getModelName(),{},{eqpid:e.id,planId:this.addItem.id}).then((function(e){t.pointstds=e.datas,t.pointstds.forEach((function(e){void 0!=t.addItem.pointInspectionStandards&&t.addItem.pointInspectionStandards.length>0&&t.addItem.pointInspectionStandards.forEach((function(a){e.id==a.id&&(t.$refs.pointstdDataTable.setCheckItems(e),t.CCheckpointstds=JSON.parse(JSON.stringify(t.pointstds)))}))})),t.IsPointstdShow=!0}))},pointstdmodalClosed:function(){var e=this;e.CCheckpointstds.forEach((function(t){e.$refs.pointstdDataTable.setCheckItems(t)})),this.IsPointstdShow=!1},pointstdmodalComfirmed:function(){if(!this.isCannotEdit){var e=this.$refs.pointstdDataTable.getCheckItems();this.selectPointStds.length>0&&e.length>0?this.selectPointStds.concat(this.$refs.pointstdDataTable.getCheckItems()):this.selectPointStds=this.$refs.pointstdDataTable.getCheckItems(),this.rowDbClickItme.stdCheckItems=e}this.IsPointstdShow=!1},exportFile:function(){this.$Server.exportFile(k.getModelName(),"点巡检计划"+this.$Utils.getLocalFotmatTime())},doSearch:function(){var e=this;this.$refs.childGridTemplate.doSearch({like:e.searchValue})},clearMessage:function(){this.$refs.childGridTemplate.doSearch({})},input:function(){},dbclick:function(e){this.isCannotEdit=!0;var t=this,a=[];this.addItem=e,this.addItem.pointInspectionStandards.forEach((function(e){0==a.length&&a.push(e.equipmentID),null==a.find((function(t){return t==e.equipmentID}))&&a.push(e.equipmentID)})),t.equipments=[],this._eqps.forEach((function(e){for(var i in a)e.id==a[i]&&t.equipments.push(e)})),this.eqptotal=this.equipments.length,this.title="查看点巡检计划",this.btLabel="查看点巡检标准内容",this.IsShow=!0,this.IsShow=!0}}},T=$,y=a("6691"),N=Object(y["a"])(T,i,r,!1,null,null,null);t["default"]=N.exports},"17cd":function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var i=a("7300"),r=a("5873"),n=a("ddf2"),s=a("80ea"),l=a("ae0a"),d=a("97a3"),o=a("652a"),c=a("1269"),m=a("d685"),u=a("a7fe"),h=new o["a"],f=function(e){function t(){var e,a;Object(i["a"])(this,t);for(var l=arguments.length,o=new Array(l),c=0;c<l;c++)o[c]=arguments[c];return a=Object(r["a"])(this,(e=Object(n["a"])(t)).call.apply(e,[this].concat(o))),Object(d["a"])(Object(s["a"])(a),"__name","PointInspectionStandard"),Object(d["a"])(Object(s["a"])(a),"equipmentID",h.comboBoxField(m["a"],{require:!0,fieldName:"设备名称",bindSource:{value:"id",text:"name"},visible:!1,editable:!1})),Object(d["a"])(Object(s["a"])(a),"equipmentCode",h.charField({require:!0,fieldName:"设备编号",editable:!1})),Object(d["a"])(Object(s["a"])(a),"equipmentName",h.charField({require:!0,fieldName:"设备名称",editable:!1})),Object(d["a"])(Object(s["a"])(a),"model",h.charField({require:!0,fieldName:"规格型号",editable:!1})),Object(d["a"])(Object(s["a"])(a),"location",h.charField({require:!0,fieldName:"设备位置",visible:!1,editable:!1})),Object(d["a"])(Object(s["a"])(a),"part",h.charField({require:!0,fieldName:"点巡检位置",visible:!1})),Object(d["a"])(Object(s["a"])(a),"content",h.charField({require:!0,fieldName:"点巡检内容"})),Object(d["a"])(Object(s["a"])(a),"purpose",h.comboBoxField(u["a"],{require:!0,fieldName:"点巡检目的",visible:!0,bindSource:{parms:{dname:"保养目的"}},format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),Object(d["a"])(Object(s["a"])(a),"method",h.charField({require:!0,fieldName:"点巡检方法",visible:!0})),Object(d["a"])(Object(s["a"])(a),"standard",h.charField({require:!0,fieldName:"点巡检标准"})),Object(d["a"])(Object(s["a"])(a),"fullSpendTime",h.charField({require:!1,fieldName:"标准点巡检工时",editable:!1})),Object(d["a"])(Object(s["a"])(a),"spendTime",h.numberField("int",{require:!0,fieldName:"标准点巡检工时",visible:!1})),Object(d["a"])(Object(s["a"])(a),"fullTime",h.charField({require:!1,fieldName:"点巡检周期",editable:!1})),Object(d["a"])(Object(s["a"])(a),"eqpStatus",h.comboBoxField(u["a"],{require:!0,fieldName:"点巡检设备状态",visible:!0,bindSource:{parms:{dname:"设备状态"}},format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),Object(d["a"])(Object(s["a"])(a),"period",h.numberField("int",{require:!0,fieldName:"点巡检周期",visible:!1})),Object(d["a"])(Object(s["a"])(a),"periodUnit",h.comboBoxField(u["a"],{require:!0,visible:!1,fieldName:"点巡检周期单位",bindSource:{parms:{dname:"周期单位"}},format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),Object(d["a"])(Object(s["a"])(a),"lastInspectionTime",h.charField({require:!1,fieldName:"上次点巡检时间",visible:!0,editable:!1,format:function(e){if(e)return e.substring(0,16)}})),Object(d["a"])(Object(s["a"])(a),"description",h.charField({require:!1,fieldName:"备注",visible:!1,editable:!1})),Object(d["a"])(Object(s["a"])(a),"description",h.charField({require:!1,fieldName:"备注",visible:!1,editable:!1})),Object(d["a"])(Object(s["a"])(a),"isDataRecord",h.boolField({require:!0,fieldName:"数值记录",boolSelect:[],parms:{type:"10"},format:function(e){return e?"有":"无"}})),Object(d["a"])(Object(s["a"])(a),"nextInspectionTime",h.charField({require:!1,fieldName:"下次点巡检时间",visible:!1,editable:!1})),Object(d["a"])(Object(s["a"])(a),"pointItem",h.charField({require:!1,fieldName:"点检/巡检",visible:!0,editable:!1})),a}return Object(l["a"])(t,e),t}(c["a"])},"2edb":function(e,t,a){"use strict";var i,r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-dialog",{attrs:{"max-width":"1000px",persistent:!0,scrollable:""},model:{value:e.IsShow,callback:function(t){e.IsShow=t},expression:"IsShow"}},[a("v-card",[a("v-card-title",{staticClass:"primary"},[a("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v(e._s(e.title))])]),a("v-card-text",[a("v-container",{staticStyle:{padding:"0"},attrs:{"grid-list-md":"","text-md-center":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:"",sm2:""}},[a("treeCombo",{attrs:{Source:e.dataSource,MultipleSelect:!1,label:"工厂产线架构",independentCheck:!1,independentSingleCheck:!0,"item-value":"id","item-text":"oname",clearable:"","return-object":""},on:{cleared:e.clearSearch},model:{value:e.equipmentPosition,callback:function(t){e.equipmentPosition=t},expression:"equipmentPosition"}})],1),a("v-flex",{attrs:{xs12:"",ms2:"",md2:""}},[a("v-select",{attrs:{items:e.equipType,label:"设备类型","item-value":"dvalue","item-text":"dname",clearable:"","single-line":""},on:{"click:clear":e.clearSearch},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1),a("v-flex",{attrs:{xs12:"",sm2:""}},[a("v-text-field",{attrs:{label:"设备编号",clearable:"","single-line":""},on:{"click:clear":e.clearSearch},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),a("v-flex",{attrs:{xs12:"",sm2:""}},[a("v-text-field",{attrs:{label:"设备名称",clearable:"","single-line":""},on:{"click:clear":e.clearSearch},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),a("v-flex",{attrs:{xs3:""}},[a("v-btn",{attrs:{color:"default","d-flex":""},on:{click:function(t){return e.Search()}}},[e._v("查询")]),a("v-btn",{attrs:{color:"default","d-flex":""},on:{click:function(t){return e.clearSearch()}}},[e._v("清空查询")])],1)],1)],1),a("gridTemplate2",{ref:"childGridTemplate",attrs:{title:"设备台账",gridModel2:e.equipmentModal,sort:!0,initCondition:e.initCondition}})],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.equipmentModalComfirmed()}}},[e._v("确定")]),a("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.equipmentModalClosed()}}},[e._v("取消")])],1)],1)],1)},n=[],s=(a("7cfd"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,sort:e.sort,DataSource:e.DataSource,hideOperation:!0,formatFields:e.FormatFields,total:e.total},on:{rowDbClick:e.rowDbClick,initialize:e.init}}),a("contentModal",{attrs:{title:e.title1,IsShow:e.IsShow,width:e.width},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[a("formTemplate",{ref:"childForm",attrs:{editors:e.editors,editedItem:e.editedItem}},[e._t("default")],2)],1),a("comfirmModal",{attrs:{title:"提示",IsShow:e.IsComfirmShow,text:e.deleteTittle},on:{modalComfirmedClose:function(t){return e.modalComfirmedClose()},modalComfirmed:function(t){return e.cofirmDelete()}}})],1)}),l=[],d=(a("ed8b"),a("4634"),a("de90"),a("8f42"),a("a2a7")),o=a("23f5"),c=a("71ba"),m=a("f05f"),u=a("8333"),h=a("d5b3"),f={name:"gridTemplate2",props:{gridModel2:{type:Object,required:!0},title:{type:String,required:!0},sort:{type:Boolean,default:!1},width:{type:Number},initCondition:{type:Object}},data:function(){return{valid:!0,IsShow:!1,IsComfirmShow:!1,IsLoading:!0,editors:[],totalDatas:0,total:1,DataSource:[],headers:[],editedItem:{},search:"",deletItems:[],FormatFields:{},currentparams:{},isAddOrUpdate:!0,title1:"",deleteTittle:"",likeParent:{}}},components:{contentModal:d["a"],comfirmModal:o["a"],dataTable:m["a"],formTemplate:c["a"]},watch:{gridModel2:{handler:function(e){i=new u["a"](e),this.headers=i.formatGridHeader(),!0===this.sort&&this.headers.unshift({text:"序号",align:"center",sortable:!1});var t=i.getEditFields();t.sort((function(e,t){var a=0;return e.formOrder<t.formOrder&&(a=-1),e.formOrder>t.formOrder&&(a=1),a})),this.editors=t,this.$emit("editorsReCode",t),this.FormatFields=i.getFormatFields()}}},methods:{init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;null!=e.page&&(this.currentparams=e);var a=this.currentparams,r=a.page,n=a.rowsPerPage;t.initCondition&&Object.keys(t.initCondition).forEach((function(e){t.likeParent[e]=t.initCondition[e]})),this.$Server.queryAll(i.getModelName(),{page:r,rowsPerPage:n},t.likeParent).then((function(e){t.DataSource=e.datas,t.total=e.page.total,t.$emit("afterInit",t.DataSource),null!=t.$refs.childDataTable.getCheckItems()&&t.$refs.childDataTable.getCheckItems().length>0&&t.$refs.childDataTable.unCheckItems()}),(function(e){return h["a"].alert(e)}))},doSearch:function(e){this.likeParent=e;var t=this.currentparams.page;1==t?this.init():this.$refs.childDataTable.setPage(1)},getPages:function(e){this.params=e},rowDbClick:function(e){this.$emit("rowDbClick",e)},GridDelete:function(){this.$refs.childDataTable.getCheckItems().length<=0?h["a"].alert("请选中需要删除的项"):(this.deleteTittle="确定删除所选"+this.title+"?",this.IsComfirmShow=!0)},getSelectedItems:function(){return this.$refs.childDataTable.getCheckItems()},unCheckItems:function(){return this.$refs.childDataTable.unCheckItems()},cofirmDelete:function(){var e=this.getSelectedItems();this.$emit("beforeExcuteDelete",e);var t=this;this.$Server.batchDelete(i.getModelName(),e).then((function(){t.IsComfirmShow=!1,t.init(t.currentparams)}),(function(e){t.IsComfirmShow=!1,h["a"].alert(e)}))},GridAdd:function(){this.editedItem={},this.$emit("beforeAdd",this.editedItem),this.IsShow=!0,this.$refs.childForm.resetValid(),this.$refs.childForm.resetForm(),this.title1="添加"+this.title},GridEdit:function(){var e=this;if(e.title1="编辑"+e.title,1!=e.$refs.childDataTable.getCheckItems().length)h["a"].alert("请选择一项作为你修改的对象");else{e.editedItem={};var t=e.$refs.childDataTable.getCheckItems()[0],a=t.id,i=t.createTime,r=t.updateTime,n=t.creator,s=t.modifier;e.editedItem={id:a,createTime:i,updateTime:r,creator:n,modifier:s},e.editors.forEach((function(a){a.field&&(e.editedItem[a.field]=t[a.field])})),e.$refs.childForm.resetValid(),e.$emit("beforeEdit",e.editedItem,t),e.IsShow=!0}},modalClosed:function(){this.$emit("beforeCancel"),this.IsShow=!1},modalComfirmed:function(){var e=this,t=this.$refs.childForm.getValues();this.$emit("beforeEditSubmit",t),0==this.$refs.childForm.getValid()?h["a"].alert("验证不通过"):e.isAddOrUpdate&&(e.isAddOrUpdate=!1,e.$Server.addOrUpdate(i.getModelName(),t,t.id).then((function(a){a.success&&(e.IsShow=!1,t.id&&(e.$refs.childDataTable.unCheckItems(),e.$refs.childDataTable.setCheckItems(t)),e.init(e.currentparams),h["a"].alert("保存成功","success"),e.$emit("afterCommitSuccess"),e.isAddOrUpdate=!0)}),(function(t){h["a"].alert(t),e.isAddOrUpdate=!0})))},modalComfirmedClose:function(){this.IsComfirmShow=!1},getCheckItems:function(){return this.$refs.childDataTable.getCheckItems()}}},p=f,b=a("6691"),v=Object(b["a"])(p,s,l,!1,null,null,null),I=v.exports,g=a("f19a"),S=a("7c02"),C=a("a7fe"),q=a("4027"),x={name:"equipmentModal",data:function(){return{title:"选择设备",equipmentModal:{},equipType:[],type:"",code:"",name:"",equipmentPosition:"",dataSource:[]}},mounted:function(){console.log(22222222),console.log(this.initCondition),this.init()},watch:{},computed:{},methods:{equipmentModalClosed:function(){this.$emit("equipmentModalClosed"),this.init(),this.$refs.childGridTemplate.init()},equipmentModalComfirmed:function(){this.$refs.childGridTemplate.getSelectedItems().length<=0?h["a"].alert("请选中需要确定的项"):(this.$emit("result",this.$refs.childGridTemplate.getSelectedItems()),this.$emit("equipmentModalComfirmed"),this.init(),this.$refs.childGridTemplate.unCheckItems(),this.$refs.childGridTemplate.init())},init:function(){var e=this;e.equipmentModal={},e.equipType=[],e.type="",e.code="",e.name="",e.equipmentPosition="",e.dataSource=[],this.equipmentModal=new S["a"],this.$Server.queryAll((new C["a"]).__name,{},{type:"4"}).then((function(t){e.equipType=t.datas})),this.$Server.queryAll((new q["a"]).__name,{},{searchEqpStation:!0}).then((function(t){e.dataSource=t.datas}))},Search:function(){var e=[],t=this;e={name:this.name,code:this.code,type:this.type,model:this.model,equipmentPosition:this.equipmentPosition&&this.equipmentPosition.length>0?this.equipmentPosition[0]:""},e.deleted=this.initCondition.deleted,e.eStatus=this.initCondition.eStatus,this.$Server.queryAll((new S["a"]).__name,{},e).then((function(e){t.$refs.childGridTemplate.DataSource=e.datas,t.$refs.childGridTemplate.total=e.total}))},clearSearch:function(){this.equipmentPosition="",this.name="",this.code="",this.type="",this.model="",this.$refs.childGridTemplate.init()}},components:{gridTemplate2:I,treeCombo:g["a"]},props:{IsShow:{type:Boolean,default:!1},initCondition:{type:Object,default:function(){var e={deleted:!1,eStatus:[0,1,2,4]};return e}}}},O=x,w=Object(b["a"])(O,r,n,!1,null,null,null);t["a"]=w.exports}}]);