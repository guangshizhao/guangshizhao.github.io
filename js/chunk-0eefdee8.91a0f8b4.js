(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0eefdee8"],{"19d8":function(e,t,i){},"24f0":function(e,t,i){"use strict";var a=i("f92e"),n=i.n(a);n.a},"29be":function(e,t,i){},"39e8":function(e,t,i){"use strict";var a=i("29be"),n=i.n(a);n.a},"863f":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("layContentHeader",{attrs:{title:"培训路径",buttons:e.headerBtns}}),i("layContent",[i("v-layout",[i("layContentLeft",{attrs:{title:"知识分类",IsShowTitle:!1,id:"layoutLeft"}},[i("v-tabs",{staticClass:"showtabs",attrs:{color:"primary",grow:"","hide-slider":""},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[i("v-tab",{staticStyle:{color:"#ffffff"}},[e._v("技能")]),i("v-tab",{staticStyle:{color:"#ffffff"}},[e._v("人员")]),i("v-tab-item",{staticStyle:{"padding-top":"10px"}},[i("div",{staticStyle:{height:"calc(100% - 63px)"}},[i("div",{staticClass:"selfvuetree",staticStyle:{margin:"0px"},attrs:{id:"tree"},on:{click:function(e){e.stopPropagation()}}},[i("v-tree",{ref:"childTreeView",attrs:{data:e.treeSource,radio:!0},on:{"node-select":e.changedSkill}})],1)])]),i("v-tab-item",{staticStyle:{"padding-top":"10px"}},[i("div",{staticStyle:{height:"calc(100% - 63px)"}},[i("div",{staticClass:"selfvuetree",staticStyle:{margin:"0px"},attrs:{id:"tree1"}},[i("v-tree",{ref:"childTreeView1",attrs:{data:e.userTreeSource,radio:!0},on:{"node-select":e.changedUser}})],1)])])],1)],1),i("layContentRight",[0==e.active?i("v-container",{staticStyle:{padding:"0px 20px 20px 20px","max-width":"none"}},[i("v-layout",{staticStyle:{padding:"30px 0px"}},[i("horizontal-tree",{ref:"traingPath",attrs:{traningPathList:e.traningPathList},on:{selectIndex:e.selectEditCourse}})],1),i("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,DataSource:e.DataSource,totalDatas:e.totalDatas,hideOperation:!0,formatFields:e.formatFields,total:e.total},on:{initialize:e.findUsersByOrgId}})],1):e._e(),1==e.active?i("v-container",{staticStyle:{padding:"30px 20px 20px 20px","max-width":"none"}},[i("v-layout",[i("v-flex",{attrs:{xs4:""}},[i("p",[i("span",{staticClass:"self-title"},[e._v("人员工号:")]),e._v(e._s(e.userViewModel.jobNumber))])]),i("v-flex",{attrs:{xs4:""}},[i("p",[i("span",{staticClass:"self-title"},[e._v("人员姓名:")]),e._v(e._s(e.userViewModel.uname))])]),i("v-flex",{attrs:{xs4:""}},[i("p",[i("span",{staticClass:"self-title"},[e._v("人员技能:")]),e._v(e._s(e.userViewModel.skillNames))])])],1),i("v-layout",{attrs:{wrap:""}},[i("v-flex",{staticStyle:{"margin-top":"15px"},attrs:{xs12:""}},[i("p",[i("span",{staticClass:"self-title"},[e._v("参与中培训:")]),e._v(e._s(e.userViewModel.trainCourseNames))])]),i("v-flex",{staticStyle:{"margin-top":"15px"},attrs:{xs12:""}},[i("p",[i("span",{staticClass:"self-title"},[e._v("已参与培训:")]),e._v(e._s(e.userViewModel.finishCourseNames))])]),i("v-flex",{staticStyle:{"margin-top":"15px"},attrs:{xs12:""}},[i("p",[i("span",{staticClass:"self-title"},[e._v("已预约培训:")]),e._l(e.userViewModel.orderCourse,(function(t){return i("span",{key:t.id},[e._v("\n                  "+e._s(t&&t.trainingNode?t.trainingNode:"")+"\n                  "),e.selectUser.id===e.userId?i("v-icon",{on:{click:function(i){return e.deleteAppointment(t)}}},[e._v("clear")]):e._e()],1)}))],2)]),i("v-flex",{attrs:{xs12:""}},[e.selectUser.id===e.userId?i("p",[i("span",{staticClass:"self-title"},[e._v("可参与培训:")]),i("span",{staticStyle:{"vertical-align":"middle",width:"300px",display:"inline-block","margin-left":"20px"}},[i("v-select",{attrs:{items:e.skillList,clearable:"","item-text":"sname","return-object":""},on:{change:function(t){return e.changedSelected(e.skill)}},model:{value:e.skill,callback:function(t){e.skill=t},expression:"skill"}})],1),i("v-btn",{staticClass:"primary",on:{click:e.appointment}},[e._v("培训预约")])],1):e._e()])],1),i("v-layout",[i("horizontal-tree",{ref:"appTainingPath",attrs:{traningPathList:e.appTraningPathList},on:{selectIndex:e.selectAppCourse}})],1)],1):e._e()],1)],1)],1),i("contentModal",{attrs:{title:"添加节点",IsShow:e.isShowAdd},on:{modalClosed:e.modalClosedAdd,modalComfirmed:e.modalComfirmedAdd}},[i("v-form",{ref:"addForm",attrs:{valid:"true","lazy-validation":""}},[i("v-text-field",{attrs:{label:"节点名称",rules:[function(e){return!!e||"必填项"}]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n          节点名称 "),i("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.addNodeName,callback:function(t){e.addNodeName=t},expression:"addNodeName"}})],1)],1),i("contentModal",{attrs:{title:"编辑节点",IsShow:e.isShowEdit},on:{modalClosed:e.modalClosedEdit,modalComfirmed:e.modalComfirmedEdit}},[i("v-form",{ref:"editForm",attrs:{valid:"true","lazy-validation":""}},[i("v-text-field",{attrs:{label:"节点名称",rules:[function(e){return!!e||"必填项"}]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n          节点名称 "),i("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.editTrainingPath.trainingNode,callback:function(t){e.$set(e.editTrainingPath,"trainingNode",t)},expression:"editTrainingPath.trainingNode"}})],1)],1),i("comfirmModal",{attrs:{title:"提示",IsShow:e.isShowDelete,text:"确定删除所选路径节点？"},on:{modalComfirmedClose:function(t){return e.modalComfirmedClose()},modalComfirmed:function(t){return e.cofirmDelete()}}}),i("comfirmModal",{attrs:{title:"提示",IsShow:e.isShowDelApp,text:"确定取消选中预约课程？"},on:{modalComfirmedClose:function(t){return e.modalComfirmedClose()},modalComfirmed:function(t){return e.cofirmDeleteApp()}}})],1)},n=[],s=i("3596"),r=(i("7cfd"),i("4634"),i("f05f")),l=i("7300"),d=i("5873"),o=i("ddf2"),c=i("80ea"),h=i("ae0a"),u=i("97a3"),f=i("652a"),p=i("1269"),m=new f["a"],v=(p["a"],i("8333")),S=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tree-wrapper"},e._l(e.traningPathList,(function(t,a){return i("div",{key:a,staticClass:"tree-node",class:{bordernone:0==a||Array.isArray(t)&&1==t.length},style:{height:Array.isArray(t)&&t.length>=1?40*t.length+15*(t.length-1)+"px":"",border:0==a||Array.isArray(t)&&1==t.length?"none":"",background:Array.isArray(t)&&t.length>=1?"transparent":"",width:Array.isArray(t)&&t.length>1?"240px":""}},[Array.isArray(t)&&t.length>=1?e._l(t,(function(t,n){return i("div",{key:n,staticClass:"tree-node-children",class:{active:a===e.selectNodeIndex&&e.selectInnerIndex===n},on:{click:function(i){return i.stopPropagation(),e.selectNode(a,t,n)}}},[i("div",{staticClass:"overflow",attrs:{title:t.trainingNode}},[e._v(e._s(t.trainingNode))])])})):e._e()],2)})),0)},g=[],b={data:function(){return{name:"HorizontalTree",selectNodeIndex:"",selectInnerIndex:""}},props:{traningPathList:Array},methods:{selectNode:function(e,t,i){this.selectNodeIndex=e,this.selectInnerIndex=i,this.$emit("selectIndex",e,t)},cancleSelectNode:function(e){this.selectNodeIndex="",this.selectInnerIndex="",this.$emit("selectIndex","","")}},mounted:function(){document.addEventListener("click",this.cancleSelectNode)},destroyed:function(){document.removeEventListener("click",this.cancleSelectNode)}},x=b,I=(i("eca4"),i("39e8"),i("6691")),P=Object(I["a"])(x,S,g,!1,null,"a667717e",null),y=P.exports,k=i("d5b3"),D=i("a2a7"),N=i("23f5"),T=i("a7fe"),w=new f["a"],A=function(e){function t(){var e,i;Object(l["a"])(this,t);for(var a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];return i=Object(d["a"])(this,(e=Object(o["a"])(t)).call.apply(e,[this].concat(n))),Object(u["a"])(Object(c["a"])(i),"__name","TrainingPerson"),Object(u["a"])(Object(c["a"])(i),"trainingID",w.charField({visible:!1,editable:!1,fieldName:"培训任务"})),Object(u["a"])(Object(c["a"])(i),"personID",w.charField({visible:!1,editable:!1,fieldName:"培训人员"})),Object(u["a"])(Object(c["a"])(i),"jobNumber",w.charField({editable:!1,fieldName:"工号"})),Object(u["a"])(Object(c["a"])(i),"personName",w.charField({editable:!1,fieldName:"姓名"})),Object(u["a"])(Object(c["a"])(i),"org",w.charField({visible:!1,editable:!1,fieldName:"所属部门"})),Object(u["a"])(Object(c["a"])(i),"type",w.charField({visible:!1,editable:!1,fieldName:"类型"})),Object(u["a"])(Object(c["a"])(i),"state",w.comboBoxField(T["a"],{require:!1,fieldName:"培训状态",colspan:"md4",bindSource:{parms:{dname:"培训状态"}},format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),Object(u["a"])(Object(c["a"])(i),"examineResult",w.comboBoxField(T["a"],{require:!1,fieldName:"考核状态",colspan:"md4",bindSource:{parms:{dname:"考核状态"}},format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),Object(u["a"])(Object(c["a"])(i),"checkinRresult",w.comboBoxField(T["a"],{visible:!1,require:!1,fieldName:"签到结果",colspan:"md4",bindSource:{parms:{dname:"签到结果"}},format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),Object(u["a"])(Object(c["a"])(i),"evaluation",w.charField({visible:!1,editable:!1,fieldName:"培训评价"})),Object(u["a"])(Object(c["a"])(i),"trainingBeginTime",w.charField({fieldName:"培训时间",format:function(e){if(e)return e.substring(0,10)}})),i}return Object(h["a"])(t,e),t}(p["a"]),L=i("681f"),C=new v["a"](new A),_={name:"TrainingPath",data:function(){var e=this;return{userId:sessionStorage.userId,headerBtns1:[{disabled:!this.$per("TrainingPath","c"),text:"添加",icon:"self_add",click:function(){return e.addTrainingPath()}},{disabled:!this.$per("TrainingPath","u"),text:"编辑",icon:"self_edit",click:function(){return e.editTrainPath()}},{disabled:!this.$per("TrainingPath","d"),text:"删除",icon:"self_delete",click:function(){return e.deleteTrainPath()}}],headers:C.formatGridHeader(),formatFields:C.getFormatFields(),totalDatas:0,total:1,treeSource:[],userTreeSource:[],active:null,selectUser:{id:sessionStorage.userId},selectSkill:"",traningPathList:[],selectPathEdit:"",addTraningPathList:[],selectPathIndex1:"",appTraningPathList:[],selectPathIndex2:"",isShow:!1,isShowAdd:!1,addNodeName:"",DataSource:[],selectAddNode:{},userViewModel:{},skillList:[],skill:{},selectAppNode:{},editTrainingPath:{},isShowEdit:!1,isShowDelete:!1,isShowDelApp:!1,deleteApp:{}}},computed:{headerBtns:function(){return 0==this.active?this.headerBtns1:[]}},components:{dataTable:r["a"],HorizontalTree:y,contentModal:D["a"],comfirmModal:N["a"]},mounted:function(){this.initializa(),this.findUserByID(),this.findSkillByUserID()},methods:{initializa:function(){var e=this;this.$Server.queryAll("PositionTrainUser").then((function(t){if(t.datas&&t.datas.length>0){var i=[],a=[];t.datas.forEach((function(e){var t={};t.id=e.id,t.title=e.name,t.name=e.name,t.parentID=e.parentId?e.parentId:"",t.expanded=!0,i.push(t),a.push(t),e.positionSkillList&&e.positionSkillList.length>0&&e.positionSkillList.forEach((function(t){var a={};a.id=t.id,a.name=t.sname,a.title='<span style="color:#4ba77d">'.concat(t.sname,"</span>"),a.parentID=e.id,a.sname=t.sname,a.isSkill=!0,a.skillID=t.skillID,a.expanded=!0,i.push(a)})),e.userList&&e.userList.length>0&&e.userList.forEach((function(t){var i={};i.id=t.id,i.name=t.uname,i.title=t.name,i.loginName=t.loginName,i.parentID=e.id,i.isUser=!0,i.expanded=!0,a.push(i)}))})),e.treeSource=e.setTree(i),e.userTreeSource=e.setTree(a)}}))},findSkillByUserID:function(){var e=this;this.$Server.queryAll("Skill").then((function(t){e.skillList=t.datas}))},findUserByID:function(){var e=this,t="";t=this.selectUser&&this.selectUser.id?this.selectUser.id:sessionStorage.getItem("userId"),this.$Server.queryObjectById("UserSkillTrain",t).then((function(t){e.userViewModel=t.data.data}))},treeObj:function(e){var t={};for(var i in e){var a=e[i];t[i]="object"===Object(s["a"])(a)?arguments.callee(a):a}return t["children"]=[],t},setTree:function(e){for(var t=e,i=[],a=this,n=0;n<t.length;n++)""!==t[n].parentID&&null!==t[n].parentID&&"-1"!==t[n].parentID||(i.push(a.treeObj(t[n])),t.splice(n,1),n--);function s(e){if(0!==t.length)for(var i=0;i<e.length;i++){for(var n=0;n<t.length;n++)if(e[i].id===t[n].parentID){var r=a.treeObj(t[n]);e[i].children.push(r),t.splice(n,1),n--}s(e[i].children)}}return s(i),i},changedSkill:function(e){this.DataSource=[],this.$refs.traingPath.selectNodeIndex="",this.$refs.traingPath.selectInnerIndex="";var t=this;this.selectSkill=e,e&&e.id&&1==e.isSkill?this.selectSkill&&this.selectSkill.id&&this.$Server.queryAll("TrainingPath",{},{positionSkillID:e.skillID}).then((function(e){e.datas&&e.datas[0]&&e.datas[0].pathDetailList?t.traningPathList=t.toTreeList(e.datas[0].pathDetailList):t.traningPathList=[]})):e&&e.id&&(void 0==e.isSkill||null==e.isSkill||""==e.isSkill)&&t.$refs.childTreeView.nodeSelected({})},changedSelected:function(e){var t=this;e&&e.id?this.$Server.queryAll("TrainingPath",{},{positionSkillID:e.id}).then((function(e){e.datas&&e.datas[0]&&e.datas[0].pathDetailList?t.appTraningPathList=t.toTreeList(e.datas[0].pathDetailList):t.appTraningPathList=[]})):t.appTraningPathList=[]},toTreeList:function(e){for(var t=e,i={},a=[],n=0;n<t.length;n++){var s=t[n];if(i[s.orderIndex])for(var r=0;r<a.length;r++){var l=a[r];if(l.orderIndex==s.orderIndex){l.data.push(s);break}}else a.push({orderIndex:s.orderIndex,name:s.name,data:[s]}),i[s.orderIndex]=s}var d=[];return a.forEach((function(e){d.push(e.data)})),d},changedUser:function(e){e&&e.id&&1==e.isUser?(this.skill={},this.selectUser=e,this.selectAppNode={},this.appTraningPathList=[],this.findUserByID(),this.findSkillByPositionId(e.parentID)):e&&e.id&&(void 0==e.isUser||null==e.isUser||""==e.isUser)&&this.$refs.childTreeView1.nodeSelected({})},findSkillByPositionId:function(e){var t=this;this.$Server.queryAll("Skill").then((function(e){t.skillList=e.datas}))},findUsersByOrgId:function(){},selectEditCourse:function(e,t){var i=this;this.selectPathEdit=t,t&&t.id&&this.$Server.queryAll("TrainingPathDetail",{},{id:t.id}).then((function(e){e.datas&&(e.datas[0].trainingPersonList?(i.DataSource=e.datas[0].trainingPersonList,i.total=e.datas[0].trainingPersonList.length):i.DataSource=[])}))},selectAppCourse:function(e,t){t&&(this.selectAppNode=t,console.log(t))},appointment:function(){var e=this,t="";if(t=this.selectUser?this.selectUser.id:sessionStorage.getItem("userId"),this.selectAppNode&&this.selectAppNode.id){if(this.userViewModel.finishCourse&&this.userViewModel.finishCourse.indexOf(this.selectAppNode.id)>-1)return void L["a"].confirm(" 您已参加过该课程的培训，是否确认再次参与培训?","提示",500,(function(){var i={trainingPathDetailID:e.selectAppNode.id,userID:t};e.$Server.addOrUpdate("TrainingAppointment",i,!1).then((function(t){t.success?(k["a"].alert("预约成功","success"),e.findUserByID()):k["a"].alert("预约失败")}),(function(e){return k["a"].alert(e)}))}),(function(){}));var i={trainingPathDetailID:this.selectAppNode.id,userID:t};this.$Server.addOrUpdate("TrainingAppointment",i,!1).then((function(t){t.success?(k["a"].alert("预约成功","success"),e.findUserByID()):k["a"].alert("预约失败")}),(function(e){return k["a"].alert(e)}))}else k["a"].alert("请选择要预约的培训课程")},deleteAppointment:function(e){this.deleteApp=e,this.isShowDelApp=!0},cofirmDeleteApp:function(){var e=this;this.$Server.delete("TrainingAppointment",this.deleteApp).then((function(t){t.success&&(k["a"].alert("取消成功","success"),e.deleteApp={},e.isShowDelApp=!1,e.findUserByID())}),(function(e){return k["a"].alert(e)}))},selectIndex1:function(e,t){this.selectPathIndex2=e},addTrainingPath:function(){this.selectSkill&&this.selectSkill.id?(this.isShowAdd=!0,this.$refs.addForm.resetValidation()):k["a"].alert("请选择一个学习路径")},editTrainPath:function(){this.selectPathEdit&&this.selectPathEdit.id?(this.isShowEdit=!0,this.$refs.editForm.resetValidation(),this.editTrainingPath=Object.assign({},this.selectPathEdit)):k["a"].alert("请选择一个节点")},deleteTrainPath:function(){this.selectPathEdit&&this.selectPathEdit.id?this.isShowDelete=!0:k["a"].alert("请选择要删除的项")},addPathNode:function(){this.isShowAdd=!0},deletePathNode:function(){""===this.selectPathIndex1?k["a"].alert("请选择一个节点"):this.traningPathList1.splice(this.selectPathIndex1,1)},modalComfirmed:function(){this.isShow=!1},modalClosed:function(){this.isShow=!1},modalComfirmedAdd:function(){var e=this;if(""===this.addNodeName)k["a"].alert("请输入名字");else{var t=1;if(t=this.selectPathEdit?this.selectPathEdit.orderIndex+1:1,this.$refs.addForm.validate()){var i={positionSkillID:this.selectSkill.skillID,trainingNode:this.addNodeName,orderIndex:t};this.$Server.addOrUpdate("TrainingPathDetail",i,!1).then((function(t){t.success&&(k["a"].alert("保存成功","success"),e.isShowAdd=!1,e.addNodeName="",e.editTrainingPath={},e.selectSkill&&e.selectSkill.id&&e.$Server.queryAll("TrainingPath",{},{positionSkillID:e.selectSkill.skillID}).then((function(t){t.datas&&t.datas[0]&&t.datas[0].pathDetailList?e.traningPathList=e.toTreeList(t.datas[0].pathDetailList):e.traningPathList=[]})))}),(function(e){return k["a"].alert(e)}))}}},modalComfirmedEdit:function(){var e=this;this.$refs.editForm.validate()&&this.$Server.addOrUpdate("TrainingPathDetail",this.editTrainingPath,!0).then((function(t){t.success&&(k["a"].alert("保存成功","success"),e.isShowEdit=!1,e.selectSkill&&e.selectSkill.id&&e.$Server.queryAll("TrainingPath",{},{positionSkillID:e.selectSkill.id}).then((function(t){t.datas&&t.datas[0]&&t.datas[0].pathDetailList?e.traningPathList=e.toTreeList(t.datas[0].pathDetailList):e.traningPathList=[]})))}),(function(e){return k["a"].alert(e)}))},modalClosedAdd:function(){this.$refs.addForm.resetValidation(),this.addNodeName="",this.isShowAdd=!1},modalClosedEdit:function(){this.isShowEdit=!1,this.$refs.editForm.resetValidation()},modalComfirmedClose:function(){this.isShowDelete=!1,this.isShowDelApp=!1},cofirmDelete:function(){var e=this;this.$Server.delete("TrainingPathDetail",this.selectPathEdit).then((function(t){t.success&&(k["a"].alert("删除成功","success"),e.isShowDelete=!1,e.selectSkill&&e.selectSkill.id&&e.$Server.queryAll("TrainingPath",{},{positionSkillID:e.selectSkill.id}).then((function(t){t.datas&&t.datas[0]&&t.datas[0].pathDetailList?e.traningPathList=e.toTreeList(t.datas[0].pathDetailList):e.traningPathList=[]})))}),(function(e){return k["a"].alert(e)}))},handleSelect:function(){this.selectPathIndex1="",this.$refs.hTree1.selectNodeIndex=""},unSelectNode:function(){this.$refs.childTreeView.nodeSelected({}),this.traningPathList=[],this.selectPathEdit={},this.editTrainingPath={},this.selectSkill={}}},destroyed:function(){}},O=_,j=(i("24f0"),Object(I["a"])(O,a,n,!1,null,"17c03dfc",null));t["default"]=j.exports},eca4:function(e,t,i){"use strict";var a=i("19d8"),n=i.n(a);n.a},f92e:function(e,t,i){}}]);