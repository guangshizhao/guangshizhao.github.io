(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-df4fbd8e"],{"0c10":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-form",{ref:"form1",attrs:{"lazy-validation":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"取消原因",rules:[e.rules.required]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            取消原因: "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.item.cancelReason,callback:function(t){e.$set(e.item,"cancelReason",t)},expression:"item.cancelReason"}})],1)],1)],1)],1)],1)},r=[],i=(a("d5b3"),{name:"CancelTask",data:function(){return{rules:{required:function(e){return!!e||"必填项"}}}},props:["item"],methods:{validate:function(){return 1==this.$refs.form1.validate()},resetValid:function(){this.$refs.form1.resetValidation(),this.$refs.form1.reset()}}}),n=i,l=a("6691"),o=Object(l["a"])(n,s,r,!1,null,"058eafcc",null);t["a"]=o.exports},"85cb":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContentHeader",{attrs:{title:"设备租赁",buttons:e.headerBtns}},[a("v-text-field",{staticStyle:{width:"350px"},attrs:{label:"输入租赁单编号,设备名称或申请人","hide-details":"","single-line":"",primary:"",clearable:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchfx,callback:function(t){e.searchfx=t},expression:"searchfx"}})],1),a("layContent",[a("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,sort:e.sort,DataSource:e.DataSource,hideOperation:!0,formatFields:e.formatFields,total:e.total},on:{rowDbClick:e.rowDbClick,initialize:e.initTable}}),a("contentModal",{attrs:{title:e.title,IsShow:e.IsShow,width:"1100"},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[a("EqpRentalTaskDetail",{ref:"addOrUpdate",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:e.titleForSee,IsShow:e.IsShowForSee,width:"1100",isDetails:!0},on:{modalClosed:function(t){return e.modalClosedForSee()}}},[a("eqpRentalTaskSee",{ref:"See",attrs:{item:e.detailForUpdate}})],1),a(e.currentView,{ref:"componentForm",tag:"component",attrs:{PreviewType:e.PreviewType,objectId:e.objectId},on:{modalComfirmed:e.formComfirmed}}),a("contentModal",{attrs:{title:"租赁结果",IsShow:e.IsShowForSeeResult,width:"1100",isDetails:!0},on:{modalClosed:function(t){return e.modalClosedForSeeResult()}}},[a("eqpRentalTaskSeeResult",{ref:"SeeResult",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:"取消原因",IsShow:e.IsShowCancelTask,width:"1100"},on:{modalComfirmed:function(t){return e.modalComfirmedCancelTask()},modalClosed:function(t){return e.modalClosedCancelTask()}}},[a("CancelTask",{ref:"CancelTask",attrs:{item:e.detailForUpdate}})],1)],1)],1)},r=[],i=(a("7cfd"),a("4634"),a("e6d1"),a("de90"),a("0b34"),a("0c10")),n=a("f800"),l=a("d5b3"),o=a("8333"),d=a("a2a7"),c=a("23f5"),u=a("681f"),m=a("531b"),f=a("f05f"),h=a("ab47"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("租赁单编号："+e._s(e.item.rentalCode))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("最迟到货日期："+e._s(e.item.latestTime&&e.item.latestTime.substring(0,10)))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("申请人："+e._s(e.item.applicantName))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("数量："+e._s(e.item.rentalCount))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("设备名称："+e._s(e.item.equipmentDirectoryName))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("规格型号："+e._s(e.item.equipmentDirectoryViewModel.model))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("设备类型："+e._s(e.item.type))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("租赁原因："+e._s(e.item.reason))])])],1),a("v-layout",{attrs:{row:"",wrap:""}},[e.item.rRentalTaskDocumentList&&e.item.rRentalTaskDocumentList.length>0?a("v-flex",{attrs:{xs12:""}},e._l(e.item.rRentalTaskDocumentList,(function(e,t){return a("div",{key:t},[a("view-file",{attrs:{documentViewModel:e.documentViewModel,color:"primary"}})],1)})),0):e._e()],1),a("v-layout",{attrs:{row:"",wrap:""}},[e.item.status&&"已取消"==e.item.status.dname?a("v-flex",{staticStyle:{"margin-top":"15px"},attrs:{xs12:""}},[a("p",[e._v("取消原因："+e._s(e.item.cancelReason))])]):e._e(),e.item.status&&0!=e.item.status.dvalue&&e.isImageSrcShow?a("v-flex",{attrs:{xs12:""}}):e._e(),!e.item.status||1!==e.item.status.dvalue&&2!==e.item.status.dvalue?e._e():a("v-flex",{attrs:{xs12:""}},[a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("任务进度:")])]),e.imageSrc?a("img",{attrs:{src:e.imageSrc}}):e._e()])],1)],1)},v=[],g=a("551a"),w={name:"EqpRentalTaskSee",data:function(){return{imageSrc:"",isImageSrcShow:!1}},watch:{item:{handler:function(e){this.isImageSrcShow=!1,e&&e.status&&0!=e.status.dvalue&&this.seeTrace()},deep:!0}},props:{item:Object},methods:{getDocumentName:function(e){if(e)return e.newestFilePath?e.dname+e.newestFilePath.substring(e.newestFilePath.lastIndexOf(".")):""},downloadDocument:function(e,t){var a=document.createElement("a");a.href=e.newestFilePath,a.download=t,a.click()},seeTrace:function(){var e=this;g["a"].http(window.processForUrl.getUrlForInstanceId(e.item.id),"get","",{success:function(t){if(t.data&&t.data.data&&t.data.data.id){var a=t.data.data.id;e.seeImage(a)}}})},seeImage:function(e){var t=this;g["a"].http(window.processForUrl.getUrlForInstanceTrace(e),"get",{},{success:function(e){t.imageSrc=e.data.data.image,t.isImageSrcShow=!0}})}}},S=w,b=a("6691"),T=Object(b["a"])(S,p,v,!1,null,null,null),k=T.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("div",[e._v("实际到货日期:"+e._s(e.item.latestTime&&e.item.latestTime.substring(0,10)))]),a("h5",[e._v("租赁清单：")]),a("v-layout",[a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("设备名称:"+e._s(e.item.equipmentDirectoryName))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("规格型号:"+e._s(e.item.model))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("设备类型:"+e._s(e.item.type))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("数量："+e._s(e.item.rentalCount))])])],1),a("h5",[e._v("租赁验收结果")]),a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.items,"hide-actions":""},scopedSlots:e._u([{key:"items",fn:function(t){return[a("tr",e._l(e.headers,(function(s,r){return a("td",{key:r,staticClass:"text-xs-center"},["acceptanceResult"===s.value?[e._v("\n                            "+e._s(1===t.item[s.value]?"通过":0===t.item[s.value]?"未通过":"")+"\n                        ")]:[e._v(e._s(t.item[s.value]))]],2)})),0)]}}])})],1)},I=[],C=(a("f1ac"),{data:function(){return{headers:[{text:"出厂编号",align:"center",sortable:!1,value:"productionNo"},{text:"生产厂商",align:"center",value:"manufacturer",sortable:!1},{text:"验收是否通过",align:"center",value:"acceptanceResult",sortable:!1},{text:"验收部门",align:"center",value:"acceptanceDepartName",sortable:!1},{text:"备注",align:"center",value:"description",sortable:!1}],items:[]}},props:{item:Object},watch:{item:{handler:function(e){if(e.id){var t=this;t.$Server.queryAll("EqpRentalRecord",{},{rentalTaskID:e.id}).then((function(e){t.items=e.datas}),(function(e){return Message.alert(e)}))}},deep:!0}}}),F=C,D=Object(b["a"])(F,x,I,!1,null,null,null),_=D.exports,y=a("6bf2"),$=a.n(y),U=new o["a"](new n["a"]),O=sessionStorage.uname,R=sessionStorage.userId,q={name:"EqpRentalTask",data:function(){var e=this;return{initObject:{id:"",rentalCode:"",name:"",model:"",type:"",latestTime:"",applicant:"",applicantName:"",rentalCount:"",reason:"",status:"",rRentalTaskDocumentList:[],equipmentDirectory:"",equipmentDirectoryName:"",equipmentDirectoryViewModel:{}},IsShowCancelTask:!1,formatFields:U.getFormatFields(),searchfx:"",sort:!0,total:1,DataSource:[],title:"",IsShow:!1,IsAddOp:!0,detailForUpdate:{equipmentDirectoryViewModel:{}},IsComfirmShow:!1,deleteTittle:"",IsShowForSee:!1,titleForSee:"",headerBtns:[{disabled:!this.$per("EqpRentalTask","c"),text:"添加",icon:"self_add",click:function(){return e.tableAdd()}},{disabled:!this.$per("EqpRentalTask","u"),text:"编辑",icon:"self_edit",click:function(){return e.tableEdit()}},{disabled:!this.$per("EqpRentalTask","d"),text:"删除",icon:"self_delete",click:function(){return e.tableDelete()}},{disabled:!this.$per("EqpRentalTask","exe"),text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}},{disabled:!this.$per("EqpRentalTask","cancel"),text:"取消",icon:"self_cancel",click:function(){return e.cancelTask()}},{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(e){return"/api/EqpRentalTask"==e.pvalue&&"查看结果"==e.pname}))),text:"查看结果",icon:"self_look",click:function(){return e.showResult()}}],IsShowForSeeResult:!1,processKey:window.process.EqpRentalTask,PreviewType:1,objectId:"",currentView:""}},components:{contentModal:d["a"],comfirmModal:c["a"],dataTable:f["a"],EqpRentalTaskDetail:h["a"],eqpRentalTaskSee:k,eqpRentalTaskSeeResult:_,CancelTask:i["a"]},computed:{headers:function(){var e=U.formatGridHeader();return!0===this.sort&&e.unshift({text:"序号",align:"center",sortable:!1}),e}},methods:{modalClosedForSeeResult:function(){this.IsShowForSeeResult=!1},showResult:function(){var e=this;if(1!=e.$refs.childDataTable.getCheckItems().length)l["a"].alert("请选择一项作为你查看的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0];2===t.status.dvalue?(e.detailForUpdate=Object.assign({},t),e.IsShowForSeeResult=!0):l["a"].alert("未完成的任务不能查看")}},formComfirmed:function(){this.initTable()},modalComfirmedCancelTask:function(){var e=this;1==e.$refs.CancelTask.validate()?(e.cofirmCancel(e.detailForUpdate),e.IsShowCancelTask=!1):l["a"].alert("验证错误")},modalClosedCancelTask:function(){var e=this;e.IsShowCancelTask=!1},cancelTask:function(){var e=this,t=e.$refs.childDataTable.getCheckItems();1!=t.length?l["a"].alert("请选择一项作为你取消的对象"):"进行中"==t[0].status.dname?t[0].applicant!==sessionStorage.getItem("userId")?l["a"].alert("您不是该任务的申请人，不能取消"):(e.detailForUpdate=JSON.parse(JSON.stringify(t[0])),e.$refs.CancelTask.resetValid(),e.IsShowCancelTask=!0):l["a"].alert("只有对进行中的任务才能取消！")},cofirmCancel:function(e){var t=this;m["a"].http(window.processForUrl.getUrlForInstanceId(e.id),"get","",{success:function(a){a.data&&a.data.data&&a.data.data.id?m["a"].http(window.processForUrl.getUrlForInstance(a.data.data.id),"Delete","",{success:function(a){e.status.dvalue=3,t.$Server.addOrUpdate(U.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),l["a"].alert("取消成功","success"))}),(function(e){l["a"].alert(e)}))},error:function(e){l["a"].alert(e)}}):(e.status.dvalue=3,t.$Server.addOrUpdate(U.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),l["a"].alert("取消成功","success"))}),(function(e){l["a"].alert(e)})))},error:function(e){l["a"].alert(e)}})},getQueryStringArgs:function(e){if(e&&e.length>0){var t=e.length>0?e.substring(1):"",a={},s=t.length?t.split("&"):[],r=null,i=null,n=null,l=0,o=s.length;for(l=0;l<o;l++)r=s[l].split("="),i=decodeURIComponent(r[0]),n=decodeURIComponent(r[1]),i.length&&(a[i]=n);return a}return{}},excuteTask:function(){var e=this;if(1!=e.$refs.childDataTable.getCheckItems().length)l["a"].alert("请选择一项作为你执行的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0],a=sessionStorage.getItem("userId");e.objectId=t.id,"未开始"==t.status.dname?a==t.userViewModel.id?m["a"].http(window.processForUrl.getUrlForFirst(e.processKey),"get","",{success:function(t){var a=t.data.data,s=t.data.data.formKey,r={};s.indexOf("?")>-1&&(r=e.getQueryStringArgs(s.substring(s.indexOf("?"),s.length)),s=s.substring(0,s.indexOf("?")));var i=e.$getFrom("baseForm");i&&-1!=i&&(e.currentView=i,setTimeout((function(){e.$refs.componentForm.modalOpen(s,r,a)}),200))},error:function(e){l["a"].alert(e)}}):l["a"].alert("这条任务的负责人不是你！"):l["a"].alert("只有对未开始的任务才能执行！")}},tableAdd:function(){var e=this;this.resetForm(),this.IsAddOp=!0,this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject)),this.detailForUpdate.latestTime=$()(new Date).format("YYYY-MM-DD"),this.detailForUpdate.applicant=R,this.detailForUpdate.applicantName=O,this.detailForUpdate.userViewModel=[JSON.parse(sessionStorage.getItem("userViewModel"))],this.title="添加租赁任务",this.$nextTick((function(){e.$refs.addOrUpdate.displayCheck=!0})),this.$refs.addOrUpdate.getEqp().then((function(t){e.IsShow=!0}))},tableEdit:function(){var e=this;if(e.resetFormValidation(),e.IsAddOp=!1,e.title="编辑租赁任务",1!=e.$refs.childDataTable.getCheckItems().length)l["a"].alert("请选择一项作为你修改的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0];1===t.status.dvalue||2===t.status.dvalue?l["a"].alert("任务进行中或已完成不能编辑"):(e.$refs.addOrUpdate.displayCheck=!0,e.$refs.addOrUpdate.getEqp().then((function(a){null==t.rRentalTaskDocumentList&&(t.rRentalTaskDocumentList=[]),e.detailForUpdate=JSON.parse(JSON.stringify(t)),e.$refs.addOrUpdate.equipmentDirectory=[t.equipmentDirectory],e.$refs.addOrUpdate.type=t.type,e.detailForUpdate.userViewModel&&(e.detailForUpdate.userViewModel=[e.detailForUpdate.userViewModel]),e.IsShow=!0})))}},doSearch:function(){var e=this.$refs.childDataTable.getPagination();1==e.page?this.initTable(e):this.$refs.childDataTable.setPage(1)},clearMessage:function(){this.searchfx="",this.doSearch()},initTable:function(e){var t=this;e&&e.page||(e=this.$refs.childDataTable.getPagination()),t.$Server.queryAll(U.getModelName(),{page:e.page,rowsPerPage:e.rowsPerPage},{like:t.searchfx}).then((function(e){t.$refs.childDataTable.unCheckItems(),t.DataSource=e.datas,t.DataSource.forEach((function(e){e.equipmentDirectoryName=e.equipmentDirectoryViewModel.name,e.model=e.equipmentDirectoryViewModel.model})),t.total=e.page.total,t.DataSource&&t.DataSource.length>0&&t.DataSource.forEach((function(e){e.status&&e.status.dname&&("未开始"==e.status.dname||"已取消"==e.status.dname)?e.statusName=t.$Utils.setStart(e.status.dname):e.status&&e.status.dname&&"进行中"==e.status.dname?e.statusName=t.$Utils.setRed(e.status.dname):e.status&&e.status.dname&&"已完成"==e.status.dname&&(e.statusName=t.$Utils.setSuccess(e.status.dname))}))}),(function(e){}))},rowDbClick:function(e){this.detailForUpdate=JSON.parse(JSON.stringify(e)),this.titleForSee="查看任务详情",this.IsShowForSee=!0},modalComfirmed:function(){var e=this;1==e.$refs.addOrUpdate.validate()&&(Array.isArray(e.detailForUpdate.userViewModel)&&e.detailForUpdate.userViewModel.length>0&&(e.detailForUpdate.userViewModel=e.detailForUpdate.userViewModel[0]),e.$Server.addOrUpdate(U.getModelName(),e.detailForUpdate,!e.IsAddOp).then((function(t){t.success&&(e.IsShow=!1,e.detailForUpdate={equipmentDirectoryViewModel:{}},e.initTable(),l["a"].alert("保存成功","success"))}),(function(e){l["a"].alert(e)})))},modalClosed:function(){this.IsShow=!1,this.detailForUpdate={equipmentDirectoryViewModel:{}}},resetFormValidation:function(){this.$refs.addOrUpdate.$refs.form.resetValidation()},resetForm:function(){this.$refs.addOrUpdate.$refs.form.reset(),this.$refs.addOrUpdate.$refs.form.resetValidation()},modalClosedForSee:function(){this.$refs.See.imageSrc="",this.IsShowForSee=!1},cofirmDelete:function(){var e=this,t=this.$refs.childDataTable.getCheckItems();e.$Server.batchDelete(U.getModelName(),t).then((function(){e.IsComfirmShow=!1,e.initTable()}),(function(t){e.IsComfirmShow=!1,l["a"].alert(t)}))},tableDelete:function(){var e=this;if(e.$refs.childDataTable.getCheckItems().length<=0)l["a"].alert("请选中需要删除的项");else{for(var t=e.$refs.childDataTable.getCheckItems(),a=0;a<t.length;a++)if(1===t[a].status.dvalue||2===t[a].status.dvalue)return void l["a"].alert("进行中或已完成的任务不能删除");u["a"].confirm("确定删除所选设备租赁?","提示",500,(function(){e.cofirmDelete()}),(function(){}))}}}},M=q,V=Object(b["a"])(M,s,r,!1,null,null,null);t["default"]=V.exports},f1ac:function(e,t){}}]);