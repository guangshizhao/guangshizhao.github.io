(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60eefe4f"],{1903:function(t,e,i){},"34d2":function(t,e,i){},"6f16":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{height:"100%"}},[i("layContentHeader",{attrs:{title:"库位管理",buttons:t.headerBtns}}),i("v-container",{staticClass:"class1",staticStyle:{margin:"0","min-height":"94%",border:"1px silver solid",width:"100%"},attrs:{"grid-list-md":"","text-xs-center":"",id:"divlist"}},[i("v-layout",{attrs:{wrap:""}},t._l(t.locationList,(function(e){return i("div",{key:e.id,staticClass:"flexFixed",staticStyle:{width:"138px",height:"90px","margin-right":"15px","margin-bottom":"15px"}},[i("v-card",{style:t.selectItmes.includes(e)?"color:white;height:90px":"height:90px",attrs:{color:t.selectItmes.includes(e)?"primary":""},on:{click:function(i){return t.getActive(e)},dblclick:function(i){return t.storageDetail(e)}}},[i("v-card-text",{staticClass:"px-0"},[i("p",{staticStyle:{"margin-top":"20px"}}),i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(s){var a=s.on;return[i("span",t._g({},a),[t._v(t._s((e.slcode&&e.slcode.length)>6?e.slcode.substring(0,7)+"...":e.slcode))])]}}],null,!0)},[i("span",[t._v(t._s(e.slcode))])])],1)],1)],1)})),0)],1),i("contentModal",{attrs:{title:t.title,IsShow:t.IsShow,width:"1200px"},on:{modalClosed:function(e){return t.modalClosed()},modalComfirmed:function(e){return t.modalComfirmed()}}},[i("v-container",{attrs:{"grid-list-md":""}},[i("v-layout",{attrs:{wrap:"",row:""}},[0==t.isUpdate?i("v-flex",{attrs:{xs11:"",sm11:"",md11:""}},[i("v-btn",{attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:function(e){return t.addRow()}}},[i("v-icon",[t._v("\n              add\n            ")])],1),i("v-btn",{attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:t.deleteRow}},[i("v-icon",[t._v("\n              remove\n            ")])],1)],1):t._e()],1),i("v-form",{ref:"form"},t._l(t.locations,(function(e,s){return i("v-layout",{key:s,staticStyle:{"padding-left":"20px"},style:t.selectLocation.includes(s)?"background: #E3F2FD":"",attrs:{wrap:"",row:""},on:{click:function(i){return t.getClick(e,s)}}},[t._l(t.editLocation,(function(s){return i("v-flex",{key:s.field},["库位编号"==s.text?i("v-text-field",{attrs:{label:s.text,rules:[function(t){return t&&t.length<36||!t||0==t.length||"超出最大长度"}]},model:{value:e[s.value],callback:function(i){t.$set(e,s.value,i)},expression:"los[item.value]"}}):t._e(),"长"==s.text?i("div",{staticStyle:{color:"rgba(0,0,0,.54)","margin-top":"21px","font-size":"16px",display:"inline-block",width:"80px"}},[t._v("库位大小：")]):t._e(),"长"==s.text?i("div",{staticStyle:{display:"inline-block",width:"calc(100% - 80px)"}},["长"==s.text?i("v-text-field",{attrs:{label:"长",type:"number",min:"0",rules:[function(t){return!!t||"必填项"},function(t){return/^(\d|[1-9]\d+)(\.\d{0,2})?$/.test(t)&&t>0||"填大于0的数字，最多两位小数"}]},scopedSlots:t._u([{key:"label",fn:function(){return[t._v("\n                  长 "),i("span",{staticStyle:{color:"red"}},[t._v("*")])]},proxy:!0}],null,!0),model:{value:e[s.value],callback:function(i){t.$set(e,s.value,i)},expression:"los[item.value]"}}):t._e()],1):t._e(),"宽"==s.text?i("v-text-field",{attrs:{label:"宽",type:"number",min:"0",rules:[function(t){return!!t||"必填项"},function(t){return/^(\d|[1-9]\d+)(\.\d{0,2})?$/.test(t)&&t>0||"填大于0的数字，最多两位小数"}]},scopedSlots:t._u([{key:"label",fn:function(){return[t._v("\n                宽 "),i("span",{staticStyle:{color:"red"}},[t._v("*")])]},proxy:!0}],null,!0),model:{value:e[s.value],callback:function(i){t.$set(e,s.value,i)},expression:"los[item.value]"}}):t._e(),"高"==s.text?i("v-text-field",{attrs:{label:"高",type:"number",min:"0",rules:[function(t){return!!t||"必填项"},function(t){return/^(\d|[1-9]\d+)(\.\d{0,2})?$/.test(t)&&t>0||"填大于0的数字，最多两位小数"}]},scopedSlots:t._u([{key:"label",fn:function(){return[t._v("\n                高 "),i("span",{staticStyle:{color:"red"}},[t._v("*")])]},proxy:!0}],null,!0),model:{value:e[s.value],callback:function(i){t.$set(e,s.value,i)},expression:"los[item.value]"}}):t._e()],1)})),i("v-flex",{staticStyle:{"margin-left":"20px","font-size":"12px","min-width":"90px",padding:"0px","line-height":"76px"}},[t._v("(单位：CM)")])],2)})),1)],1)],1),i("contentModal",{attrs:{title:"库位详情",IsShow:t.IsShowDetails,isDetails:!0},on:{modalClosed:function(e){return t.modalClosed()}}},[i("v-container",{attrs:{"grid-list-md":""}},[i("v-layout",{attrs:{row:""}},[i("v-flex",{attrs:{xs3:""}},[t._v("\n          库位编号："+t._s(t.detailItem.slcode)+"\n        ")]),i("v-flex",{attrs:{xs3:""}},[i("span",[t._v("库位大小：")]),t._v("\n          长："+t._s(t.detailItem.length)+" CM\n        ")]),i("v-flex",{attrs:{xs2:""}},[t._v("\n          宽："+t._s(t.detailItem.width)+" CM\n        ")]),i("v-flex",{attrs:{xs2:""}},[t._v("\n          高："+t._s(t.detailItem.height)+" CM\n        ")])],1),i("v-layout",{attrs:{row:""}},[i("v-flex",{attrs:{xs12:""}},[i("p",{staticStyle:{"font-weight":"bold"}},[t._v("存放备件信息")])])],1),i("v-layout",{attrs:{row:""}},[i("v-flex",{attrs:{xs12:""}},[i("SimpleDataTable",{attrs:{items:t.detailItem.sparePositions,headers:t.headers,hideHeaders:!1}})],1)],1)],1)],1),i("comfirmModal",{attrs:{title:"提示",IsShow:t.IsComfirmShow,text:"是否确定删除所选项？"},on:{modalComfirmedClose:function(e){return t.modalComfirmedClose()},modalComfirmed:function(e){return t.cofirmDelete()}}}),i("contentModal",{attrs:{title:"导入库位",IsShow:t.IsShowImport},on:{modalClosed:function(e){return t.modalClosedImport()},modalComfirmed:function(e){return t.ComfirmImport()}}},[i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("v-btn",{staticClass:"mb-2",attrs:{color:"primary",dark:""},on:{click:t.downloadTemp}},[t._v("下载导入模板")]),i("div",{staticStyle:{color:"red","font-size":"12px"}},[t._v("\n        (注:文档内标题标红的列为必填项，请勿输入以下非法字符：~、@、$、^、&、《、》、<、>、￥)\n      ")])],1),i("UploadFile",{ref:"uploadFile",attrs:{label:"导入文件"},on:{formData:t.getFormData},model:{value:t.base64,callback:function(e){t.base64=e},expression:"base64"}})],1)],1)},a=[],n=(i("7cfd"),i("40c5"),i("23cc"),i("4634"),i("0b34"),i("3f83")),o=i("a2a7"),l=i("23f5"),r=i("55b3"),c=i("07c5"),d=i("8333"),u=i("a7fe"),f=i("d5b3"),h=i("ef3e"),m=i("debc"),p=i.n(m),v=new d["a"](new n["a"]),g=(new d["a"](new u["a"]),{data:function(){var t=this;return{locationList:[],temporary:{},IsShow:!1,locations:[],editLocation:v.formatGridHeader(),isUpdate:!1,IsComfirmShow:!1,storageId:"",selectItmes:[],IsShowDetails:!1,detailItem:{sparePositions:[]},headerBtns:[{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(t){return"/api/Storage"==t.pvalue&&"库位管理"==t.pname}))),text:"添加",icon:"self_add",click:function(){return t.GridAdd()}},{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(t){return"/api/Storage"==t.pvalue&&"库位管理"==t.pname}))),text:"编辑",icon:"self_edit",click:function(){return t.GridEdit()}},{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(t){return"/api/Storage"==t.pvalue&&"库位管理"==t.pname}))),text:"删除",icon:"self_delete",click:function(){return t.deleteItems()}},{disabled:!1,text:"取消选中",icon:"",click:function(){return t.uncheck()}},{disabled:!1,text:"返回",icon:"self_return",click:function(){return t.backstorage()}}],headers:[{text:"备件编号",value:"code",align:"center",sortable:!1},{text:"备件名称",value:"sparePartsID",align:"center",sortable:!1},{text:"规格型号",value:"model",align:"center",sortable:!1},{text:"数量",value:"stock",align:"center",sortable:!1},{text:"备件好坏",value:"stypeName",align:"center",sortable:!1}],selectLocation:[],IsShowImport:!1,base64:"",title:""}},components:{SimpleDataTable:h["a"],contentModal:o["a"],comfirmModal:l["a"],layContentHeader:c["a"],UploadFile:r["a"]},mounted:function(){this.storageId=this.$route.query.storageId,this.initialize()},methods:{getAllCount:function(){var t=p()("#divlist").width(),e=p()("#divlist").height(),i=parseInt(t/153),s=parseInt(e/105);return i*s},initialize:function(){var t=this;this.selectItmes=[];var e=this.getAllCount(),i=[];0==this.storageId.length||null==this.storageId||""==this.storageId?this.$Server.queryAll(v.getModelName(),n["a"]).then((function(s){var a=s.datas.length;if(s.datas.forEach((function(t){i.push(t)})),a>=e)t.locationList=i;else{for(var n=0;n<e-a;n++)i.push({});t.locationList=i,p()(window).resize((function(){t.locationList=[],setTimeout((function(){var e=t.getAllCount(),i=[];if(s.datas.forEach((function(t){i.push(t)})),a>=e)t.locationList=i;else{for(var n=0;n<e-a;n++)i.push({});t.locationList=i}}),100)}))}})):this.$Server.queryAll(v.getModelName(),n["a"],{storageId:t.storageId},{page:"-1",rowsPerPage:"-1"}).then((function(s){var a=s.datas.length;if(s.datas.forEach((function(t){i.push(t)})),a>=e)t.locationList=i;else{for(var n=0;n<e-a;n++)i.push({});t.locationList=i,p()(window).resize((function(){t.locationList=[],setTimeout((function(){var e=t.getAllCount(),i=[];if(s.datas.forEach((function(t){i.push(t)})),a>=e)t.locationList=i;else{for(var n=0;n<e-a;n++)i.push({});t.locationList=i}}),100)}))}}))},getActive:function(t){this.selectItmes.includes(t)?this.selectItmes.splice(this.selectItmes.findIndex((function(e){return e==t})),1):this.selectItmes.push(t)},uncheck:function(){this.selectItmes=[]},GridAdd:function(){this.locations=[],this.$refs.form.resetValidation(),""==this.storageId?f["a"].alert("请选择一个仓库"):(this.IsShow=!0,this.isUpdate=!1,this.title="添加库位",this.locations.push({storageId:this.storageId}))},deleteItems:function(){this.selectItmes.length<=0?f["a"].alert("请选择要删除的数据"):this.IsComfirmShow=!0},modalClosed:function(){this.IsShow=!1,this.IsShowDetails=!1,0==this.isUpdate&&(this.editedItem=[])},modalComfirmed:function(){var t=this;this.$refs.form.validate()?t.locations.length>0?t.locations[0].id?this.$Server.addOrUpdate(v.getModelName(),t.locations[0],!0).then((function(e){e.success&&(t.IsShow=!1,t.initialize(),f["a"].alert("修改成功","success"))}),(function(t){f["a"].alert(t)})):t.locations.length>0?this.$Server.batchSave(v.getModelName(),t.locations,!1).then((function(e){e.success&&(t.IsShow=!1,t.initialize(),f["a"].alert("添加成功","success"),t.selectLocation=[])}),(function(t){f["a"].alert(t)})):f["a"].alert("至少要添加一项数据"):f["a"].alert("必须有一个库位信息"):f["a"].alert("验证不通过")},addRow:function(){this.locations.push({storageId:this.storageId})},deleteRow:function(){this.locations.length-1>0?this.locations.splice(this.selectLocation[0],1):f["a"].alert("一次至少添加一条库位信息")},GridEdit:function(){if(this.locations=[],this.isUpdate=!0,this.selectItmes.length>1)f["a"].alert("只能选择一条要修改的数据");else if(0==this.selectItmes.length)f["a"].alert("请选择一条修改的数据");else{this.title="编辑库位",this.IsShow=!0;var t=JSON.parse(JSON.stringify(this.selectItmes[0]));this.locations.push(t)}},modalComfirmedClose:function(){this.IsComfirmShow=!1},cofirmDelete:function(){var t=this;t.selectItmes.length>0?this.$Server.batchDelete(v.getModelName(),t.selectItmes).then((function(e){e.success&&(t.IsComfirmShow=!1,t.selectItmes=[],t.initialize(),f["a"].alert("删除成功","success"))}),(function(t){return f["a"].alert(t)})):f["a"].alert("选择要删除的库位")},backstorage:function(){this.$router.back(-1)},storageDetail:function(t){this.detailItem={},this.IsShowDetails=!0,this.detailItem=t,this.selectItmes.includes(t)||this.selectItmes.push(t)},getClick:function(t,e){this.selectLocation=[],0==this.isUpdate&&this.selectLocation.push(e)},importLocation:function(){this.IsShowImport=!0},ComfirmImport:function(){var t=this,e=this.$refs.uploadFile.filename,i={base64:this.base64,fileName:e,fileType:"xls",id:this.storageId};this.$Server.importFile(v.getModelName(),i).then((function(e){e.success?(f["a"].alert("导入成功","success"),t.IsShowImport=!1,t.$refs.childGridTemplate.init()):f["a"].alert(e.datas.error)}),(function(t){return f["a"].alert(t)}))},getFormData:function(t){var e=this,i=t.get("data");if(i){var s=i.name.substring(i.name.lastIndexOf(".")+1,i.name.length);"xls"!=s&&"xlsx"!=s&&(f["a"].alert("请检查文件是否为Excel文件"),e.$refs.uploadFile.clearFile())}},modalClosedImport:function(){this.IsShowImport=!1,this.$refs.uploadFile.clearFile()},downloadTemp:function(){}}}),I=g,x=(i("f5b4"),i("e77f"),i("6691")),b=Object(x["a"])(I,s,a,!1,null,"48ee0614",null);e["default"]=b.exports},e77f:function(t,e,i){"use strict";var s=i("34d2"),a=i.n(s);a.a},f5b4:function(t,e,i){"use strict";var s=i("1903"),a=i.n(s);a.a}}]);