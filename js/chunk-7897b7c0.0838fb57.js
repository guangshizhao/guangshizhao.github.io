(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7897b7c0"],{"0c10":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-form",{ref:"form1",attrs:{"lazy-validation":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"取消原因",rules:[e.rules.required]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            取消原因: "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.item.cancelReason,callback:function(t){e.$set(e.item,"cancelReason",t)},expression:"item.cancelReason"}})],1)],1)],1)],1)],1)},i=[],r=(a("d5b3"),{name:"CancelTask",data:function(){return{rules:{required:function(e){return!!e||"必填项"}}}},props:["item"],methods:{validate:function(){return 1==this.$refs.form1.validate()},resetValid:function(){this.$refs.form1.resetValidation(),this.$refs.form1.reset()}}}),n=r,o=a("6691"),l=Object(o["a"])(n,s,i,!1,null,"058eafcc",null);t["a"]=l.exports},"265d":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("v-tabs",{attrs:{"slider-color":"primary",color:"#f5f5f5",id:"selftabs"},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[s("v-tab",{key:1},[s("img",{attrs:{src:a("e865")}}),e._v("计量仪器台账 ")]),s("v-tab",{key:2},[s("img",{attrs:{src:a("e865")}}),e._v("校准工单")]),s("v-tab-item",{key:1},[s("meteringEquipment")],1),s("v-tab-item",{key:2},[s("CalibrationTask1")],1)],1)],1)},i=[],r=a("c467"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContentHeader",{attrs:{title:"",buttons:e.headerBtns,opacity:"0"}},[a("v-text-field",{staticStyle:{width:"390px"},attrs:{label:"请输入校验单编号，仪器编号，仪器名称","hide-details":"","single-line":"",primary:"",clearable:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchfx,callback:function(t){e.searchfx=t},expression:"searchfx"}})],1),a("layContent",[a("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,sort:e.sort,DataSource:e.DataSource,hideOperation:!0,formatFields:e.formatFields,total:e.total},on:{rowDbClick:e.rowDbClick,initialize:e.initTable}}),a("distribute-user",{attrs:{title:"分配负责人",IsShow:e.IsShowDistribute,allowActive:!1,width:1400},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[a("simpleDataTable",{ref:"childDataTable1",attrs:{headers:e.userHeaders,items:e.userDataSource,hideOperation:!0,hideHeaders:!1,total:e.total2},on:{selectChangeForSave:e.selectChangeForSave,chooseAssignedUser:e.chooseAssignedUser}})],1),a(e.currentView,{ref:"componentForm",tag:"component",attrs:{PreviewType:e.PreviewType,objectId:e.objectId},on:{modalComfirmed:e.formComfirmed}}),a("contentModal",{attrs:{title:"取消原因",IsShow:e.IsShowCancelTask,width:"1100"},on:{modalComfirmed:function(t){return e.modalComfirmedCancelTask()},modalClosed:function(t){return e.modalClosedCancelTask()}}},[a("CancelTask",{ref:"CancelTask",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:"校准工单详情",IsShow:e.IsShowForSee,width:"1100",isDetails:!0},on:{modalClosed:function(t){return e.modalClosedDetial()}}},[a("CalibratoinTaskDetail",{ref:"calibratoinTaskDetail",attrs:{item:e.detailForUpdate}})],1)],1)],1)},o=[],l=(a("7cfd"),a("4634"),a("e6d1"),a("de90"),a("a2a7")),c=a("0c10"),d=a("7300"),u=a("5873"),m=a("ddf2"),f=a("80ea"),h=a("ae0a"),b=a("97a3"),p=a("652a"),v=a("1269"),g=a("a7fe"),S=new p["a"],w=function(e){function t(){var e,a;Object(d["a"])(this,t);for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];return a=Object(u["a"])(this,(e=Object(m["a"])(t)).call.apply(e,[this].concat(i))),Object(b["a"])(Object(f["a"])(a),"__name","CalibrationTask"),Object(b["a"])(Object(f["a"])(a),"crId",S.charField({require:!1,visible:!1,editable:!1,fieldName:"ID"})),Object(b["a"])(Object(f["a"])(a),"code",S.charField({require:!0,fieldName:"校准工单编号"})),Object(b["a"])(Object(f["a"])(a),"name",S.charField({require:!0,fieldName:"校准工单名称",visible:!1})),Object(b["a"])(Object(f["a"])(a),"meteringEquipmentCode",S.charField({require:!0,fieldName:"仪器编号"})),Object(b["a"])(Object(f["a"])(a),"meteringEquipmentName",S.charField({require:!0,fieldName:"仪器名称"})),Object(b["a"])(Object(f["a"])(a),"meteringEquipmentModel",S.charField({require:!0,visible:!1,fieldName:"规格型号"})),Object(b["a"])(Object(f["a"])(a),"calibrationDate",S.charField({require:!0,fieldName:"校准时间",format:function(e){if(e)return e.substring(0,10)}})),Object(b["a"])(Object(f["a"])(a),"calibrationType",S.charField({require:!0,fieldName:"校准类型"})),Object(b["a"])(Object(f["a"])(a),"meteringEquipmentID",S.charField({require:!0,visible:!1,fieldName:"计量仪器"})),Object(b["a"])(Object(f["a"])(a),"assignedUser",S.charField({require:!0,visible:!1,fieldName:"负责人"})),Object(b["a"])(Object(f["a"])(a),"assignedUserName",S.charField({require:!0,fieldName:"负责人"})),Object(b["a"])(Object(f["a"])(a),"actualStartTime",S.charField({require:!0,fieldName:"实际校准时间",format:function(e){if(e)return e.substring(0,10)}})),Object(b["a"])(Object(f["a"])(a),"status",S.comboBoxField(g["a"],{require:!1,fieldName:"任务状态",visible:!1,editable:!1,format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),Object(b["a"])(Object(f["a"])(a),"statusName",S.charField({require:!1,editable:!1,fieldName:"任务状态"})),a}return Object(h["a"])(t,e),t}(v["a"]),C=a("8333"),x=a("d5b3"),T=a("f05f"),I=(a("681f"),a("531b")),k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-dialog",{attrs:{"max-width":"1100px",persistent:!0,scrollable:""},model:{value:e.IsShow,callback:function(t){e.IsShow=t},expression:"IsShow"}},[a("v-card",[a("v-card-title",{staticClass:"primary"},[a("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("分配负责人")])]),a("v-card-text",[e._t("default")],2),a("v-card-actions",{staticClass:"marginbottom"},[a("v-spacer"),a("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.modalComfirmed()}}},[e._v("一键分配")]),a("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.modalClosed()}}},[e._v("关闭")])],1)],1)],1)],1)},O=[],F={name:"distributeUser",props:["IsShow"],methods:{modalClosed:function(){this.$emit("modalClosed")},modalComfirmed:function(){this.$emit("modalComfirmed")}}},y=F,_=a("6691"),D=Object(_["a"])(y,k,O,!1,null,"4729b70e",null),j=D.exports,U=a("52d6"),M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-layout",{attrs:{wrap:""}},[a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("仪器编号："+e._s(e.item.meteringEquipmentCode))])]),a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("仪器名称："+e._s(e.item.meteringEquipmentName))])]),a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("规格型号："+e._s(e.item.meteringEquipmentModel))])]),a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("使用位置："+e._s(e.item.meModel&&e.item.meModel.usedPart))])]),a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("所属部门："+e._s(e.item.meModel&&e.item.meModel.departmentName))])]),a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("使用部门："+e._s(e.item.meModel&&e.item.meModel.usedDepartmentName))])]),a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("校准周期："+e._s(e.item.meModel&&e.item.meModel.periodData))])]),a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("校准类型："+e._s(e.item.calibrationType))])]),a("v-flex",{attrs:{xs4:""}},[a("p",[e._v("提前提醒时间："+e._s(e.item.preDate))])])],1),e.item.meModel&&e.item.meModel.meteringStandardVM&&e.item.meModel.meteringStandardVM.dname?a("v-layout",[a("v-flex",{attrs:{xs12:""}},[a("span",[e._v("计量标准: ")]),a("view-file",{attrs:{documentViewModel:e.item.meModel.meteringStandardVM,color:"primary"}})],1)],1):e._e(),e.item.status&&0!=e.item.status.dvalue&&e.isShowImage?a("v-layout",[a("v-flex",{attrs:{xs12:""}},[a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("任务进度:")])]),a("img",{attrs:{src:e.imageSrc}})])],1):e._e()],1)},N=[],q={data:function(){return{CalibrationTask:{},imagesrc:"",isShowImage:!1}},watch:{item:{handler:function(e){this.isShowImage=!1,e&&e.status&&0!=e.status.dvalue&&this.seeTrace()},deep:!0}},props:["item"],methods:{seeTrace:function(){var e=this;I["a"].http(window.processForUrl.getUrlForInstanceId(e.item.id),"get","",{success:function(t){if(t.data&&t.data.data&&t.data.data.id){var a=t.data.data.id;e.seeImage(a)}}})},seeImage:function(e){var t=this;I["a"].http(window.processForUrl.getUrlForInstanceTrace(e),"get",{},{success:function(e){t.imageSrc=e.data.data.image,t.isShowImage=!0}})}}},$=q,E=Object(_["a"])($,M,N,!1,null,null,null),P=E.exports,A=new C["a"](new w),V={name:"CalibratoinTask1",data:function(){var e=this;return{initObject:{id:"",inventoryCode:"",startDate:"",endDate:"",assignedUser:"",assignName:"",sparePartsList:[],userViewModel:[],inventoryType:"",typeList:[],storageIds:[]},IsShowCancelTask:!1,userDataSource:[],IsShowDistribute:!1,total2:1,userHeaders:[{text:"校验工单编号",value:"code",sortable:!1,align:"center"},{text:"校验工单名称",value:"name",align:"center",sortable:!1},{text:"仪器编号",value:"meteringEquipmentCode",align:"center",sortable:!1},{text:"仪器名称",value:"meteringEquipmentName",align:"center",sortable:!1},{text:"分配人员",value:"assignedUser",sortable:!1,fieldType:"comboboxField",IsMultiple:!1,align:"center",comboboxSelect:"userList",itemtext:"uname",itemvalue:"id"}],isFirstChoose:!1,searchfx:"",sort:!0,total:1,DataSource:[],title:"",IsShow:!1,IsAddOp:!0,detailForUpdate:{},IsShowForSee:!1,titleForSee:"",headerBtns:[{disabled:!1,text:"分配负责人",icon:"self_look",click:function(){return e.chooseAssignedUser(1,10)}},{disabled:!1,text:"取消",icon:"self_cancel",click:function(){return e.cancelTask()}},{disabled:!1,text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}}],currentView:"",processKey:window.process.CalibrationTask,PreviewType:1,objectId:"",IsShowForSeeResult:!1}},computed:{headers:function(){var e=A.formatGridHeader();return!0===this.sort&&e.unshift({text:"序号",align:"center",sortable:!1}),e},formatFields:function(){return A.getFormatFields()}},components:{dataTable:T["a"],DistributeUser:j,simpleDataTable:U["a"],CancelTask:c["a"],contentModal:l["a"],CalibratoinTaskDetail:P},mounted:function(){},methods:{formComfirmed:function(){this.initTable()},cancelTask:function(){var e=this,t=e.$refs.childDataTable.getCheckItems();1!=t.length?x["a"].alert("请选择一项作为你取消的对象"):"进行中"==t[0].status.dname?t[0].assignedUser!==sessionStorage.getItem("userId")?x["a"].alert("您不是该任务的负责人，不能取消"):(e.detailForUpdate=JSON.parse(JSON.stringify(e.$refs.childDataTable.getCheckItems()[0])),e.$refs.CancelTask.resetValid(),e.IsShowCancelTask=!0):x["a"].alert("只有对进行中的任务才能取消！")},modalComfirmedCancelTask:function(){var e=this;1==e.$refs.CancelTask.validate()?(e.cofirmCancel(e.detailForUpdate),e.IsShowCancelTask=!1):x["a"].alert("验证错误")},modalClosedCancelTask:function(){var e=this;e.IsShowCancelTask=!1},modalClosedDetial:function(){this.IsShowForSee=!1},cofirmCancel:function(e){var t=this;I["a"].http(window.processForUrl.getUrlForInstanceId(e.id),"get","",{success:function(a){a.data&&a.data.data&&a.data.data.id?I["a"].http(window.processForUrl.getUrlForInstance(a.data.data.id),"Delete","",{success:function(a){e.status.dvalue=4,t.$Server.addOrUpdate(A.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),x["a"].alert("取消成功","success"))}),(function(e){x["a"].alert(e)}))},error:function(e){x["a"].alert(e)}}):(e.status.dvalue=4,t.$Server.addOrUpdate(A.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),x["a"].alert("取消成功","success"))}),(function(e){x["a"].alert(e)})))},error:function(e){x["a"].alert(e)}})},getQueryStringArgs:function(e){if(e&&e.length>0){var t=e.length>0?e.substring(1):"",a={},s=t.length?t.split("&"):[],i=null,r=null,n=null,o=0,l=s.length;for(o=0;o<l;o++)i=s[o].split("="),r=decodeURIComponent(i[0]),n=decodeURIComponent(i[1]),r.length&&(a[r]=n);return a}return{}},excuteTask:function(){var e=this;if(1!=e.$refs.childDataTable.getCheckItems().length)x["a"].alert("请选择一项作为你执行的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0],a=sessionStorage.getItem("userId");e.objectId=t.id,"未开始"==t.status.dname?t.assignedUser&&t.assignedUser==a?I["a"].http(window.processForUrl.getUrlForFirst(e.processKey),"get","",{success:function(t){var a=t.data.data,s=t.data.data.formKey,i={};s.indexOf("?")>-1&&(i=e.getQueryStringArgs(s.substring(s.indexOf("?"),s.length)),s=s.substring(0,s.indexOf("?")));var r=e.$getFrom("baseForm");r&&-1!=r&&(e.currentView=r,setTimeout((function(){e.$refs.componentForm.modalOpen(s,i,a)}),200))},error:function(e){x["a"].alert(e)}}):x["a"].alert("这条任务的负责人不是你！"):x["a"].alert("只有对未开始的校准任务才能执行！")}},doSearch:function(){var e=this.$refs.childDataTable.getPagination();1==e.page?this.initTable(e):this.$refs.childDataTable.setPage(1)},clearMessage:function(){this.searchfx="",this.doSearch()},initTable:function(e){var t=this;e&&e.page||(e=this.$refs.childDataTable.getPagination()),t.$Server.queryAll(A.getModelName(),{page:e.page,rowsPerPage:e.rowsPerPage},{searchfx:t.searchfx}).then((function(e){t.$refs.childDataTable.unCheckItems(),t.DataSource=e.datas,t.DataSource.forEach((function(e){e.meModel&&(e.meteringEquipmentCode=e.meModel.code,e.meteringEquipmentName=e.meModel.name,e.meteringEquipmentModel=e.meModel.model,e.meModel.type&&(e.calibrationType=e.meModel.type.dname)),(e.status&&"未开始"==e.status.dname||"已取消"==e.status.dname)&&(e.statusName=t.$Utils.setStart(e.status.dname)),e.status&&"进行中"==e.status.dname&&(e.statusName=t.$Utils.setRed(e.status.dname)),e.status&&"按时完成"==e.status.dname&&(e.statusName=t.$Utils.setSuccess(e.status.dname)),e.status&&"超期完成"==e.status.dname&&(e.statusName=t.$Utils.setWarn(e.status.dname))})),t.total=e.page.total}),(function(e){x["a"].alert(e)}))},rowDbClick:function(e){this.detailForUpdate=JSON.parse(JSON.stringify(e)),this.IsShowForSee=!0},showResult:function(){this.IsShowDistribute=!0},modalComfirmed:function(){var e=this;if(this.userDataSource.length>0){var t=[],a=sessionStorage.getItem("userId");t.push({editAssignedUser:a,code:"一键分配保养人员"}),this.$Server.batchUpdate(A.getModelName(),t).then((function(t){if(t.success){var a=e.$refs.childDataTable1.getPagination();e.chooseAssignedUser(a.page,a.rowsPerPage),x["a"].alert("负责人分配成功","success")}}),(function(e){return x["a"].alert("分配负责人失败")}))}},modalClosed:function(){this.IsShowDistribute=!1,this.initTable()},selectChangeForSave:function(e){var t=JSON.parse(JSON.stringify(e));this.$Server.batchUpdate(A.getModelName(),[t]).then((function(e){e.success||x["a"].alert("分配负责人错误")}),(function(e){return x["a"].alert("分配负责人错误")}))},chooseAssignedUser:function(e,t){if(this.isFirstChoose){var a=this;this.$Server.queryAll(A.getModelName(),{page:e,rowsPerPage:t},{chooseUser:"ssssss",status:"未开始"}).then((function(e){a.total2=e.page.total,e.datas.forEach((function(e){e.meModel&&(e.meteringEquipmentCode=e.meModel.code,e.meteringEquipmentName=e.meModel.name),e.assignedUser})),a.userDataSource=e.datas,a.IsShowDistribute=!0}))}else this.isFirstChoose=!0}}},J=V,R=Object(_["a"])(J,n,o,!1,null,null,null),H=R.exports,L={data:function(){return{active:null,text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."}},watch:{},components:{meteringEquipment:r["default"],CalibrationTask1:H},mounted:function(){this.$route.params.active&&(this.active=1)},methods:{init:function(){},next:function(){var e=parseInt(this.active);this.active=e<2?e+1:0}}},B=L,K=(a("f69e"),Object(_["a"])(B,s,i,!1,null,"34dd25af",null));t["default"]=K.exports},"9a98":function(e,t,a){},f69e:function(e,t,a){"use strict";var s=a("9a98"),i=a.n(s);i.a}}]);