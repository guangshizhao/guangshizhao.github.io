(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-74a8262d"],{"6e442":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("layContentHeader",{attrs:{title:"编码规则配置",buttons:e.headerBtns}}),i("layContent",[i("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,DataSource:e.$store.state.CodeRule.DataSource,total:e.$store.state.CodeRule.totalDatas,hideOperation:!0,allowActive:!0,sort:!0},on:{rowDbClick:e.rowDbClick,initialize:e.init}})],1),i("contentModal",{attrs:{title:"编辑编码规则",IsShow:e.IsShow},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[i("v-container",{staticStyle:{padding:"24px"},attrs:{"grid-list-md":""}},[i("v-form",{ref:"form",attrs:{valid:"true","lazy-validation":""}},[i("v-layout",{attrs:{wrap:""}},[i("v-flex",[i("v-text-field",{attrs:{label:"对象名称",disabled:""},model:{value:e.showItem.name,callback:function(t){e.$set(e.showItem,"name",t)},expression:"showItem.name"}})],1),i("v-flex",[i("v-select",{attrs:{items:e.$store.state.CodeRule.connectors,"item-value":"dcode","item-text":"dname"},model:{value:e.showItem.linkChar,callback:function(t){e.$set(e.showItem,"linkChar",t)},expression:"showItem.linkChar"}})],1)],1),i("v-layout",[i("v-flex",[i("div",{staticClass:"headline",staticStyle:{"margin-top":"10px"}},[e._v("前缀:")])]),i("v-flex",{attrs:{xs11:"",sm11:"",md11:""}},[i("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[i("v-btn",e._g({attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:function(t){return e.addPrefixRow()}}},a),[i("v-icon",[e._v("\n                    add\n                  ")])],1)]}}])},[i("span",[e._v("新增前缀")])]),i("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[i("v-btn",e._g({attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:e.deletePrefixRow}},a),[i("v-icon",[e._v("\n                    remove\n                  ")])],1)]}}])},[i("span",[e._v("删除前缀")])])],1)],1),e._l(e.showItem.prefixList,(function(t,a){return i("v-layout",{key:a,style:e.selectItem.includes(a)?"background: #E3F2FD":"",attrs:{wrap:""},on:{click:function(i){return e.getClick(t,a)}}},e._l(e.editPrefix,(function(r){return i("v-flex",{key:r.field,attrs:{xs4:""}},["ruleType"==r.field?i("v-select",{attrs:{"return-object":"","item-text":"dname",items:e.preRuleList,label:"前缀"+(a+1),rules:[function(e){return Object.keys(e).length>0||"必填项"}]},on:{change:function(i){return e.changePrefix(a,t[r.field])}},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"pre[item.field]"}}):"showLinkChar"==r.field?i("v-checkbox",{attrs:{label:"是否显示连接符"},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"pre[item.field]"}}):t.ruleType&&"日期"==t.ruleType.dname&&"format"==r.field?i("v-select",{attrs:{label:r.fieldName,"item-text":"dname","item-value":"dvalue",disabled:"日期"!=t.ruleType.dname,items:e.$store.state.CodeRule.dateFormats},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"pre[item.field]"}}):t.ruleType&&"自定义"==t.ruleType.dname&&"format"==r.field?i("v-text-field",{attrs:{label:r.fieldName,rules:[function(e){return!!e||"必填项"}]},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"pre[item.field]"}}):i("v-text-field",{attrs:{label:r.fieldName,disabled:""},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"pre[item.field]"}})],1)})),1)})),i("v-layout",[i("v-flex",[i("div",{staticStyle:{width:"60px","margin-top":"20px"}},[i("p",[e._v("流水号：")])])]),i("v-flex",{attrs:{xs6:""}},[i("v-text-field",{attrs:{label:"起始值",min:"0",type:"number"},model:{value:e.showItem.beginNumber,callback:function(t){e.$set(e.showItem,"beginNumber",t)},expression:"showItem.beginNumber"}})],1),i("v-flex",{attrs:{xs6:""}},[i("v-text-field",{attrs:{label:"长度",min:"0",type:"number",rules:[function(e){return!!e||"必填项"}]},model:{value:e.showItem.numberLength,callback:function(t){e.$set(e.showItem,"numberLength",t)},expression:"showItem.numberLength"}})],1)],1),i("v-layout",[i("v-flex",[i("div",{staticClass:"headline",staticStyle:{"margin-top":"10px"}},[e._v("后缀")])]),i("v-flex",{attrs:{xs11:"",sm11:"",md11:""}},[i("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[i("v-btn",e._g({attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:function(t){return e.addSuffixRow()}}},a),[i("v-icon",[e._v("\n                    add\n                  ")])],1)]}}])},[i("span",[e._v("新增后缀")])]),i("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[i("v-btn",e._g({attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:e.deleteSuffixRow}},a),[i("v-icon",[e._v("\n                    remove\n                  ")])],1)]}}])},[i("span",[e._v("删除后缀")])])],1)],1),e._l(e.showItem.suffixList,(function(t,a){return i("v-layout",{key:t.field,style:e.selectSufItem.includes(a)?"background: #E3F2FD":"",attrs:{wrap:""},on:{click:function(i){return e.getSuffixClick(t,a)}}},e._l(e.editSuffix,(function(r){return i("v-flex",{key:r.field,attrs:{xs4:""}},["ruleType"==r.field?i("v-select",{attrs:{"return-object":"","item-text":"dname",items:e.suffixRuleList,label:"后缀"+(a+1),rules:[function(e){return Object.keys(e).length>0||"必填项"}]},on:{change:function(i){return e.changeSufefix(a,t[r.field])}},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"suf[item.field]"}}):"showLinkChar"==r.field?i("v-checkbox",{attrs:{label:"是否显示连接符"},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"suf[item.field]"}}):t.ruleType&&"日期"==t.ruleType.dname&&"format"==r.field?i("v-select",{attrs:{label:r.fieldName,"item-text":"dname","item-value":"dvalue",disabled:"日期"!=t.ruleType.dname,items:e.$store.state.CodeRule.dateFormats},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"suf[item.field]"}}):t.ruleType&&"自定义"==t.ruleType.dname&&"format"==r.field?i("v-text-field",{attrs:{label:r.fieldName,rules:[function(e){return!!e||"必填项"}]},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"suf[item.field]"}}):i("v-text-field",{attrs:{label:r.fieldName,disabled:""},model:{value:t[r.field],callback:function(i){e.$set(t,r.field,i)},expression:"suf[item.field]"}})],1)})),1)})),i("v-layout",[i("v-flex",{attrs:{xs6:""}},[i("v-text-field",{attrs:{label:"预览效果",disabled:""},model:{value:e.preview,callback:function(t){e.preview=t},expression:"preview"}})],1),i("v-flex",[i("v-btn",{on:{click:function(t){return e.previewCode()}}},[e._v("预览效果")])],1)],1)],2)],1)],1)],1)},r=[],s=(i("7cfd"),i("bada"),i("4634"),i("531b")),l=(i("f753"),i("a2a7")),n=i("f05f"),o=i("8333"),f=i("07c5"),d=i("7300"),u=i("5873"),c=i("ddf2"),m=i("80ea"),h=i("ae0a"),p=i("97a3"),v=i("652a"),b=i("1269"),x=new v["a"],w=function(e){function t(){var e,i;Object(d["a"])(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return i=Object(u["a"])(this,(e=Object(c["a"])(t)).call.apply(e,[this].concat(r))),Object(p["a"])(Object(m["a"])(i),"__name","CodeRule"),Object(p["a"])(Object(m["a"])(i),"name",x.comboBoxField(null,{require:!0,fieldName:"对象名称"})),Object(p["a"])(Object(m["a"])(i),"createType",x.boolField({require:!1,fieldName:"生成方式",visible:!1})),Object(p["a"])(Object(m["a"])(i),"number",x.numberField("int",{require:!1,fieldName:"流水号",visible:!1})),Object(p["a"])(Object(m["a"])(i),"linkChar",x.charField({require:!1,fieldName:"连接符",visible:!1})),Object(p["a"])(Object(m["a"])(i),"joinModifiers",x.charField({require:!1,fieldName:"编码规则"})),Object(p["a"])(Object(m["a"])(i),"beginNumber",x.charField({require:!1,fieldName:"流水号初值",visible:!1})),Object(p["a"])(Object(m["a"])(i),"numberLength",x.numberField("int",{require:!1,fieldName:"流水号长度",visible:!1})),Object(p["a"])(Object(m["a"])(i),"codeRuleString",x.charField({require:!1,fieldName:"",visible:!1})),Object(p["a"])(Object(m["a"])(i),"preview",x.charField({require:!1,fieldName:"预览效果"})),i}return Object(h["a"])(t,e),t}(b["a"]),y=i("d5b3"),I=i("a7fe"),k=new o["a"](new w),g={data:function(){var e=this;return{showItem:{},totalDatas:1,headers:k.formatGridHeader(),headerBtns:[{disabled:!this.$per("CodeRule","u"),text:"编辑",icon:"self_edit",click:function(){return e.gridEdit()}}],editPrefix:[{field:"ruleType",fieldName:"前缀"},{field:"format",fieldName:"格式"},{field:"showLinkChar",fieldName:"是否显示连接符"}],editSuffix:[{field:"ruleType",fieldName:"前缀"},{field:"format",fieldName:"格式"},{field:"showLinkChar",fieldName:"是否显示连接符"}],IsShow:!1,ruleTypeList:[],preview:"",pagination:{},currentparams:{},selectItem:[],selectSufItem:[]}},components:{dataTable:n["a"],contentModal:l["a"],layContentHeader:f["a"]},computed:{preRuleList:function(){var e=this.ruleTypeList;return this.showItem.suffixList&&this.showItem.suffixList.length>0&&this.showItem.suffixList.forEach((function(t){e=e.filter((function(e){return e.dvalue!=t.ruleType.dvalue}))})),e},suffixRuleList:function(){var e=this.ruleTypeList;return this.showItem.prefixList&&this.showItem.prefixList.length>0&&this.showItem.prefixList.forEach((function(t){e=e.filter((function(e){return e.dvalue!=t.ruleType.dvalue}))})),e}},mounted:function(){this.headers.unshift({text:"序号",align:"center"})},methods:{init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!=e.page&&(this.currentparams=e);var t=this.currentparams;this.$store.dispatch("GetCodeRule",t),this.$store.dispatch("getDateFormat",{dname:"时间格式"}),this.$store.dispatch("getConnector",{dname:"编码规则连接符"})},getClick:function(e,t){this.selectItem=[],this.selectItem.push(t)},getSuffixClick:function(e,t){this.selectSufItem=[],this.selectSufItem.push(t)},rowDbClick:function(){},changePrefix:function(e,t){var i=this,a=this.$store.state.CodeRule.DataSource.find((function(e){return e.name==i.showItem.name}));if(a){var r=this.showItem.prefixList.find((function(e){return e.dname==t.dname}));r&&r.dcode&&r.dcode.length>0||(this.showItem.prefixList[e].format=t.dcode)}else this.showItem.prefixList[e].format=t.dcode},changeSufefix:function(e,t){var i=this,a=this.$store.state.CodeRule.DataSource.find((function(e){return e.name==i.showItem.name}));if(a){var r=this.showItem.suffixList.find((function(e){return e.dname==t.dname}));r&&r.dcode&&r.dcode.length>0||(this.showItem.suffixList[e].format=t.dcode)}else this.showItem.suffixList[e].format=t.dcode},gridEdit:function(){var e=this.$refs.childDataTable.getActiveItem(),t=e.beginNumber,i=e.codeType,a=e.createType,r=e.createdTime,s=e.id,l=e.joinModifiers,n=e.linkChar,o=e.modifiedTime,f=e.name,d=e.number,u=e.numberLength,c=e.prefixList,m=e.preview,h=e.suffixList;this.showItem={beginNumber:t,codeType:i,createType:a,createdTime:r,id:s,joinModifiers:l,linkChar:n,modifiedTime:o,name:f,number:d,numberLength:u,prefixList:c,preview:m,suffixList:h},this.showItem.createType=0==this.showItem.createType?"0":"1",this.queryByDname(this.showItem.name),this.showItem.prefixList||(this.showItem.prefixList=[]),this.showItem.suffixList||(this.showItem.suffixList=[]),this.showItem.prefixList.forEach((function(e){"日期"==e.ruleType.dname&&(e.format=parseInt(e.format))})),this.showItem.suffixList.forEach((function(e){"日期"==e.ruleType.dname&&(e.format=parseInt(e.format))})),this.$refs.form.resetValidation(),this.preview="",this.IsShow=!0},addSuffixRow:function(){this.showItem.suffixList.push({order:this.showItem.suffixList.length,ruleType:{},type:1,showLinkChar:1})},addPrefixRow:function(){this.showItem.prefixList.push({order:this.showItem.prefixList.length,ruleType:{},type:0,showLinkChar:1})},deleteSuffixRow:function(){this.selectSufItem.length>0?this.showItem.suffixList.splice(this.selectSufItem[0],1):y["a"].alert("请选择需要删除的后缀")},deletePrefixRow:function(){this.selectItem.length>0?this.showItem.prefixList.splice(this.selectItem[0],1):y["a"].alert("请选择需要删除的前缀")},modalClosed:function(){this.IsShow=!1},queryByDname:function(e){var t=this;this.$Server.queryAll((new I["a"]).__name,{},{dname:e}).then((function(e){t.ruleTypeList=e.datas}))},modalComfirmed:function(){var e=this;this.$refs.form.validate()?this.$Server.addOrUpdate("CodeRule",this.showItem,!0).then((function(t){t.success?(e.init(e.currentparams),e.$refs.childDataTable.setActiveItem({}),e.IsShow=!1,y["a"].alert("编辑成功","success")):y["a"].alert("编辑失败")}),(function(e){return y["a"].alert("编辑失败")})):y["a"].alert("必填项不能为空")},previewCode:function(){if(this.$refs.form.validate()){var e=encodeURIComponent(JSON.stringify(this.showItem)),t=this;s["a"].http("/anonymous/codeRulePreView?condition="+e,"GET",null,{success:function(e){200==e.data.code?t.preview=e.data.data:y["a"].alert("预览失败")},error:function(e){y["a"].alert(e)}})}else y["a"].alert("验证不通过")},change:function(e){console.log(e)}}},L=g,C=i("6691"),T=Object(C["a"])(L,a,r,!1,null,null,null);t["default"]=T.exports}}]);