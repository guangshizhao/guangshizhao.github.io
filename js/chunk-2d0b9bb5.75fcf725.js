(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b9bb5"],{"33cb":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContentHeader",{attrs:{title:"备件仓库管理",buttons:e.headerBtns}},[a("v-text-field",{staticStyle:{width:"300px"},attrs:{label:"输入仓库编号，名称或负责人","hide-details":"","single-line":"",clearable:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1),a("layContent",[a("gridTemplate",{ref:"childGridTemplate",attrs:{title:"备件仓库",gridModel:e.Storage,sort:e.sort},on:{editorsReCode:e.editorsReCode,beforeEdit:e.beforeEdit,beforeAdd:e.beforeAdd,beforeEditSubmit:e.beforeEditSubmit,rowDbClick:e.rowDbClick}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs6:""}},[a("v-text-field",{attrs:{label:"备件仓库地址",rules:[function(e){return!!e||"必填项"}]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            备件仓库地址 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.showItem.address,callback:function(t){e.$set(e.showItem,"address",t)},expression:"showItem.address"}})],1),a("v-flex",{attrs:{xs6:""}},[a("treeCombo",{attrs:{itemName:"oname",label:"负责部门",Source:e.orgList,independentCheck:!1,independentSingleCheck:!0,require:!0},model:{value:e.departmentId,callback:function(t){e.departmentId=t},expression:"departmentId"}})],1),a("v-flex",{attrs:{xs6:""}},[a("v-select",{attrs:{label:"仓库负责人",items:e.userSelectList,"item-text":"uname","item-value":"id",rules:[function(e){return!!e||"必填项"}]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            仓库负责人 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.contact,callback:function(t){e.contact=t},expression:"contact"}})],1),a("v-flex",{attrs:{xs6:""}},[a("v-text-field",{attrs:{label:"电话",disabled:""},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}})],1)],1)],1)],1),a("contentModal",{attrs:{title:"备件仓库详情",IsShow:e.IsShowDetails,isDetails:!0},on:{modalClosed:function(t){return e.modalClosed()}}},[a("v-container",{staticStyle:{padding:"0"},attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs6:""}},[a("v-text-field",{attrs:{label:"备件仓库编号",disabled:""},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            备件仓库编号\n                        ")]},proxy:!0}]),model:{value:e.storageDetail.scode,callback:function(t){e.$set(e.storageDetail,"scode",t)},expression:"storageDetail.scode"}})],1),a("v-flex",{attrs:{xs6:""}},[a("v-text-field",{attrs:{label:"备件仓库名称",disabled:""},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            备件仓库名称 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.storageDetail.sname,callback:function(t){e.$set(e.storageDetail,"sname",t)},expression:"storageDetail.sname"}})],1),a("v-flex",{attrs:{xs6:""}},[a("v-text-field",{attrs:{label:"备件仓库地址",disabled:""},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            备件仓库地址 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.storageDetail.address,callback:function(t){e.$set(e.storageDetail,"address",t)},expression:"storageDetail.address"}})],1),a("v-flex",{attrs:{xs6:""}},[a("treeCombo",{attrs:{itemName:"oname",label:"负责部门",Source:e.orgList,independentCheck:!0,independentSingleCheck:!0,require:!0,disabled:!0},model:{value:e.storageDetail.departmentId,callback:function(t){e.$set(e.storageDetail,"departmentId",t)},expression:"storageDetail.departmentId"}})],1),a("v-flex",{attrs:{xs6:""}},[a("v-select",{attrs:{label:"仓库负责人",items:e.userList,"item-text":"uname","item-value":"id",disabled:""},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            仓库负责人 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.storageDetail.contact,callback:function(t){e.$set(e.storageDetail,"contact",t)},expression:"storageDetail.contact"}})],1),a("v-flex",{attrs:{xs6:""}},[a("v-text-field",{attrs:{label:"电话",disabled:""},model:{value:e.storageDetail.phone,callback:function(t){e.$set(e.storageDetail,"phone",t)},expression:"storageDetail.phone"}})],1)],1)],1)],1),a("contentModal",{attrs:{title:"导入备件仓库",IsShow:e.IsShowImport},on:{modalClosed:function(t){return e.modalClosedImport()},modalComfirmed:function(t){return e.ComfirmImport()}}},[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("v-btn",{staticClass:"mb-2",attrs:{color:"primary",dark:""},on:{click:e.downloadTemp}},[e._v("下载导入模板")]),a("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("\n                (注:文档内标题标红的列为必填项，请勿输入以下非法字符：~、@、$、^、&、《、》、<、>、￥)\n            ")])],1),a("UploadFile",{ref:"uploadFile",attrs:{label:"导入文件"},on:{formData:e.getFormData},model:{value:e.base64,callback:function(t){e.base64=t},expression:"base64"}})],1)],1)},i=[],s=(a("7cfd"),a("bada"),a("40c5"),a("23cc"),a("0b34"),a("b9da")),n=a("8333"),l=a("7300"),o=a("5873"),c=a("ddf2"),d=a("80ea"),u=a("ae0a"),f=a("97a3"),h=a("652a"),m=a("1269"),p=new h["a"],b=function(e){function t(){var e,a;Object(l["a"])(this,t);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return a=Object(o["a"])(this,(e=Object(c["a"])(t)).call.apply(e,[this].concat(i))),Object(f["a"])(Object(d["a"])(a),"__name","Storage"),Object(f["a"])(Object(d["a"])(a),"scode",p.charField({require:!1,fieldName:"备件仓库编号",visible:!0,rules:[function(e){return!e||/^[\w|-]+$/.test(e)||"只能是数字,字母,下划线"}]})),Object(f["a"])(Object(d["a"])(a),"sname",p.charField({require:!0,fieldName:"备件仓库名称",rules:[function(e){return!!e||"必填项"}]})),Object(f["a"])(Object(d["a"])(a),"address",p.charField({require:!0,fieldName:"备件仓库地址",rules:[function(e){return!!e||"必填项"}]})),Object(f["a"])(Object(d["a"])(a),"contact",p.charField({require:!0,fieldName:"仓库负责人",visible:!1,rules:[function(e){return!!e||"必填项"}]})),Object(f["a"])(Object(d["a"])(a),"uname",p.charField({require:!1,fieldName:"仓库负责人",editable:!1})),Object(f["a"])(Object(d["a"])(a),"phone",p.charField({require:!1,fieldName:"电话"})),Object(f["a"])(Object(d["a"])(a),"departmentId",p.charField({require:!1,fieldName:"负责部门",visible:!1})),Object(f["a"])(Object(d["a"])(a),"oname",p.charField({editable:!1,visible:!1,fieldName:"负责部门"})),Object(f["a"])(Object(d["a"])(a),"createdTime",p.charField({require:!1,fieldName:"创建日期",editable:!1})),a}return Object(u["a"])(t,e),t}(m["a"]),v=a("55b3"),g=a("a2a7"),x=a("d5b3"),S=a("f19a"),I=new n["a"](new b),w={data:function(){var e=this;return{base64:"",searchValue:"",Storage:{},sort:!0,headerBtns:[{disabled:!this.$per("Storage","c"),text:"添加",icon:"self_add",click:function(){return e.$refs.childGridTemplate.GridAdd()}},{disabled:!this.$per("Storage","u"),text:"编辑",icon:"self_edit",click:function(){return e.$refs.childGridTemplate.GridEdit()}},{disabled:!this.$per("Storage","d"),text:"删除",icon:"self_delete",click:function(){return e.$refs.childGridTemplate.GridDelete()}},{disabled:!this.$per("Storage","import"),text:"导入",icon:"self_import",click:function(){return e.importStorage()}},{disabled:!this.$per("Storage","e"),text:"导出",icon:"self_export",click:function(){return e.exportStorage()}},{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(e){return"/api/Storage"==e.pvalue&&"库位管理"==e.pname}))),text:"库位管理",icon:"self_inventorymanagement",click:function(){return e.locationManage()}}],IsShow:!1,IsShowImport:!1,IsShowDetails:!1,storageDetail:{},editStorage:{},showItem:{},orgList:[],userList:[],userSelectList:[],departmentId:"",phone:"",contact:""}},components:{gridTemplate:s["a"],UploadFile:v["a"],contentModal:g["a"],treeCombo:S["a"]},mounted:function(){this.Storage=new b,this.initizition()},watch:{departmentId:{handler:function(e){var t=this;if(null!=e&&e.length>0){t.userSelectList=t.userList.filter((function(t){return t.organizations.includes(e[0])}));var a=t.userSelectList.find((function(e){return e.id==t.contact}));(void 0==a||null==a||a&&a.length<=0)&&(t.contact="",t.phone="")}else t.userSelectList=null,t.contact="",t.phone=""},deep:!0},contact:{handler:function(e){if(e){var t=this.userSelectList.find((function(t){return t.id==e}));t.phone?this.phone=t.phone:this.phone=""}else this.phone=""},deep:!0}},methods:{initizition:function(){var e=this;this.$Server.queryAll("Organization").then((function(t){e.orgList=t.datas})),this.$Server.queryAll("User").then((function(t){e.userList=t.datas}))},doSearch:function(){var e=this;this.$refs.childGridTemplate.doSearch({searchfx:e.searchValue})},clearMessage:function(){this.$refs.childGridTemplate.doSearch({})},editorsReCode:function(e){this.$refs.childGridTemplate.editors=e.filter((function(e){return"scode"==e.field||"sname"==e.field})),this.editStorage=e},beforeEdit:function(e,t){var a=t.scode,r=t.sname,i=t.address,s=t.contact,n=t.phone,l=t.departmentId;this.showItem={scode:a,sname:r,address:i,contact:s,phone:n,departmentId:l},this.departmentId=[this.showItem.departmentId],this.contact=t.contact},beforeAdd:function(){this.contact="",this.departmentId=[],this.showItem.address=""},beforeEditSubmit:function(e){this.departmentId&&(e.departmentId=this.departmentId[0]),e.contact=this.contact,e.address=this.showItem.address},Search:function(){var e=this.searchfx,t=this,a={};null!=e&&(a={searchfx:e}),this.$Server.queryAll(I.getModelName(),{},a).then((function(e){t.$refs.childGridTemplate.DataSource=e.datas,t.$refs.childGridTemplate.totalDatas=e.page.total}),(function(e){return x["a"].alert(e)}))},exportStorage:function(){this.$Server.exportFile(I.getModelName(),"备件仓库管理"+this.$Utils.getLocalFotmatTime())},locationManage:function(){var e=this.$refs.childGridTemplate.getSelectedItems();null!=e&&e.length?this.$router.push({path:"/storageLocation",query:{storageId:e[0].id}}):x["a"].alert("请选择一个仓库")},importStorage:function(){this.IsShowImport=!0},getFormData:function(e){var t=this,a=e.get("data");if(a){var r=a.name.substring(a.name.lastIndexOf(".")+1,a.name.length);"xls"!=r&&"xlsx"!=r&&(x["a"].alert("请检查文件是否为Excel文件"),t.$refs.uploadFile.clearFile())}},modalClosedImport:function(){this.IsShowImport=!1,this.$refs.uploadFile.clearFile()},ComfirmImport:function(){var e=this,t=this.$refs.uploadFile.filename,a={base64:this.base64,fileName:t,fileType:"xls"};null==this.base64||0==this.base64.length?x["a"].alert("请选择导入的文件"):this.$Server.importFile(I.getModelName(),a).then((function(t){t.success&&null==t.datas.error?(x["a"].alert("导入成功","success"),e.$refs.uploadFile.clearFile(),e.IsShowImport=!1,e.$refs.childGridTemplate.init({})):x["a"].alert(t.datas.error)}),(function(e){return x["a"].alert(e)}))},downloadTemp:function(){var e=document.createElement("a");e.href="/imporTemp/storage.xls",e.download="备件仓库管理.xls",e.click()},modalClosed:function(){this.IsShowDetails=!1},rowDbClick:function(e,t){this.storageDetail.departmentID="",this.storageDetail=e,this.IsShowDetails=!0}}},k=w,y=a("6691"),D=Object(y["a"])(k,r,i,!1,null,null,null);t["default"]=D.exports}}]);