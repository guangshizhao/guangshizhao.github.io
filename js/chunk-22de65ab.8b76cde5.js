(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22de65ab"],{"0c10":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-form",{ref:"form1",attrs:{"lazy-validation":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"取消原因",rules:[e.rules.required]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            取消原因: "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.item.cancelReason,callback:function(t){e.$set(e.item,"cancelReason",t)},expression:"item.cancelReason"}})],1)],1)],1)],1)],1)},i=[],r=(a("d5b3"),{name:"CancelTask",data:function(){return{rules:{required:function(e){return!!e||"必填项"}}}},props:["item"],methods:{validate:function(){return 1==this.$refs.form1.validate()},resetValid:function(){this.$refs.form1.resetValidation(),this.$refs.form1.reset()}}}),n=r,o=a("6691"),l=Object(o["a"])(n,s,i,!1,null,"058eafcc",null);t["a"]=l.exports},"2cda":function(e,t,a){"use strict";var s=a("71cd"),i=a.n(s);i.a},"6dd2":function(e,t,a){},"71cd":function(e,t,a){},a306:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContentHeader",{attrs:{title:"维修工单",buttons:e.headerBtns}},[a("v-text-field",{staticStyle:{width:"280px"},attrs:{label:"请输入工单编号或维修人员","hide-details":"","single-line":"",primary:"",clearable:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchfx,callback:function(t){e.searchfx=t},expression:"searchfx"}})],1),a("layContent",[a("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,sort:e.sort,DataSource:e.DataSource,hideOperation:!0,formatFields:e.formatFields,total:e.total},on:{rowDbClick:e.rowDbClick,initialize:e.initTable}}),a("contentModal",{attrs:{title:e.title,IsShow:e.IsShow,width:"1100"},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[a("repairTaskDetail",{ref:"addOrUpdate",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:e.titleForSee,IsShow:e.IsShowForSee,isDetails:!0,width:"1100"},on:{modalClosed:function(t){return e.modalClosedForSee()}}},[a("repairTaskTaskSee",{ref:"See",attrs:{item:e.detailForUpdate}})],1),a("distributeUser",{attrs:{title:"分配负责人",IsShow:e.IsShowUser,isDetails:!0},on:{modalClosed:function(t){return e.modalClosedUser()},modalComfirmed:function(t){return e.modalComfirmedUser()}}},[a("mergeTable",{ref:"childDataTableUser",attrs:{headers:e.headerUsers,formatFields:{reportTime:function(e){if(e)return e.substring(0,16)}},items:e.DataSourceUser,totalDatas:e.totalDatas,hideOperation:!0,hideHeaders:!1,total:e.totalDatas},on:{chooseAssignedUser:e.chooseAssignedUser,selectChangeForSave:e.selectChangeForSave}})],1),a("repairTaskWorksheet",{attrs:{titleWorksheet:e.titleWorksheet,item:e.detailForUpdate,IsShowWorksheet:e.IsShowWorksheet},on:{modalClosedWorksheet:function(t){return e.modalClosedWorksheet()},modalWaitComfirmedWorksheet:function(t){return e.modalWaitComfirmedWorksheet()},modalNowComfirmedWorksheet:function(t){return e.modalNowComfirmedWorksheet()}}}),a("contentModal",{attrs:{title:e.titleDeal,item:e.detailForUpdate,IsShow:e.IsShowDeal},on:{modalClosed:function(t){return e.modalClosedDeal()},modalComfirmed:function(t){return e.modalComfirmedDeal()}}},[a("repairTaskDeal",{ref:"Deal",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:"同步知识库",IsShow:e.IsShowKnow,width:"1100",cancelDrag:!0},on:{modalClosed:function(t){return e.modalClosedKnow()},modalComfirmed:function(t){return e.modalComfirmedKnow()}}},[a("knowledgeDetail",{ref:"addOrUpdateKnow",attrs:{item:e.detailForUpdate}})],1),a(e.currentView,{ref:"componentForm",tag:"component",attrs:{processKey:e.processKey,PreviewType:e.PreviewType,objectId:e.objectId},on:{modalComfirmed:e.formComfirmed}}),a("contentModal",{attrs:{title:"取消原因",IsShow:e.IsShowCancelTask,width:"1100"},on:{modalComfirmed:function(t){return e.modalComfirmedCancelTask()},modalClosed:function(t){return e.modalClosedCancelTask()}}},[a("CancelTask",{ref:"CancelTask",attrs:{item:e.detailForUpdate}})],1)],1)],1)},i=[],r=(a("4634"),a("cc1d"),a("e6d1"),a("de90"),a("0c10")),n=a("8c84"),o=a("52d6"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-dialog",{attrs:{"max-width":"1100px",persistent:!0,scrollable:""},model:{value:e.IsShow,callback:function(t){e.IsShow=t},expression:"IsShow"}},[a("v-card",[a("v-card-title",{staticClass:"primary"},[a("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("分配负责人")])]),a("v-card-text",[e._t("default")],2),a("v-card-actions",{staticClass:"marginbottom"},[a("v-spacer"),a("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.modalComfirmed()}}},[e._v("一键分配")]),a("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.modalClosed()}}},[e._v("关闭")])],1)],1)],1)],1)},d=[],c={name:"distributeUser",props:["IsShow"],methods:{modalComfirmed:function(){this.$emit("modalComfirmed")},modalClosed:function(){this.$emit("modalClosed")}}},m=c,u=a("6691"),f=Object(u["a"])(m,l,d,!1,null,"617acb0d",null),p=f.exports,h=a("83b4"),v=a("d5b3"),g=a("8333"),S=a("a2a7"),x=(a("23f5"),a("f05f")),w=a("681f"),b=a("531b"),k=a("ce72"),T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{"grid-list-md":""}},[""!=e.item?a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("p",{staticClass:"title"},[e._v("报修情况")])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            工单编号："),a("span",[e._v(e._s(e.item.code))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            报修人："),a("span",[e._v(e._s(e.item.applicantName))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            报修时间："),a("span",[e._v(e._s((e.item.reportTime||"").substring(0,16)))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            报修设备："),a("span",[e._v(e._s(e.item.equipmentCodeName))])]),a("v-flex",{attrs:{xs8:""}},[e._v("            \n            设备位置："),a("span",[e._v(e._s(e.item.equipmentPosition))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            故障类型："),a("span",[e._v(e._s(e.item.faultType&&e.item.faultType.dname))])]),a("v-flex",{attrs:{xs8:""}},[e._v("\n            故障位置："),a("span",[e._v(e._s(e.item.faultPosition))])]),a("v-flex",{attrs:{xs12:""}},[e._v("\n            故障描述："),a("span",[e._v(e._s(e.item.faultDescription))])]),a("v-flex",{attrs:{xs7:""}},[e._v("\n            紧急程度："),a("span",[e._v(e._s(e.item.urgency&&e.item.urgency.dname))])]),a("v-flex",{attrs:{xs12:""}},[e._v("\n            紧急备注："),a("span",[e._v(e._s(e.item.urgentDescription))])])],1):e._e(),a("div",{staticClass:"line"}),"未开始"!==(e.item.state&&e.item.state.dname)?a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("p",{staticClass:"title"},[e._v("维修情况")])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            派工时间："),a("span",[e._v(e._s((e.item.assignmentTime||"").substring(0,16)))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            维修开始时间："),a("span",[e._v(e._s((e.item.startTime||"").substring(0,16)))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            完成时间："),a("span",[e._v(e._s((e.item.endTime||"").substring(0,16)))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n            维修人员："),a("span",[e._v(e._s(e.item.repairPersonListString))])]),a("v-flex",{attrs:{xs8:""}},[e._v("\n            处理状态："),a("span",[e._v(e._s(e.item.state&&e.item.state.dname))])]),a("v-flex",{attrs:{xs12:""}},[e._v("\n            维修详情："),a("span",[e._v(e._s(e.item.repairDetail))])]),a("v-flex",{attrs:{xs12:""}},[a("p",{},[e._v("备件使用情况：")])])],1):e._e(),e._l(e.item.rspList,(function(t,s){return"未开始"!==(e.item.state&&e.item.state.dname)?a("v-layout",{key:s,staticStyle:{padding:"0 20px"},attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs6:""}},[e._v("\n            名称："),a("span",[e._v(e._s(t.sparePartsNameAndCode))])]),a("v-flex",{attrs:{xs6:""}},[e._v("\n            数量："),a("span",[e._v(e._s(t.amount))])])],1):e._e()})),a("v-layout",{staticStyle:{padding:"0 20px"},attrs:{row:"",wrap:""}},["已取消"==(e.item.state&&e.item.state.dname)?a("v-flex",{staticStyle:{"margin-top":"15px"},attrs:{xs12:""}},[e._v("\n            取消原因："),a("span",[e._v(e._s(e.item.cancelReason))])]):e._e()],1),e.item.state&&"未开始"!=e.item.state.dname&&e.isShowImage?a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",[a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("任务进度:")])]),a("div",{staticClass:"image-wrapper"},[a("img",{attrs:{src:e.imagesrc}})])])],1):e._e()],2)},_=[],U={name:"repairTaskSee",props:["item"],data:function(){return{isShowImage:!1,imagesrc:""}},watch:{item:{handler:function(e){this.isShowImage=!1,e&&e.state&&e.state.dvalue&&0!=e.state.dvalue&&this.getProcessId(e)},deep:!0}},methods:{downloadTemp:function(e,t){var a=document.createElement("a");a.href=t,a.download=e,a.click()},getProcessId:function(e){var t=this;t.imagesrc="",t.isShowImage=!1,b["a"].http(window.processForUrl.getUrlForInstanceId(e.id),"get","",{success:function(e){if(e.data&&e.data.data&&e.data.data.id){var a=e.data.data.id;t.seeImage(a)}}})},seeImage:function(e){var t=this;b["a"].http(window.processForUrl.getUrlForInstanceTrace(e),"get",{},{success:function(e){t.imagesrc=e.data.data.image,t.isShowImage=!0}})}}},C=U,I=(a("c191"),Object(u["a"])(C,T,_,!1,null,"540d8007",null)),D=I.exports,F=a("bb20"),y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-dialog",{attrs:{"max-width":"1000px",persistent:!0,scrollable:""},model:{value:e.IsShowWorksheet,callback:function(t){e.IsShowWorksheet=t},expression:"IsShowWorksheet"}},[a("v-card",[a("v-card-title",{staticClass:"primary"},[a("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v(e._s(e.titleWorksheet))])]),a("v-card-text",[a("v-form",{ref:"form1",attrs:{"lazy-validation":""}},[a("v-container",{attrs:{"grid-list-md":""}},[""!=e.item?a("v-layout",{staticStyle:{padding:"0 20px"},attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("p",{staticClass:"title"},[e._v("报修情况")])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n                            工单编号："),a("span",[e._v(e._s(e.item.code))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n                            报修人："),a("span",[e._v(e._s(e.item.applicantName))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n                            报修时间："),a("span",[e._v(e._s((e.item.reportTime||"").substring(0,16)))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n                            报修设备："),a("span",[e._v(e._s(e.item.equipmentName))])]),a("v-flex",{attrs:{xs8:""}},[e._v("\n                            设备位置："),a("span",[e._v(e._s(e.item.equipmentPosition))])]),a("v-flex",{attrs:{xs4:""}},[e._v("\n                            故障类型："),a("span",[e._v(e._s(e.item.faultType&&e.item.faultType.dname))])]),a("v-flex",{attrs:{xs8:""}},[e._v("\n                            故障位置："),a("span",[e._v(e._s(e.item.faultPosition))])]),a("v-flex",{attrs:{xs12:""}},[e._v("\n                            故障描述："),a("span",[e._v(e._s(e.item.faultDescription))])]),a("v-flex",{attrs:{xs7:""}},[e._v("\n                            紧急程度："),a("span",[e._v(e._s(e.item.urgency&&e.item.urgency.dname))])]),a("v-flex",{attrs:{xs12:""}},[e._v("\n                            紧急备注："),a("span",[e._v(e._s(e.item.urgentDescription))])]),a("div",{staticClass:"line"}),a("v-flex",{attrs:{xs12:""}},[a("p",{staticClass:"title"},[e._v("现场情况")])]),a("v-flex",{attrs:{xs6:""}},[a("v-datetime-picker",{attrs:{label:"派工时间",clearText:"",okText:"确定",rules:[function(e){return!!e||"必填项"}],prependIcon:"star",model:"String",locale:"zh-cn"},model:{value:e.item.assignmentTime,callback:function(t){e.$set(e.item,"assignmentTime",t)},expression:"item.assignmentTime"}})],1),a("v-flex",{attrs:{xs6:""}},[a("v-select",{attrs:{items:e.item.userList,label:"处理人员","item-value":"id","item-text":"uname",multiple:"","single-line":"",clearable:"",rules:[e.rules.required]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                                    处理人员: "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}],null,!1,3680181067),model:{value:e.item.repairPersonList,callback:function(t){e.$set(e.item,"repairPersonList",t)},expression:"item.repairPersonList"}})],1),a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"现场情况描述："},model:{value:e.item.accualDescription,callback:function(t){e.$set(e.item,"accualDescription",t)},expression:"item.accualDescription"}})],1),a("v-flex",{attrs:{xs6:""}},[a("v-datetime-picker",{attrs:{label:"计划维修时间",clearText:"",okText:"确定",model:"String",locale:"zh-cn"},model:{value:e.item.planRepairTime,callback:function(t){e.$set(e.item,"planRepairTime",t)},expression:"item.planRepairTime"}})],1)],1):e._e()],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.modalNowComfirmedWorksheet()}}},[e._v("立即执行")]),a("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.modalWaitComfirmedWorksheet()}}},[e._v("稍后执行")]),a("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.modalClosedWorksheet()}}},[e._v("取消")])],1)],1)],1)},$=[],O=a("1d18"),N=(a("a1de"),a("1d53")),W={name:"repairTaskWorksheet",data:function(){return{valid:!0,timeWorkModal:!1,timeWorkPlanModal:!1,rules:{required:function(e){return!!e||"必填项"}},equipmentList:[],faultTypeList:[],urgencyList:[]}},props:["item","titleWorksheet","IsShowWorksheet"],components:{selectUser:O["a"],contentModal:S["a"],datePicker:N["a"]},computed:{},created:function(){var e=this;e.$Server.queryAll("Datadict",{},{dname:"紧急程度"}).then((function(t){e.urgencyList=t.datas}),(function(e){})),e.$Server.queryAll("Datadict",{},{dname:"故障类型"}).then((function(t){e.faultTypeList=t.datas}),(function(e){})),e.$Server.queryAll("Equipment",null,{deleted:!1}).then((function(t){e.equipmentList=t.datas}))},methods:{validate:function(){if(1==this.$refs.form.validate()){var e=this.$refs.selectUser.getselectUserList();return e&&e.length>0&&(this.item.userList=this.$refs.selectUser.getselectUserList()),!0}return!1},getFormData:function(e){console.log(e)},changePosition:function(){var e=this;this.item.equipmentPosition=this.equipmentList.filter((function(t){return t.id==e.item.equipmentID}))[0].equipmentPosition},workChangeValue:function(e){e.length>0&&(this.item.repairPersonListString+=e[0].loginName,this.item.repairPersonList.push(e[0].id))},modalClosedWorksheet:function(){this.$emit("item",this.item),this.$emit("modalClosedWorksheet")},modalNowComfirmedWorksheet:function(){this.$emit("item",this.item),this.$emit("modalNowComfirmedWorksheet")},modalWaitComfirmedWorksheet:function(){this.$emit("item",this.item),this.$emit("modalWaitComfirmedWorksheet")}}},P=W,R=(a("2cda"),Object(u["a"])(P,y,$,!1,null,"eea9bd74",null)),L=R.exports,M=a("c27d"),q=a("6bf2"),A=a.n(q),J=new g["a"](new h["a"]),K={name:"repairTask",data:function(){var e=this;return{initObject:{id:"",stoppageTaskCode:"",stoppageType:"",urgency:"",deadline:"",applicantName:"",state:{dname:""},description:"",eqpId:[],equipmentName:{},selectAssign:[],documentList:[],planRepairTime:"",reportTime:"",knowledgeDocumentList:[{documentViewModel:{}}],faultType:""},searchfx:"",sort:!0,total:1,DataSource:[],title:"添加维修工单",IsShow:!1,IsAddOp:!0,detailForUpdate:{},IsShowForSee:!1,titleDeal:"维修处理单",titleForSee:"维修工单详情",titleWorksheet:"维修工单",headerBtns:[{disabled:!this.$per("RepairTask","c"),text:"添加",icon:"self_add",click:function(){return e.tableAdd()}},{disabled:!this.$per("RepairTask","u"),text:"编辑",icon:"self_edit",click:function(){return e.tableEdit()}},{disabled:!this.$per("RepairTask","d"),text:"删除",icon:"self_delete",click:function(){return e.tableDelete()}},{disabled:!this.$per("RepairTask","c"),text:"分配人员",icon:"self_chargeperson",click:function(){return e.chooseAssignedUser(1,10)}},{disabled:!this.$per("RepairTask","exe"),text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}},{disabled:!this.$per("RepairTask","cancel"),text:"取消",icon:"self_cancel",click:function(){return e.cancelTask()}}],headerUsers:[{text:"工单编号",value:"code",sortable:!1,align:"center"},{text:"设备名称",value:"equipmentName",sortable:!1,align:"center"},{text:"设备位置",value:"equipmentPosition",sortable:!1,align:"center"},{text:"报修时间",value:"reportTime",sortable:!1,align:"center"},{text:"分配人员",value:"repairPersonList",sortable:!1,fieldType:"comboboxField",IsMultiple:!0,align:"center",comboboxSelect:"userList",itemtext:"uname",itemvalue:"id"}],currentView:"",processKey:window.process.RepairTask,PreviewType:1,IsShowKnow:!1,IsShowWorksheet:!1,IsShowDeal:!1,objectId:"",IsShowUser:!1,DataSourceUser:[],totalDatas:1,userList:[],isFirstChoose:!1,flag:!0,IsShowCancelTask:!1}},computed:{headers:function(){var e=J.formatGridHeader();return!0===this.sort&&e.unshift({text:"序号",align:"center",sortable:!1}),e},formatFields:function(){return J.getFormatFields()}},components:{DistributeUser:M["a"],contentModal:S["a"],repairTaskWorksheet:L,dataTable:x["a"],repairTaskDetail:k["a"],repairTaskTaskSee:D,distributeUser:p,mergeTable:o["a"],repairTaskDeal:F["a"],knowledgeDetail:n["a"],CancelTask:r["a"]},created:function(){this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject))},mounted:function(){},methods:{modalClosedUser:function(){this.IsShowUser=!1,this.initTable()},chooseAssignedUser:function(e,t){if(this.isFirstChoose){var a=this;this.$Server.queryAll(J.getModelName(),{page:e,rowsPerPage:t},{state:"未开始"}).then((function(e){a.totalDatas=e.page.total,a.DataSourceUser=e.datas,0==a.DataSourceUser.length?v["a"].alert("负责人分配已完成"):a.IsShowUser=!0}))}else this.isFirstChoose=!0},modalComfirmedUser:function(){var e=this,t=[],a=sessionStorage.getItem("userId");t.push({editAssignedUser:a,code:"一键分配保养人员"}),this.$Server.batchUpdate(J.getModelName(),t).then((function(t){if(t.success){var a=e.$refs.childDataTable.getPagination();e.chooseAssignedUser(a.page,a.rowsPerPage),v["a"].alert("分配负责人成功","success")}}),(function(e){v["a"].alert("分配负责人失败")}))},selectChangeForSave:function(e){var t=sessionStorage.getItem("userId");e.editAssignedUser=t,this.$Server.batchUpdate(J.getModelName(),[e]).then((function(e){e.success||v["a"].alert("分配负责人失败")}),(function(e){return v["a"].alert(e)}))},formComfirmed:function(){this.initTable()},cancelTask:function(){var e=this;1!=e.$refs.childDataTable.getCheckItems().length?v["a"].alert("请选择一项作为你取消的对象"):"进行中"==e.$refs.childDataTable.getCheckItems()[0].state.dname?e.$refs.childDataTable.getCheckItems()[0].applicant!==sessionStorage.getItem("userId")?v["a"].alert("您不是该任务的维修人，不能取消"):(e.detailForUpdate=JSON.parse(JSON.stringify(e.$refs.childDataTable.getCheckItems()[0])),e.$refs.CancelTask.resetValid(),e.IsShowCancelTask=!0):v["a"].alert("只有对进行中的维修工单处理任务才能取消！")},modalComfirmedCancelTask:function(){var e=this;1==e.$refs.CancelTask.validate()?(e.cofirmCancel(e.detailForUpdate),e.IsShowCancelTask=!1):v["a"].alert("验证错误")},modalClosedCancelTask:function(){var e=this;e.IsShowCancelTask=!1},cofirmCancel:function(e){var t=this;b["a"].http(window.processForUrl.getUrlForInstanceId(e.id),"get","",{success:function(a){a.data&&a.data.data&&a.data.data.id?b["a"].http(window.processForUrl.getUrlForInstance(a.data.data.id),"Delete","",{success:function(a){e.state.dvalue=3,t.$Server.addOrUpdate(J.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),v["a"].alert("取消成功","success"))}),(function(e){v["a"].alert(e)}))},error:function(e){v["a"].alert(e)}}):(e.state.dvalue=3,t.$Server.addOrUpdate(J.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),v["a"].alert("取消成功","success"))}),(function(e){v["a"].alert(e)})))},error:function(e){v["a"].alert(e)}})},getQueryStringArgs:function(e){if(e&&e.length>0){var t=e.length>0?e.substring(1):"",a={},s=t.length?t.split("&"):[],i=null,r=null,n=null,o=0,l=s.length;for(o=0;o<l;o++)i=s[o].split("="),r=decodeURIComponent(i[0]),n=decodeURIComponent(i[1]),r.length&&(a[r]=n);return a}return{}},excuteTask:function(){var e=this;if(1!=e.$refs.childDataTable.getCheckItems().length)v["a"].alert("请选择一项作为你执行的对象");else{var t=sessionStorage.getItem("userId"),a=JSON.parse(JSON.stringify(e.$refs.childDataTable.getCheckItems()[0]));e.objectId=a.id,"未开始"==a.state.dname?(e.detailForUpdate=a,a.repairPersonList?a.repairPersonList.filter((function(e){return e==t})).length>0?null==e.detailForUpdate.planRepairTime||""==e.detailForUpdate.planRepairTime||void 0==e.detailForUpdate.planRepairTime?(e.IsShowWorksheet=!0,e.detailForUpdate.assignmentTime=e.$Utils.getLocalTime().substring(0,16)):(e.$Server.queryAll("RepairRecord",null,{repairTaskID:e.detailForUpdate.id}).then((function(t){e.detailForUpdate.id=t.datas[0].id,e.detailForUpdate.repairTaskID=t.datas[0].repairTaskID,e.detailForUpdate.startTime=null==t.datas[0].startTime?e.$Utils.getLocalTime().substring(0,16):t.datas[0].startTime,e.detailForUpdate.endTime=t.datas[0].endTime,e.detailForUpdate.repairDetail=t.datas[0].repairDetail,e.detailForUpdate.synchronized=t.datas[0].synchronized,e.detailForUpdate.title=""})),e.IsShowDeal=!0):v["a"].alert("这条任务的负责人不是你！"):v["a"].alert("请在执行前分配人员！")):v["a"].alert("只有对未开始的维修工单才能执行！")}},modalWaitComfirmedWorksheet:function(){var e=this;null==e.detailForUpdate.planRepairTime?v["a"].alert("请选择计划维修时间！"):new Date(e.detailForUpdate.planRepairTime)<=new Date?v["a"].alert("请选择计划维修时间大于当前时间！"):(e.IsAddOp=!1,e.detailForUpdate.planRepairTime=e.$Utils.getLocalTime().substring(0,16),e.$Server.addOrUpdate(J.getModelName(),e.detailForUpdate,!e.IsAddOp).then((function(t){t.success&&(e.IsShowWorksheet=!1,e.detailForUpdate.startTime=e.$Utils.getLocalTime().substring(0,16),e.initTable())}),(function(e){v["a"].alert(e)})))},modalNowComfirmedWorksheet:function(){var e=this;e.IsAddOp=!1,e.detailForUpdate.planRepairTime=e.$Utils.getLocalTime().substring(0,16),e.$Server.addOrUpdate(J.getModelName(),e.detailForUpdate,!e.IsAddOp).then((function(t){t.success&&(e.IsShowWorksheet=!1,e.detailForUpdate.startTime=e.$Utils.getLocalTime().substring(0,16),e.$Server.queryAll("RepairRecord",null,{repairTaskID:e.detailForUpdate.id}).then((function(t){e.detailForUpdate.id=t.datas[0].id,e.detailForUpdate.repairTaskID=t.datas[0].repairTaskID,e.detailForUpdate.startTime=null==t.datas[0].startTime?e.detailForUpdate.startTime:t.datas[0].startTime,e.detailForUpdate.endTime=t.datas[0].endTime,e.detailForUpdate.repairDetail=t.datas[0].repairDetail,e.detailForUpdate.synchronized=t.datas[0].synchronized})),e.IsShowDeal=!0,e.initTable())}),(function(e){v["a"].alert(e)}))},modalClosedWorksheet:function(){this.IsShowWorksheet=!1},modalClosedDeal:function(){this.IsShowDeal=!1,this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject))},modalComfirmedDeal:function(){var e=this;if(1==e.$refs.Deal.validate()){var t=JSON.parse(JSON.stringify(e.detailForUpdate));e.detailForUpdate.synchronized?(e.$refs.addOrUpdateKnow.$refs.form.resetValidation(),e.IsShowKnow=!0,e.$refs.addOrUpdateKnow.setEditor(t.repairDetail)):(e.detailForUpdate.state.dvalue=1,e.$Server.addOrUpdate("RepairRecord",e.detailForUpdate,!0).then((function(t){t.success&&(e.IsShowDeal=!1,e.initTable())}),(function(e){v["a"].alert(e)})),e.excute())}},excute:function(){var e=this;b["a"].http(window.processForUrl.getUrlForFirst(e.processKey),"get","",{success:function(t){var a=t.data.data,s=t.data.data.formKey,i={};s.indexOf("?")>-1&&(i=e.getQueryStringArgs(s.substring(s.indexOf("?"),s.length)),s=s.substring(0,s.indexOf("?")));var r=e.$getFrom("baseForm");r&&-1!=r&&(e.currentView=r,setTimeout((function(){e.$refs.componentForm.modalOpen(s,i,a)}),200))},error:function(e){v["a"].alert(e)}})},modalComfirmedKnow:function(){var e=this;if(e.$refs.addOrUpdateKnow.validate()){var t=JSON.parse(JSON.stringify(e.detailForUpdate));t.categoryID=t.categoryID.toString(),e.$Server.addOrUpdate("RepairRecord",t,!0).then((function(t){t.success&&(e.IsShowDeal=!1,e.IsShowKnow=!1,e.initTable(),e.excute())}),(function(e){v["a"].alert(e)}))}},modalClosedKnow:function(){this.IsShowKnow=!1},tableAdd:function(){var e=this;this.resetForm(),this.IsAddOp=!0,this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject)),this.$nextTick((function(){e.detailForUpdate.applicantName=window.sessionStorage.getItem("uname")})),this.detailForUpdate.userViewModel=[JSON.parse(sessionStorage.getItem("userViewModel"))],this.detailForUpdate.reportTime=A()(new Date).format("YYYY-MM-DD hh:mm:ss"),this.title="添加维修工单任务",this.IsShow=!0},tableEdit:function(){var e=this;if(e.resetFormValidation(),e.IsAddOp=!1,e.title="编辑维修工单任务",1!=e.$refs.childDataTable.getCheckItems().length)v["a"].alert("请选择一项作为你修改的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0];"未开始"==t.state.dname?(e.detailForUpdate=JSON.parse(JSON.stringify(t)),e.detailForUpdate.equipmentID=[e.detailForUpdate.equipmentID],e.detailForUpdate.userViewModel=[e.detailForUpdate.userViewModel],e.IsShow=!0):v["a"].alert("只有对未开始的维修工单任务才能编辑！")}},doSearch:function(){var e=this.$refs.childDataTable.getPagination();1==e.page?this.initTable(e):this.$refs.childDataTable.setPage(1)},clearMessage:function(){this.searchfx="",this.doSearch()},initTable:function(e){var t=this;e&&e.page||(e=this.$refs.childDataTable.getPagination()),t.$refs.childDataTable.unCheckItems(),t.DataSource=[],t.$Server.queryAll(J.getModelName(),{page:e.page,rowsPerPage:e.rowsPerPage},{searchfx:t.searchfx}).then((function(e){t.$refs.childDataTable.unCheckItems(),t.DataSource=e.datas,t.DataSource.forEach((function(e){e.knowledgeDocumentList=[],e.state&&e.state.dname&&("未开始"==e.state.dname||"已取消"==e.state.dname)?e.stateName=t.$Utils.setStart(e.state.dname):e.state&&e.state.dname&&"进行中"==e.state.dname?e.stateName=t.$Utils.setRed(e.state.dname):e.state&&e.state.dname&&"已完成"==e.state.dname&&(e.stateName=t.$Utils.setSuccess(e.state.dname))})),t.total=e.page.total}),(function(e){}))},rowDbClick:function(e){this.detailForUpdate=JSON.parse(JSON.stringify(e)),this.titleForSee="维修工单任务详情",this.IsShowForSee=!0},modalComfirmed:function(){var e=this;1==e.$refs.addOrUpdate.validate()&&e.flag?(e.flag=!1,e.$Server.addOrUpdate(J.getModelName(),e.detailForUpdate,!e.IsAddOp).then((function(t){t.success&&(e.IsShow=!1,e.detailForUpdate=JSON.parse(JSON.stringify(e.initObject)),e.initTable(),v["a"].alert("保存成功","success")),e.flag=!0}),(function(t){v["a"].alert(t),e.flag=!0}))):v["a"].alert("验证不通过")},modalClosed:function(){this.IsShow=!1,this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject))},resetFormValidation:function(){this.$refs.addOrUpdate.$refs.form.resetValidation()},resetForm:function(){this.$refs.addOrUpdate.$refs.form.reset(),this.$refs.addOrUpdate.$refs.form.resetValidation()},modalClosedForSee:function(){this.IsShowForSee=!1},cofirmDelete:function(){var e=this,t=this.$refs.childDataTable.getCheckItems();e.$Server.batchDelete(J.getModelName(),t).then((function(){e.initTable()}),(function(e){v["a"].alert(e)}))},tableDelete:function(){var e=this;if(e.$refs.childDataTable.getCheckItems().length<=0)v["a"].alert("请选中需要删除的项");else{for(var t=!0,a=0;a<e.$refs.childDataTable.getCheckItems().length;a++)if("未开始"!=e.$refs.childDataTable.getCheckItems()[a].state.dname){t=!1;break}t?w["a"].confirm("确定删除所选维修工单?","提示",500,(function(){e.cofirmDelete()}),(function(){})):v["a"].alert("只有对未开始的维修工单才能删除！")}}}},V=K,j=Object(u["a"])(V,s,i,!1,null,"7b37bbbf",null);t["default"]=j.exports},c191:function(e,t,a){"use strict";var s=a("6dd2"),i=a.n(s);i.a},c27d:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-dialog",{attrs:{"max-width":"1100px",persistent:!0,scrollable:""},model:{value:e.IsShow,callback:function(t){e.IsShow=t},expression:"IsShow"}},[a("v-card",[a("v-card-title",{staticClass:"primary"},[a("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("分配负责人")])]),a("v-card-text",[e._t("default")],2),a("v-card-actions",{staticClass:"marginbottom"},[a("v-spacer"),a("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.modalComfirmed()}}},[e._v("一键分配")]),a("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.modalClosed()}}},[e._v("关闭")])],1)],1)],1)],1)},i=[],r={name:"distributeUser",props:["IsShow"],methods:{modalComfirmed:function(){this.$emit("modalComfirmed")},modalClosed:function(){this.$emit("modalClosed")}}},n=r,o=a("6691"),l=Object(o["a"])(n,s,i,!1,null,"50e75e90",null);t["a"]=l.exports}}]);