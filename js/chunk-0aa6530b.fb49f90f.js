(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0aa6530b"],{"163f":function(e,t,i){"use strict";var a=i("e6f0"),s=i.n(a);s.a},"1b6f":function(e,t,i){"use strict";var a=i("a6aa"),s=i.n(a);s.a},"1d10":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("layContentHeader",{attrs:{title:"点巡检工单",buttons:e.headerBtns}},[i("v-text-field",{staticStyle:{width:"310px"},attrs:{label:"请输入点巡检工单编号或负责人","hide-details":"","single-line":"",primary:"",clearable:"",disabled:e.isActive},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[i("v-icon",{attrs:{disabled:e.isActive},on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1),i("layContent",[i("div",[i("v-tabs",{attrs:{"slider-color":"primary"},model:{value:e.actives,callback:function(t){e.actives=t},expression:"actives"}},[i("v-tab",{key:1,attrs:{actives:1},on:{click:function(t){e.isActive=!1}}},[e._v("\n          点巡检工单\n        ")]),i("v-tab",{key:2,attrs:{actives:2},on:{click:function(t){e.isActive=!0}}},[e._v("\n          我的工单\n        ")]),0==e.activesChild&&1==e.isActive?i("div",{staticClass:"v-tabs__div",staticStyle:{"margin-left":"30px"}},[e._v("任务统计："+e._s(e.taskSpendTime))]):e._e(),i("v-tab-item",{key:1},[i("div",[i("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,DataSource:e.DataSource1,allowActive:!0,hideOperation:!0,formatFields:e.FormatFields,childheaders:e.childheaders,sort:!0,childformatFields:e.childformatFields,allowActiveChildren:!0,total:e.total},on:{rowDbClick:e.rowDbClick,initialize:e.init,rowDbChildClick:e.rowDbClickSubTask}})],1)]),i("v-tab-item",{key:2},[i("br"),i("v-tabs",{model:{value:e.activesChild,callback:function(t){e.activesChild=t},expression:"activesChild"}},[i("v-tab",{on:{click:function(t){e.isActive=!0}}},[e._v("\n              未完成\n            ")]),i("v-tab",{on:{click:function(t){e.isActive=!0}}},[e._v("\n              已完成\n            ")])],1),i("dataTable",{ref:"childDataTable2",attrs:{headers:e.subTaskHeaders,sort:!0,DataSource:e.subDataSource,hideOperation:!0,formatFields:e.subFormatFields,total:e.total1},on:{rowDbClick:e.rowDbClickSubTask,initialize:e.initSubTask}})],1)],1)],1)]),i("distribute-user",{attrs:{title:"分配负责人",IsShow:e.IsShow,allowActive:!1,width:1400},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[i("simpleDataTable",{ref:"childDataTable1",attrs:{headers:e.userHeaders,items:e.userDataSource,totalDatas:e.totalDatas,hideOperation:!0,hideHeaders:!1,total:e.total2},on:{selectChangeForSave:e.selectChangeForSave,chooseAssignedUser:e.chooseAssignedUser}})],1),i("distribute-task",{ref:"distributeTask",attrs:{editItem:e.editItem,IsShowTask:e.IsShowTask,distributeMethod:e.distributeMethod},on:{subTaskClosed:function(t){return e.subTaskClosed()},subTaskComfirmed:function(t){return e.subTaskComfirmed()}}}),i("distributeTaskOne",{attrs:{item:e.editItem,IsShowSubTaskOne:e.IsShowSubTaskOne},on:{subTaskOneClosed:e.subTaskOneClosed,subTaskOneComfirmed:function(t){return e.subTaskComfirmed()}}}),i("pointCheckRecord",{attrs:{IsShowRecord:e.IsShowRecord,subtaskRecord:e.subtaskRecord,subtask:e.subtask,recordDataSource:e.recordDataSource},on:{recordClosed:e.recordClosed,recordComfirmed:e.recordComfirmed,submitNotDataRecord:e.submitNotDataRecord,completeTask:e.completeTask}}),i("ReceiveTasks",{attrs:{IsShowTasks:e.IsShowTasks,subtaskSource:e.subtaskSource},on:{receiveClosed:e.receiveClosed,receiveComfirmed:e.receiveComfirmed}}),i("PointTaskDetails",{attrs:{IsShowDetail:e.IsShowDetail,pointTaskDetail:e.pointTaskDetail},on:{detailClosed:e.detailClosed}}),i("SubTaskDetails",{attrs:{IsShowSubTask:e.IsShowSubTask,subTaskDetail:e.subTaskDetail,recordDataSource:e.recordDataSource},on:{subDetailClosed:e.subDetailClosed}}),i("comfirmModal",{attrs:{title:"提示",IsShow:e.IsComfirmCancel,text:"确认取消这条任务"},on:{modalComfirmedClose:function(t){return e.modalComfirmedClose()},modalComfirmed:function(t){return e.confirmCancel()}}})],1)},s=[],r=i("60bc"),n=r["a"],o=(i("d0ed"),i("6691")),c=Object(o["a"])(n,a,s,!1,null,null,null);t["default"]=c.exports},"2fe6":function(e,t,i){},"301b":function(e,t,i){},"451e":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-dialog",{attrs:{"max-width":"1200px",persistent:!0,scrollable:""},model:{value:e.IsShowDetail,callback:function(t){e.IsShowDetail=t},expression:"IsShowDetail"}},[i("v-card",[i("v-card-title",{staticClass:"primary"},[i("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("点巡检工单详情")])]),i("v-card-text",[i("v-container",{attrs:{"grid-list-md":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs4:"",light:""}},[i("p",[e._v("点巡检编号："+e._s(e.pointTaskDetail.code))])]),i("v-flex",{attrs:{xs4:""}},[i("p",[e._v("点巡检日期："+e._s(e.pointTaskDetail.actualStartDate))])]),i("v-flex",{attrs:{xs4:""}},[i("p",[e._v("点巡检位置："+e._s(e.pointTaskDetail.taskPosition))])]),i("v-flex",{attrs:{xs4:""}},[i("p",[e._v("负责人："+e._s(e.pointTaskDetail.assignName))])]),i("v-flex",{attrs:{xs4:""}},[i("p",[e._v("状态："+e._s(null!=e.pointTaskDetail.status?e.pointTaskDetail.status.dname:""))])])],1),i("v-layout",[i("v-flex",[i("dataTable",{attrs:{headers:e.headers,DataSource:e.dataSource,hideOperation:!0,allowActive:!0,formatFields:e.FormatFields}})],1)],1)],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.detailComfirmed()}}},[e._v("关闭")])],1)],1)],1)],1)},s=[],r=(i("4634"),i("f05f")),n=i("8333"),o=i("ffdf"),c=new n["a"](new o["a"]),l={data:function(){return{headers:[{text:"任务编号",value:"code",align:"center",sortable:!1},{text:"任务名称",value:"name",align:"center",sortable:!1},{text:"任务状态",value:"status",align:"center",sortable:!1},{text:"任务开始时间",value:"startTime",align:"center",sortable:!1},{text:"任务结束时间",value:"endTime",align:"center",sortable:!1},{text:"设备",value:"equipmentName",align:"center",sortable:!1},{text:"负责人",value:"userName",align:"center",sortable:!1}],FormatFields:c.getFormatFields()}},computed:{dataSource:function(){return null!=this.pointTaskDetail.subTaskList&&this.pointTaskDetail.subTaskList.length>0?(this.pointTaskDetail.subTaskList.forEach((function(e){var t=[];e.children.length>0&&e.children.forEach((function(e){t.push(e.codeName)})),e.equipmentName=t})),this.pointTaskDetail.subTaskList):[]}},components:{dataTable:r["a"]},methods:{detailComfirmed:function(){this.$emit("detailClosed")}},props:["IsShowDetail","pointTaskDetail"]},d=l,u=i("6691"),m=Object(u["a"])(d,a,s,!1,null,null,null);t["a"]=m.exports},"561a":function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var a=i("7300"),s=i("5873"),r=i("ddf2"),n=i("80ea"),o=i("ae0a"),c=i("97a3"),l=i("652a"),d=i("1269"),u=new l["a"],m=function(e){function t(){var e,i;Object(a["a"])(this,t);for(var o=arguments.length,l=new Array(o),d=0;d<o;d++)l[d]=arguments[d];return i=Object(s["a"])(this,(e=Object(r["a"])(t)).call.apply(e,[this].concat(l))),Object(c["a"])(Object(n["a"])(i),"__name","PointInspectionTask"),Object(c["a"])(Object(n["a"])(i),"code",u.charField({require:!1,fieldName:"点巡检工单编号"})),Object(c["a"])(Object(n["a"])(i),"name",u.charField({require:!1,fieldName:"点巡检计划名称"})),Object(c["a"])(Object(n["a"])(i),"taskPosition",u.charField({require:!1,fieldName:"点巡检位置"})),Object(c["a"])(Object(n["a"])(i),"pointInspectionTime",u.dateField({require:!1,fieldName:"点巡检时间"})),Object(c["a"])(Object(n["a"])(i),"forganizationID",u.charField({require:!1,fieldName:"点巡检位置",visible:!1})),Object(c["a"])(Object(n["a"])(i),"assignedUser",u.charField({require:!1,fieldName:"负责人",visible:!1})),Object(c["a"])(Object(n["a"])(i),"assignName",u.charField({require:!1,fieldName:"负责人"})),Object(c["a"])(Object(n["a"])(i),"taskStatus",u.charField({fieldName:"拆分状态",format:function(e){return e.dname}})),Object(c["a"])(Object(n["a"])(i),"startDate",u.dateField({fieldName:"计划开始时间",visible:!1})),Object(c["a"])(Object(n["a"])(i),"endDate",u.dateField({fieldName:"计划结束时间",visible:!1})),Object(c["a"])(Object(n["a"])(i),"actualStartDate",u.dateField({fieldName:"实际点巡开始检时间",visible:!0})),Object(c["a"])(Object(n["a"])(i),"actualEndDate",u.dateField({fieldName:"实际点巡检结束时间",visible:!0})),Object(c["a"])(Object(n["a"])(i),"statusName",u.charField({fieldName:"工单状态"})),Object(c["a"])(Object(n["a"])(i),"status",u.charField({fieldName:"工单状态",visible:!1,format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),Object(c["a"])(Object(n["a"])(i),"subTaskCount",u.numberField("int",{fieldName:"任务数量",visible:!1})),Object(c["a"])(Object(n["a"])(i),"taskSplitType",u.charField({fieldName:"任务拆分方式",visible:!1})),Object(c["a"])(Object(n["a"])(i),"distributionType",u.charField({fieldName:"任务分配方式",visible:!1})),Object(c["a"])(Object(n["a"])(i),"equipList",u.charField({require:!1,visible:!1,editable:!1})),i}return Object(o["a"])(t,e),t}(d["a"])},"57af":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-dialog",{attrs:{"max-width":"1000px",persistent:!0,scrollable:""},model:{value:e.IsShowTask,callback:function(t){e.IsShowTask=t},expression:"IsShowTask"}},[i("v-form",{ref:"form",staticStyle:{width:"100%"},attrs:{valid:"true"}},[i("v-card",[i("v-card-title",{staticClass:"primary"},[i("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("分配任务")])]),i("v-card-text",[i("v-container",{attrs:{"grid-list-md":"",light:""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",[i("p",[e._v("点巡检单编号："+e._s(e.editItem.code))])]),i("v-flex",[i("p",[e._v("点巡检日期："+e._s(e.editItem.pointInspectionTime))])]),i("v-flex",[i("p",[e._v("点巡检位置："+e._s(e.editItem.taskPosition))])]),i("v-flex",[i("p",[e._v("负责人："+e._s(e.editItem.assignName))])])],1),i("v-divider"),i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs4:""}},[i("v-text-field",{attrs:{label:"子工单数量"},model:{value:e.editItem.subTaskCount,callback:function(t){e.$set(e.editItem,"subTaskCount",t)},expression:"editItem.subTaskCount"}})],1),i("v-flex",{attrs:{xs4:""}},[i("v-select",{attrs:{label:"拆分方式",items:e.taskSplitTypes,"item-text":"dname","return-object":""},model:{value:e.editItem.taskSplitType,callback:function(t){e.$set(e.editItem,"taskSplitType",t)},expression:"editItem.taskSplitType"}})],1),i("v-flex",{attrs:{xs4:""}},[i("v-btn",{on:{click:function(t){return e.clickSplitTask()}}},[e._v("拆分任务")])],1),i("v-flex",{attrs:{xs12:""}},[i("v-radio-group",{attrs:{label:"分配方式:",row:""},on:{change:function(t){return e.changeType()}},model:{value:e.editItem.distributionType,callback:function(t){e.$set(e.editItem,"distributionType",t)},expression:"editItem.distributionType"}},e._l(e.distributeMethod,(function(e){return i("v-radio",{key:e.dvalue,attrs:{label:e.dname,value:e}})})),1)],1)],1),i("v-divider"),i("v-layout",[i("h4",[e._v("任务列表")])]),null!=e.editItem.distributionType&&"手动分配"==e.editItem.distributionType.dname?i("v-layout",{attrs:{row:""}},[i("v-flex",{attrs:{xs9:""}},[i("dataTable",{ref:"childDataTable01",attrs:{headers:e.taskHeaders,sort:!1,DataSource:e.DataSource,hideOperation:!0,childheaders:e.childheaders,allowActive:!0,childformatFields:e.formatFields},on:{addItem:e.addItem,removeItem:e.removeItem,setActiveItem:e.setActiveItem}})],1),i("v-flex",{attrs:{xs1:""}}),i("v-flex",{attrs:{xs2:"","text-xs-center":""}},[e._v("\n                                人员推荐\n                                "),i("div",{staticStyle:{height:"80%",border:"1px solid rgba(0,0,0,.12)"}},[i("div",{staticClass:"personlist"},e._l(e.chooseUserList,(function(t){return i("p",{key:t.id},[i("span",[e._v(e._s(t.uname))])])})),0),i("v-btn",{attrs:{top:""},on:{click:function(t){return e.distributeUser()}}},[e._v("一键分配")])],1)])],1):e._e(),null!=e.editItem.distributionType&&"手动分配"!=e.editItem.distributionType.dname?i("v-layout",{attrs:{row:""}},[i("v-flex",{attrs:{xs12:""}},[i("dataTable",{ref:"childDataTable01",attrs:{headers:e.taskHeaders2,sort:!1,DataSource:e.DataSource,hideOperation:!0,childheaders:e.childheaders,allowActive:!0,childformatFields:e.formatFields},on:{addItem:e.addItem,removeItem:e.removeItem,setActiveItem:e.setActiveItem}})],1)],1):e._e(),i("v-divider",{staticStyle:{"margin-top":"10px"}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.IsShow,expression:"IsShow"}],staticStyle:{"margin-top":"15px"},attrs:{xs12:""}},[i("v-layout",{attrs:{row:""}},[i("h4",[e._v("任务池")])]),i("v-layout",{attrs:{row:""}},[i("v-flex",{attrs:{xs4:""}},[i("v-select",{attrs:{label:"设备类型",items:e.euqipmentList,"item-text":"dname","item-value":"dvalue",clearable:""},model:{value:e.equipType,callback:function(t){e.equipType=t},expression:"equipType"}})],1),i("v-flex",{attrs:{xs4:""}},[i("v-text-field",{attrs:{label:"设备位置"},model:{value:e.eposition,callback:function(t){e.eposition=t},expression:"eposition"}})],1),i("v-flex",{attrs:{xs4:""}},[i("v-btn",{on:{click:function(t){return e.search()}}},[e._v("查询")]),i("v-btn",{on:{click:function(t){return e.clickAdd()}}},[e._v("添加至该任务")])],1)],1),i("v-layout",{attrs:{wrap:"",row:""}},[i("v-flex",{attrs:{xs12:""}},[i("simpleDataTable",{ref:"childTable",attrs:{headers:e.childheaders,items:e.taskEquipment,allowEdit:!1,hideHeaders:!1,allowActive:!0,formatFields:e.formatFields}})],1)],1)],1)],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.subTaskComfirmed()}}},[e._v("确定")]),i("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.subTaskClosed()}}},[e._v("取消")])],1)],1)],1)],1)],1)},s=[],r=(i("cc1d"),i("fafd"),i("68e0"),i("97a3")),n=(i("de90"),i("4634"),i("f05f")),o=i("a7fe"),c=i("d5b3"),l=i("ef3e"),d=(i("d9f7"),i("9ee5")),u=i("8333"),m=new u["a"](new d["a"]),_={data:function(){return{taskHeaders:[{text:"任务编号",sortable:!1,value:"code",align:"center"},{text:"任务名称",sortable:!1,value:"name",align:"center"},{text:"调整任务",sortable:!1,value:"addOrDelete",align:"center"},{text:"分配人员",sortable:!1,value:"assignedUser",fieldType:"comboboxField",align:"center",comboboxSelect:"userList",itemtext:"uname",itemvalue:"id",inlineEdit:!0,object:!1}],taskHeaders2:[{text:"任务编号",sortable:!1,value:"code",align:"center"},{text:"任务名称",sortable:!1,value:"name",align:"center"},{text:"调整任务",sortable:!1,value:"addOrDelete",align:"center"}],items:[],taskSplitTypes:[],taskPool:[],DataSource:[],childheaders:[{text:"设备",value:"codeName",align:"center",sortable:!1},{text:"设备位置",value:"productionName",align:"center",sortable:!1},{text:"设备类型",value:"type",sortable:!1,align:"center",format:function(e){if(null!=e&&null!=e.dname)return e.dname}}],IsShow:!1,userList:[],chooseUserList:[],formatFields:m.getFormatFields(),taskEquipment:[],euqipmentList:[],equipType:[],eposition:[]}},components:{dataTable:n["a"],simpleDataTable:l["a"]},mounted:function(){this.init()},methods:{init:function(){var e=this;this.$Server.queryAll((new o["a"]).__name,{},{dname:"任务拆分方式"}).then((function(t){e.taskSplitTypes=t.datas})),this.$Server.queryAll((new o["a"]).__name,{},{dname:"设备类型"}).then((function(t){e.euqipmentList=t.datas}))},addItem:function(){this.IsShow=!0},changeType:function(){this.DataSource.forEach((function(e){e.assignedUser=""}))},removeItem:function(e){if(0==this.$refs.childDataTable01.getChildCheckItem().length)c["a"].alert("选中一个设备");else{var t=this.$refs.childDataTable01.getChildCheckItem();this.$refs.childDataTable01.getActiveItem().children.length-t.length<=0?c["a"].alert("一个子任务必须有一台设备"):(this.$refs.childDataTable01.getChildCheckItem().forEach((function(t){e.children=e.children.filter((function(e){return e.id!==t.id}))})),this.items=this.items.concat(this.$refs.childDataTable01.getChildCheckItem()),this.taskEquipment=this.items,this.$refs.childDataTable01.unChildCheckItems())}},clickAdd:function(){var e=this;if(this.$refs.childTable.getCheckItems().length>0){var t=this.$refs.childDataTable01.getActiveItem();t.children=t.children.concat(this.$refs.childTable.getCheckItems()),this.$refs.childTable.getCheckItems().forEach((function(t){e.items=e.items.filter((function(e){return e.id!=t.id}))})),this.taskEquipment=this.items}else c["a"].alert("选中一项需要添加到该任务的设备")},search:function(){var e=this;(null!=this.equipType&&void 0!=this.equipType||0==this.equipType.length)&&(this.taskEquipment=this.items.filter((function(t){return t.typeValue==e.equipType}))),""!=this.eposition&&(this.taskEquipment=this.items.filter((function(t){return t.productionName==e.eposition}))),null!=this.equipType&&void 0!=this.equipType&&0!=this.equipType.length||""!=this.eposition||(this.taskEquipment=this.items)},subTaskComfirmed:function(){this.items.length>0?c["a"].alert("还有设备未分配任务"):(this.editItem.subTaskList=this.DataSource,this.editItem.subTaskList.length>0?"手动分配"==this.editItem.distributionType.dname&&this.DataSource.filter((function(e){return null==e.assignedUser||""==e.assignedUser})).length>0?c["a"].alert("手动分配任务人员不能为空"):this.$emit("subTaskComfirmed",this.editItem):c["a"].alert("还没有分配子任务，请先分配子任务"))},subTaskClosed:function(){this.DataSource=[],this.taskEquipment=[],this.items=[],this.$emit("subTaskClosed")},setActiveItem:function(e){this.chooseUserList=e.userList,this.taskEquipment=this.items},showEquipment:function(e){"产线"==this.editItem.taskSplitType.dname?this.taskEquipment=this.items.filter((function(t){return t.equipmentPosition==e.equipmentPosition})):"设备类型"==this.editItem.taskSplitType.dname&&(this.taskEquipment=this.items.filter((function(t){return t.typeValue==e.typeValue})))},distributeUser:function(){this.DataSource.forEach((function(e){var t=Math.floor(Math.random()*e.userList.length);e.assignedUser=e.userList[t].id}))},clickSplitTask:function(){if(null==this.editItem.subTaskCount||null==this.editItem.taskSplitType)c["a"].alert("先填写拆分方式和拆分数量");else if("产线/库位"==this.editItem.taskSplitType.dname){if(null!=this.editItem.equipList&&this.editItem.equipList.length>0)if(this.editItem.equipList.length<this.editItem.subTaskCount)c["a"].alert("该任务只有"+this.editItem.equipList.length+"设备，最多可以分为"+this.editItem.equipList.length+"子任务");else{var e=this.arrayList(this.editItem.equipList,"orgType");this.arrayList(this.editItem.equipList,"equipmentPosition");if(this.editItem.equipList.length==this.editItem.subTaskCount){for(var t=[],i=0;i<this.editItem.equipList.length;i++){var a=this.editItem.equipList[i];t.push({id:this.guid(),addOrDelete:"",assignedUser:"",name:"任务"+(i+1),code:this.editItem.code+"-"+(i+1),objectId:a.equipmentPosition,userList:this.filterUser("productionId",this.editItem.userList,a.equipmentPosition),pointInspectionTaskID:this.editItem.id,children:[a]})}this.DataSource=t}else{var s=e[0].orgType,r=[],n=[];if(6==s?(e&&e[0]&&e[0].data&&(r=r.concat(e[0].data)),e&&e[1]&&e[1].data&&(n=e[1].data)):(e&&e[1]&&e[1].data&&(r=e[1].data),e&&e[0]&&e[0].data&&(n=n.concat(e[0].data))),r.length>0&&n.length>0)if(1==this.editItem.subTaskCount)c["a"].alert("该任务下有产线和库位设备，至少分两个任务");else if(2==this.editItem.subTaskCount){var o=[];o.push({id:this.guid(),addOrDelete:"",assignedUser:"",name:"任务1",code:this.editItem.code+"-1",objectId:r[0].equipmentPosition,userList:this.filterUser("productionId",this.editItem.userList,r[0].equipmentPosition),pointInspectionTaskID:this.editItem.id,children:r}),o.push({id:this.guid(),addOrDelete:"",assignedUser:"",name:"任务1",code:this.editItem.code+"-1",objectId:n[0].equipmentPosition,userList:this.filterUser("productionId",this.editItem.userList,n[0].equipmentPosition),pointInspectionTaskID:this.editItem.id,children:n}),this.DataSource=o}else{var l=this.arrayList(r,"equipmentPosition"),d=this.arrayList(n,"stationCode"),u=0;u=r.length>=this.editItem.subTaskCount-1?this.editItem.subTaskCount-1:r.length;var m=Math.ceil(r.length/u),_=this.sort(l),h=this.taskSplit(_,m,u,1),f=this.editItem.subTaskCount-u,p=this.sort(d),b=Math.ceil(n.length/f),v=this.taskSplit(p,b,f,u+1);this.DataSource=h.concat(v)}else if(r.length>0&&0==n.length){var g=Math.ceil(r.length/this.editItem.subTaskCount),k=Math.ceil(r.length/g);if(k<this.editItem.subTaskCount){var T=this.arrayList(r,"equipmentPosition"),I=this.sortAsc(T),D=Math.floor(r.length/this.editItem.subTaskCount);this.DataSource=this.splitByMin(I,D,this.editItem.subTaskCount)}else{var S=this.arrayList(r,"equipmentPosition"),E=this.sort(S);this.DataSource=this.taskSplit(E,g,this.editItem.subTaskCount)}}else if(0==r.length&&n.length>0){var x=Math.ceil(n.length/this.editItem.subTaskCount),O=Math.ceil(n.length/x);if(O<this.editItem.subTaskCount){var C=this.arrayList(n,"stationCode"),w=this.sortAsc(C),P=Math.floor(n.length/this.editItem.subTaskCount);this.DataSource=this.splitByMin(w,P,this.editItem.subTaskCount)}else{var M=this.arrayList(n,"stationCode"),y=this.sort(M);this.DataSource=this.taskSplit(y,x,this.editItem.subTaskCount)}}}}}else if("设备类型"==this.editItem.taskSplitType.dname)if(this.editItem.equipList.length<this.editItem.subTaskCount)c["a"].alert("该任务只有"+this.editItem.equipList.length+"设备，最多可以分为"+this.editItem.equipList.length+"子任务");else{this.$refs.childTable.unCheckItems();var R=this.arrayList(this.editItem.equipList,"typeValue");if(this.editItem.equipList.length==this.editItem.subTaskCount){var L=[];for(i=0;i<this.editItem.equipList.length;i++){var q=this.editItem.equipList[i];L.push({id:this.guid(),addOrDelete:"",assignedUser:"",name:"任务"+(i+1),code:this.editItem.code+"-"+(i+1),objectId:q.equipmentPosition,userList:this.filterUser("productionId",this.editItem.userList,q.equipmentPosition),pointInspectionTaskID:this.editItem.id,children:[q]})}this.DataSource=L}else{var U=Math.ceil(this.editItem.equipList.length/this.editItem.subTaskCount),j=Math.ceil(this.editItem.equipList.length/U);if(j<this.editItem.subTaskCount){var A=this.sortAsc(R),N=Math.floor(this.editItem.equipList.length/this.editItem.subTaskCount);this.DataSource=this.splitByMin(A,N,this.editItem.subTaskCount)}else{var F=this.sort(R);this.DataSource=this.taskSplit(F,U,this.editItem.subTaskCount)}}}},sort:function(e){return e.forEach((function(e){e.length=e.data.length})),e.sort((function(e,t){return e.length-t.length})).reverse()},sortAsc:function(e){return e.forEach((function(e){e.length=e.data.length})),e.sort((function(e,t){return e.length-t.length}))},arrayList:function(e,t){for(var i=e,a={},s=[],n=0;n<i.length;n++){var o,c=i[n],l=c[t];if(a[l])for(var d=0;d<s.length;d++){var u=s[d];if(l==u[t]){u.data.push(c);break}}else s.push((o={},Object(r["a"])(o,t,l),Object(r["a"])(o,"data",[c]),o)),a[l]=c}return s},filterUser:function(e,t,i){if(t.filter((function(t){return t[e]==i})).length>0)return t.filter((function(t){return t[e]==i}));var a=new Map;return t.filter((function(e){return!a.has(e.id)&&a.set(e.id,1)}))},splitByMin:function(e,t,i){for(var a=[],s=1,r=0;r<e.length;r++){var n=e[r].equipmentPosition,o=e[r].data,c=this.guid();if(i>0)while(o.length>0){var l=0;a.length>0&&void 0!=a[s-1]&&(l=a[s-1].children.length),0==i?0==l?a[s-2].children=a[s-2].children.concat(o.splice(0,o.length)):l>0&&(a[s-1].children=a[s-1].children.concat(o.splice(0,o.length))):0==l?o.length>0&&o.length>=t?(c=this.guid(),a.push({id:c,addOrDelete:"",assignedUser:"",name:"任务"+s,code:this.editItem.code+"-"+s,userList:this.filterUser("productionId",this.editItem.userList,o[0].equipmentPosition),equipmentPosition:n,pointInspectionTaskID:this.editItem.id,children:o.splice(0,t)}),i-=1,s+=1):o.length>0&&o.length<t&&(c=this.guid(),a.push({id:c,addOrDelete:"",assignedUser:"",name:"任务"+s,code:this.editItem.code+"-"+s,userList:this.filterUser("productionId",this.editItem.userList,o[0].equipmentPosition),equipmentPosition:n,pointInspectionTaskID:this.editItem.id,children:o.splice(0,o.length)})):l>0&&l<t&&(o.length>=t-l?(a[s-1].children=a[s-1].children.concat(o.splice(0,t-l)),s+=1,i-=1):o.length>0&&o.length<t-l&&(a[s-1].children=a[s-1].children.concat(o.splice(0,o.length))))}}return a},splitTaskByType:function(e,t,i){for(var a=[],s=1,r=0;r<e.length;r++){var n=e[r].equipmentPosition,o=e[r].data,c=this.guid();if(i>0)while(o.length>0){var l=0;a.length>0&&void 0!=a[s-1]&&(l=a[s-1].children.length),0==l?o.length>0&&o.length>=t?(c=this.guid(),a.push({id:c,addOrDelete:"",assignedUser:"",name:"任务"+s,code:this.editItem.code+"-"+s,userList:this.filterUser("productionId",this.editItem.userList,o[0].equipmentPosition),equipmentPosition:n,pointInspectionTaskID:this.editItem.id,children:o.splice(0,t-l)}),i-=1,s+=1):o.length>0&&o.length<t&&(c=this.guid(),a.push({id:c,addOrDelete:"",assignedUser:"",name:"任务"+s,code:this.editItem.code+"-"+s,userList:this.filterUser("productionId",this.editItem.userList,o[0].equipmentPosition),equipmentPosition:n,pointInspectionTaskID:this.editItem.id,children:o.splice(0,o.length)})):l>0&&l<t&&(o.length>=t-l?(a[s-1].children=a[s-1].children.concat(o.splice(0,t-l)),s+=1,i-=1):o.length>0&&o.length<t-l&&(a[s-1].children=a[s-1].children.concat(o.splice(0,o.length))))}}return a},guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},taskSplit:function(e,t,i,a){void 0!=a&&null!=a||(a=1);for(var s=[],r=0;r<e.length;r++){var n=e[r].equipmentPosition,o=e[r].data,c=(Math.ceil(o.length/t),this.guid());if(i>0)while(o.length>0){var l=0;s.length>0&&void 0!=s[a-1]&&(l=s[a-1].children.length),0==l?o.length>0&&o.length>=t?(c=this.guid(),s.push({id:c,addOrDelete:"",assignedUser:"",name:"任务"+a,code:this.editItem.code+"-"+a,userList:this.filterUser("productionId",this.editItem.userList,o[0].equipmentPosition),equipmentPosition:n,pointInspectionTaskID:this.editItem.id,children:o.splice(0,t)}),i-=1,a+=1):o.length>0&&o.length<t&&(c=this.guid(),s.push({id:c,addOrDelete:"",assignedUser:"",name:"任务"+a,code:this.editItem.code+"-"+a,userList:this.filterUser("productionId",this.editItem.userList,o[0].equipmentPosition),equipmentPosition:n,pointInspectionTaskID:this.editItem.id,children:o.splice(0,o.length)})):l>0&&l<t&&(o.length>=t-l?(s[a-1].children=s[a-1].children.concat(o.splice(0,t-l)),a+=1,i-=1):o.length>0&&o.length<t-l&&(s[a-1].children=s[a-1].children.concat(o.splice(0,o.length))))}}return s}},props:["editItem","IsShowTask","distributeMethod"]},h=_,f=(i("163f"),i("6691")),p=Object(f["a"])(h,a,s,!1,null,"6fc24a5d",null);t["a"]=p.exports},"5e7e":function(e,t,i){},"60bc":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("db3e"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("cc1d"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("bada"),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("7cfd"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("4634"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("0b34"),core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_5__),_components_modal_contentModal_template__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("a2a7"),_components_grid_dataTable_dataTable_vue__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("f05f"),_common_models_PointInspectionTask_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("561a"),_common_models_modelServer_ParsingInVue__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("8333"),_components_grid_simpleDataTable_mergeTable_vue__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("52d6"),_components_message__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("d5b3"),_distributeTask__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("57af"),_distributeTaskOne__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("9b06"),_common_models_PointInspectionSubTask__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("ffdf"),_common_models_PointInspectionRecord__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("e6e7"),_pointCheckRecord__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("e903"),_receiveTasks_vue__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("89f4"),_common_models_Datadict__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("a7fe"),_pointTaskDetails__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("451e"),_subTaskDetails__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("8a8a"),_components_modal_comfirmModal_template__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("23f5"),_distributeUser__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("f017"),parsing=new _common_models_modelServer_ParsingInVue__WEBPACK_IMPORTED_MODULE_9__["a"](new _common_models_PointInspectionTask_js__WEBPACK_IMPORTED_MODULE_8__["a"]),subParsing=new _common_models_modelServer_ParsingInVue__WEBPACK_IMPORTED_MODULE_9__["a"](new _common_models_PointInspectionSubTask__WEBPACK_IMPORTED_MODULE_14__["a"]);__webpack_exports__["a"]={data:function(){var e=this;return{total2:1,isFirstChoose:!1,headerBtns1:[{disabled:!0,text:"分配负责人",icon:"self_chargeperson",click:function(){return e.chooseAssignedUser()}},{disabled:!0,text:"分配任务",icon:"self_distribution",click:function(){return e.distributeTask()}},{disabled:!this.$per("PointInspectionRecord","exe"),text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}},{disabled:!this.$per("PointInspectionRecord","cancel"),text:"取消执行",icon:"self_execute",click:function(){return e.cancelTask()}},{disabled:!this.$per("PointInspectionRecord","c"),text:"领选任务",icon:"self_selectiontask",click:function(){return e.chooseTask()}}],headerBtns:[{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(e){return"/api/PointInspectionRecord"==e.pvalue&&"分配负责人"==e.pname}))),text:"分配负责人",icon:"self_chargeperson",click:function(){return e.chooseAssignedUser(1,10)}},{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(e){return"/api/PointInspectionRecord"==e.pvalue&&"分配任务"==e.pname}))),text:"分配任务",icon:"self_distribution",click:function(){return e.distributeTask()}},{disabled:!0,text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}},{disabled:!0,text:"取消执行",icon:"self_execute",click:function(){return e.cancelTask()}},{disabled:!0,text:"领选任务",icon:"self_selectiontask",click:function(){return e.chooseTask()}}],headerBtns2:[{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(e){return"/api/PointInspectionRecord"==e.pvalue&&"分配负责人"==e.pname}))),text:"分配负责人",icon:"self_chargeperson",click:function(){return e.chooseAssignedUser(1,10)}},{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(e){return"/api/PointInspectionRecord"==e.pvalue&&"分配任务"==e.pname}))),text:"分配任务",icon:"self_distribution",click:function(){return e.distributeTask()}},{disabled:!0,text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}},{disabled:!0,text:"取消执行",icon:"self_execute",click:function(){return e.cancelTask()}},{disabled:!0,text:"领选任务",icon:"self_selectiontask",click:function(){return e.chooseTask()}}],DataSource:[],headers:parsing.formatGridHeader(),childheaders:subParsing.formatGridHeader(),childformatFields:subParsing.getFormatFields(),totalDatas:0,actives:null,userDataSource:[],userHeaders:[{text:"点巡检单编号",value:"code",sortable:!1,align:"center"},{text:"点巡检计划名称",value:"name",align:"center",sortable:!1},{text:"点巡检日期",value:"pointInspectionTime",align:"center",sortable:!1},{text:"点巡检位置",value:"taskPosition",align:"center",sortable:!1},{text:"分配人员",value:"assignedUser",sortable:!1,fieldType:"comboboxField",IsMultiple:!1,align:"center",comboboxSelect:"userList",itemtext:"uname",itemvalue:"id"}],IsShow:!1,IsShowTask:!1,taskHeaders:[{text:"任务"}],editItem:{},subTaskHeaders1:[],subTaskHeaders2:[],subTaskHeaders:[],subTaskDataSource:[],FormatFields:parsing.getFormatFields(),subFormatFields:subParsing.getFormatFields(),subtaskRecord:{},subtask:{},IsShowRecord:!1,recordDataSource:[],IsShowTasks:!1,subtaskSource:[],distributeMethod:[],IsShowDetail:!1,pointTaskDetail:{},subTaskDetail:{},IsShowSubTask:!1,IsShowSubTaskOne:!1,pointSubTask:{},searchValue:"",isActive:!1,currentparams:{},currentparams1:{},total:1,total1:1,IsComfirmCancel:!1,searchCondition:"",subSearchCondition:"",btnDidabled:!1,activesChild:null,incompleteList:[],completeList:[],cancelList:[],isSubmit:!1}},components:{DistributeUser:_distributeUser__WEBPACK_IMPORTED_MODULE_22__["a"],dataTable:_components_grid_dataTable_dataTable_vue__WEBPACK_IMPORTED_MODULE_7__["a"],simpleDataTable:_components_grid_simpleDataTable_mergeTable_vue__WEBPACK_IMPORTED_MODULE_10__["a"],contentModal:_components_modal_contentModal_template__WEBPACK_IMPORTED_MODULE_6__["a"],distributeTask:_distributeTask__WEBPACK_IMPORTED_MODULE_12__["a"],distributeTaskOne:_distributeTaskOne__WEBPACK_IMPORTED_MODULE_13__["a"],pointCheckRecord:_pointCheckRecord__WEBPACK_IMPORTED_MODULE_16__["a"],ReceiveTasks:_receiveTasks_vue__WEBPACK_IMPORTED_MODULE_17__["a"],PointTaskDetails:_pointTaskDetails__WEBPACK_IMPORTED_MODULE_19__["a"],SubTaskDetails:_subTaskDetails__WEBPACK_IMPORTED_MODULE_20__["a"],comfirmModal:_components_modal_comfirmModal_template__WEBPACK_IMPORTED_MODULE_21__["a"]},mounted:function(){this.headers.unshift({text:"序号",align:"center"}),this.initization();var e=subParsing.formatGridHeader(),t=subParsing.formatGridHeader();e.unshift({text:"序号",align:"center"}),e.splice(-3,2),this.subTaskHeaders2=e,t.unshift({text:"序号",align:"center"}),this.subTaskHeaders1=t},watch:{activesChild:{handler:function(e,t){this.subSearchCondition={status:e},1==this.currentparams.page?this.initSubTask():this.$refs.childDataTable.setPage(1),this.subTaskHeaders=0==e?this.subTaskHeaders2:this.subTaskHeaders1},deep:!0},isActive:{handler:function(e,t){this.isActive=e,this.headerBtns=1==e?this.headerBtns1:this.headerBtns2},deep:!0}},computed:{subDataSource:function(){var e=this;return this.subTaskDataSource.forEach((function(t){var i=[],a=[],s=[];t.equipList.forEach((function(e){i.push("(".concat(e.code,")").concat(e.name)),a.push(e.type.dname),s.push(e.productionName)})),t.equipmentName=i,t.equipmentType=a,t.position=s,t.status&&"未开始"==t.status.dname?t.statusName=e.$Utils.setStart(t.status.dname):t.status&&"进行中"==t.status.dname&&(t.statusName=e.$Utils.setRed(t.status.dname)),t.status&&"按时完成"==t.status.dname&&(t.statusName=e.$Utils.setSuccess(t.status.dname)),t.status&&"超期完成"==t.status.dname&&(t.statusName=e.$Utils.setWarn(t.status.dname))})),this.subTaskDataSource},DataSource1:function(){var e=this;return this.DataSource.forEach((function(t){t.children.forEach((function(i){var a=[],s=[],r=[];i.equipList.forEach((function(e){a.push("(".concat(e.code,")").concat(e.name)),s.push(e.type.dname),r.push(e.productionName)})),i.equipmentName=a,i.equipmentType=s,i.position=r,i.status&&"未开始"==i.status.dname?i.statusName=e.$Utils.setStart(i.status.dname):i.status&&"进行中"==i.status.dname&&(i.statusName=e.$Utils.setRed(t.status.dname)),i.status&&"按时完成"==i.status.dname&&(i.statusName=e.$Utils.setSuccess(i.status.dname)),i.status&&"超期完成"==i.status.dname&&(i.statusName=e.$Utils.setWarn(i.status.dname))})),t.status&&"未开始"==t.status.dname?t.statusName=e.$Utils.setStart(t.status.dname):t.status&&"进行中"==t.status.dname&&(t.statusName=e.$Utils.setRed(t.status.dname)),t.status&&"已完成"==t.status.dname&&(t.statusName=e.$Utils.setSuccess(t.status.dname))})),this.DataSource},taskSpendTime:function(){var e=[];this.subTaskDataSource.forEach((function(t){var i=new Date;i.setHours(23),i.setMinutes(59),i.setSeconds(59),new Date(t.endDate)<=i&&"按时完成"!=t.status.dname&&"超期完成"!=t.status.dname&&e.push(t)}));var t=0;return e.forEach((function(e){t+=parseInt(e.spendTime)})),"你今天还需要执行"+e.length+"条任务,预计耗时"+t+"min"}},methods:{initization:function(){var e=this;this.$Server.queryAll((new _common_models_Datadict__WEBPACK_IMPORTED_MODULE_18__["a"]).__name,{},{dname:"任务分配方式"}).then((function(t){e.distributeMethod=t.datas})),e.activesChild=0},init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;null!=e.page&&(this.currentparams=e);var i=this.currentparams,a=i.page,s=i.rowsPerPage;this.$Server.queryAll(parsing.getModelName(),{page:a,rowsPerPage:s},this.searchCondition).then((function(e){t.DataSource=e.datas,null!=t.editItem&&null!=t.editItem.id&&(t.editItem=t.DataSource.find((function(e){return e.id==t.editItem.id})),t.$refs.childDataTable.getActiveItem().taskStatus=t.editItem.taskStatus),t.total=e.page.total}))},initSubTask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;null!=e.page&&(this.currentparams1=e);var i=this.currentparams1,a=i.page,s=i.rowsPerPage,r=sessionStorage.getItem("userId");this.subSearchCondition.userId=r,this.$Server.queryAll(subParsing.getModelName(),{page:a,rowsPerPage:s},this.subSearchCondition).then((function(e){t.subTaskDataSource=e.datas,t.pointSubTask&&null!=t.pointSubTask.id&&(t.pointSubTask=t.subTaskDataSource.find((function(e){return e.id==t.pointSubTask.id})),t.$refs.childDataTable2.getCheckItems()[0]=t.pointSubTask),e.datas.length>0&&(t.total1=e.page.total)}))},doSearch:function(){this.searchCondition={searchfx:this.searchValue},1==this.currentparams.page?this.init():this.$refs.childDataTable.setPage(1)},clearMessage:function(){this.searchCondition={},this.init()},chooseAssignedUser:function chooseAssignedUser(page,rowsPerPage){if(this.isFirstChoose){var _this=this;this.$Server.queryAll(parsing.getModelName(),{page:page,rowsPerPage:rowsPerPage},{chooseUser:"ssssss"}).then((function(result){_this.total2=result.page.total,result.datas.forEach((function(item){item.constructBy&&item.constructBy&&item.constructBy.dname&&"产线"==item.constructBy.dname?item.assignedUser&&(item.assignedUser,item.assignedUser=item.assignedUser[0]):item.assignedUser&&(item.assignedUser=eval("("+item.assignedUser+")"))})),_this.userDataSource=result.datas,0==_this.userDataSource.length?_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("所有任务人员都已分配"):_this.IsShow=!0}))}else this.isFirstChoose=!0},selectChangeForSave:function(e){this.$Server.batchUpdate(parsing.getModelName(),[e]).then((function(e){e.success||_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("分配负责人错误")}),(function(e){return _components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("分配负责人错误")}))},modalClosed:function(){this.IsShow=!1,this.init()},modalComfirmed:function(){var e=this;if(this.userDataSource.length>0){var t=[];t.push({id:"99999999999999"}),this.$Server.batchSave(parsing.getModelName(),t).then((function(t){if(t.success){var i=e.$refs.childDataTable1.getPagination();e.chooseAssignedUser(i.page,i.rowsPerPage),e.init(),_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("负责人分配成功","success")}}),(function(e){return _components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("分配负责人失败")}))}},guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},distributeTask:function(){var e=sessionStorage.getItem("userId"),t=sessionStorage.getItem("uname");if(null!=this.$refs.childDataTable.getActiveItem()&&null!=this.$refs.childDataTable.getActiveItem().id){var i=this.$refs.childDataTable.getActiveItem(),a=i.actualEndDate,s=i.actualStartDate,r=i.assignName,n=i.assignedUser,o=i.children,c=i.code,l=i.codeName,d=i.createdTime,u=i.creator,m=i.distributionType,_=i.endDate,h=i.equipList,f=i.equipmentID,p=i.forganizationID,b=i.gongChang,v=i.id,g=i.modifiedTime,k=i.modifier,T=i.name,I=i.pointInspectionPlanID,D=i.pointInspectionTime,S=i.startDate,E=i.status,x=i.subTaskCount,O=i.subTaskList,C=i.taskPosition,w=i.taskSplitType,P=i.taskStatus,M=i.userList;if(this.editItem={actualEndDate:a,actualStartDate:s,assignName:r,assignedUser:n,children:o,code:c,codeName:l,createdTime:d,creator:u,distributionType:m,endDate:_,equipList:h,equipmentID:f,forganizationID:p,gongChang:b,id:v,modifiedTime:g,modifier:k,name:T,pointInspectionPlanID:I,pointInspectionTime:D,startDate:S,status:E,subTaskCount:x,subTaskList:O,taskPosition:C,taskSplitType:w,taskStatus:P,userList:M},void 0!=this.editItem.assignedUser||null!=this.editItem.assignedUser)if(this.editItem.assignedUser.indexOf(e)>0&&-1!=this.editItem.assignName.search(t))if(null!=this.editItem.taskStatus&&"已拆分"==this.editItem.taskStatus.dname)_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("该任务已经拆分完成");else if(this.editItem.equipList&&1==this.editItem.equipList.length){this.editItem.subTaskList=[];var y={id:this.guid(),name:"任务1",code:this.editItem.code+"-1",userList:this.editItem.userList,equipmentPosition:this.editItem.equipList[0].equipmentPosition,children:this.editItem.equipList};this.editItem.subTaskList.push(y),this.editItem.distributionType=this.distributeMethod.find((function(e){return"手动分配"==e.dname})),this.editItem.subTaskCount=1,this.IsShowSubTaskOne=!0}else this.IsShowTask=!0,this.editItem.distributionType=this.distributeMethod.find((function(e){return"手动分配"==e.dname}));else _components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("任务需要由负责人拆分");else _components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("请先分配负责人")}else _components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("请选择一项需要拆分任务的数据")},subTaskClosed:function(){this.IsShowTask=!1},subTaskOneClosed:function(){this.IsShowSubTaskOne=!1},subTaskComfirmed:function(){if(0==this.isSubmit){this.isSubmit=!0;var e=this;this.$Server.addOrUpdate(parsing.getModelName(),this.editItem,!0).then((function(t){t.success?(e.$refs.distributeTask.subTaskClosed(),e.IsShowTask=!1,e.IsShowSubTaskOne=!1,_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("拆分任务成功","success"),e.init(),e.initSubTask(),e.isSubmit=!1):e.isSubmit=!1}),(function(t){e.isSubmit=!1}))}},excuteTask:function(){var e=this,t=this.$refs.childDataTable2.getCheckItems();if(1==t.length)if(this.pointSubTask=this.$refs.childDataTable2.getCheckItems()[0],this.subtask=this.pointSubTask,"进行中"==this.pointSubTask.status.dname)this.queryRecord(this.pointSubTask.id);else if("超期完成"==this.pointSubTask.status.dname||"按时完成"==this.pointSubTask.status.dname)_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("该任务已完成");else if("未开始"==this.pointSubTask.status.dname){var i={subTaskId:this.pointSubTask.id};this.$Server.addOrUpdate((new _common_models_PointInspectionRecord__WEBPACK_IMPORTED_MODULE_15__["a"]).__name,i,!1).then((function(t){t.success&&(e.init(),e.initSubTask(),e.queryRecord(e.pointSubTask.id))}))}else this.$Server.addOrUpdate(subParsing.getModelName(),this.pointSubTask,!0).then((function(t){t.success&&(e.init(),e.initSubTask(),e.queryRecord(e.pointSubTask.id))}));else _components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("请选择一项你要执行的任务")},cancelTask:function(){var e=this.$refs.childDataTable2.getCheckItems();if(1==e.length){var t=e[0],i=sessionStorage.getItem("userId");t.assignedUser!=i?_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("你不是工单的执行人，不能取消执行工单"):"进行中"!=t.status.dname?_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("工单不在进行中，不能取消执行工单"):this.IsComfirmCancel=!0}},modalComfirmedClose:function(){this.IsComfirmCancel=!1},confirmCancel:function(){var e=this,t=this.$refs.childDataTable2.getCheckItems();this.$Server.addOrUpdate(subParsing.getModelName(),t[0],!1).then((function(i){if(i.success){e.initSubTask(),_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("点巡检任务取消成功","success");var a=e.subDataSource.filter((function(e){return e.id==t[0].id}));e.$refs.childDataTable2.getCheckItems()[0].status=a[0].status,e.IsComfirmCancel=!1}else _components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("点巡检任务取消失败","error")}),(function(e){return _components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("点巡检任务取消失败","error")}))},queryRecord:function(e){var t=this;this.$Server.queryAll((new _common_models_PointInspectionRecord__WEBPACK_IMPORTED_MODULE_15__["a"]).__name,{},{subTaskId:e}).then((function(e){t.recordDataSource=e.datas})),this.IsShowRecord=!0},recordClosed:function(){this.IsShowRecord=!1,this.initSubTask(),this.init()},recordComfirmed:function(e){var t=this;this.$Server.batchUpdate((new _common_models_PointInspectionRecord__WEBPACK_IMPORTED_MODULE_15__["a"]).__name,e).then((function(e){e.success&&(t.IsShowRecord=!1,t.init(),t.initSubTask())}))},submitNotDataRecord:function(e){var t=this;this.$Server.batchSave((new _common_models_PointInspectionRecord__WEBPACK_IMPORTED_MODULE_15__["a"]).__name,e).then((function(e){e.success&&(t.queryRecord(t.pointSubTask.id),_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("保存成功","success"))}))},completeTask:function(e){var t=this;this.$Server.batchUpdate((new _common_models_PointInspectionRecord__WEBPACK_IMPORTED_MODULE_15__["a"]).__name,e).then((function(e){e.success&&(_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("工单执行成功","success"),t.IsShowRecord=!1,t.initSubTask(),t.init())}),(function(e){_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("工单执行失败")}))},chooseTask:function(){var e=this,t=sessionStorage.getItem("userId");this.$Server.queryAll(subParsing.getModelName(),{},{user:t}).then((function(t){e.subtaskSource=t.datas,0==e.subtaskSource.length?_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("无可领选的任务"):e.IsShowTasks=!0}))},receiveClosed:function(){this.IsShowTasks=!1},receiveComfirmed:function(e){var t=this,i=sessionStorage.getItem("userId");e.forEach((function(e){e.assignedUser=i})),this.$Server.batchUpdate(subParsing.getModelName(),e).then((function(e){e.success&&(_components_message__WEBPACK_IMPORTED_MODULE_11__["a"].alert("任务领取成功","success"),t.IsShowTasks=!1,t.initSubTask(),t.init())}))},rowDbClick:function(e){this.IsShowDetail=!0,this.pointTaskDetail=e},rowDbChildClick:function(e){this.IsShowDetail=!0,this.pointTaskDetail=e},detailClosed:function(){this.IsShowDetail=!1},rowDbClickSubTask:function(e){this.subTaskDetail=e,this.IsShowSubTask=!0;var t=this;this.$Server.queryAll((new _common_models_PointInspectionRecord__WEBPACK_IMPORTED_MODULE_15__["a"]).__name,{},{subTaskId:e.id}).then((function(e){t.recordDataSource=e.datas}))},subDetailClosed:function(){this.IsShowSubTask=!1}}}},"68e0":function(e,t,i){"use strict";var a=i("58c4"),s=i("8716"),r="Map";e.exports=i("9ffd")(r,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=a.getEntry(s(this,r),e);return t&&t.v},set:function(e,t){return a.def(s(this,r),0===e?0:e,t)}},a,!0)},"6fdb":function(e,t,i){},7013:function(e,t,i){"use strict";var a=i("5e7e"),s=i.n(a);s.a},"89f4":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-dialog",{attrs:{"max-width":"1000px",persistent:!0,scrollable:""},model:{value:e.IsShowTasks,callback:function(t){e.IsShowTasks=t},expression:"IsShowTasks"}},[i("v-form",{ref:"form",staticStyle:{width:"100%"},attrs:{valid:"true"}},[i("v-card",[i("v-card-title",{staticClass:"primary"},[i("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("领选任务")])]),i("v-card-text",[i("v-container",{attrs:{"grid-list-md":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",[i("p",[e._v("你需要选领"),i("span",{staticStyle:{color:"red"}},[e._v(e._s(e.taskCount))]),e._v("个任务")])]),i("v-flex",{attrs:{xs12:""}},[i("dataTable",{ref:"childTable",attrs:{headers:e.headers,items:e.dataSource,hideHeaders:!1,allowActive:!0,hideOperation:!0}})],1)],1)],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.receiveComfirmed()}}},[e._v("领选")]),i("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.receiveClosed()}}},[e._v("取消")])],1)],1)],1)],1)],1)},s=[],r=(i("4634"),i("ef3e")),n=i("d5b3"),o={data:function(){return{source:[],headers:[{text:"任务",sortable:!1,value:"name",align:"center"},{text:"设备位置",sortable:!1,value:"position",align:"center"},{text:"设备",sortable:!1,value:"equipmentName",align:"center"},{text:"领选人员",sortable:!1,value:"assignedUser",align:"center"},{text:"耗时统计",sortable:!1,value:"spendTime",align:"center"}]}},components:{dataTable:r["a"]},computed:{dataSource:function(){return this.subtaskSource.forEach((function(e){var t=[],i=[];e.equipList.forEach((function(e){t.push(e.codeName),i.push(e.productionName)})),e.equipmentName=t,e.position=i})),this.subtaskSource},taskCount:function(){return this.subtaskSource.length>0&&null!=this.subtaskSource[0].userList?Math.ceil(this.subtaskSource.length/this.subtaskSource[0].userList.length):0}},methods:{receiveClosed:function(){this.$emit("receiveClosed")},receiveComfirmed:function(){this.$refs.childTable.getCheckItems().length<this.taskCount?n["a"].alert("你最少要领选"+this.taskCount+"个任务"):this.$emit("receiveComfirmed",this.$refs.childTable.getCheckItems())}},props:["IsShowTasks","subtaskSource"]},c=o,l=i("6691"),d=Object(l["a"])(c,a,s,!1,null,null,null);t["a"]=d.exports},"8a8a":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-dialog",{attrs:{"max-width":"1400px",persistent:!0,scrollable:""},model:{value:e.IsShowSubTask,callback:function(t){e.IsShowSubTask=t},expression:"IsShowSubTask"}},[i("v-card",[i("v-card-title",{staticClass:"primary"},[i("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("点巡检工单详情")])]),i("v-card-text",[i("v-container",{attrs:{"grid-list-md":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:"",light:""}},[i("p",[e._v("点巡检任务："+e._s(e.subTaskDetail.name+"("+e.subTaskDetail.code+")"))])])],1),i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",[i("p",[e._v("点巡检人："+e._s(e.subTaskDetail.userName))])]),i("v-flex",[i("p",[e._v("点巡检开始时间："+e._s(e.subTaskDetail.startTime))])]),i("v-flex",[i("p",[e._v("点巡检结束时间："+e._s(e.subTaskDetail.endTime))])])],1),i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:""}},[i("mergeTable",{ref:"childDataTable",attrs:{headers:e.recordHeaders,items:e.recordDataSource,hideOperation:!0,hideHeaders:!1,fieldName:e.fieldName,formatFields:e.formatFields},on:{recordData:e.recordData}})],1)],1),i("v-divider",{staticStyle:{"border-style":"dashed","border-width":"thin"}}),e.IsShow?i("v-form",{ref:"form",attrs:{valid:"true","lazy-validation":""}},[i("v-layout",{attrs:{xs12:""}},[i("v-flex",{staticStyle:{"font-size":"16px","font-weight":"bold"},attrs:{xs12:""}},[e._v("点巡检记录")])],1),i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs3:""}},[i("v-radio-group",{attrs:{label:"是否异常",row:"",disabled:""},model:{value:e.numericRecord.hasException,callback:function(t){e.$set(e.numericRecord,"hasException",t)},expression:"numericRecord.hasException"}},[i("v-radio",{attrs:{label:"是",value:"1"}}),i("v-radio",{attrs:{label:"否",value:"0"}})],1)],1),i("v-flex",{attrs:{xs8:""}},[e.numericRecord.documentList&&e.numericRecord.documentList.length>0?i("div",e._l(e.numericRecord.documentList,(function(e,t){return i("div",{key:t},[i("view-file",{attrs:{documentViewModel:e}})],1)})),0):e._e()]),i("v-flex",{attrs:{xs12:""}},[i("v-text-field",{attrs:{label:"备注",disabled:""},model:{value:e.numericRecord.description,callback:function(t){e.$set(e.numericRecord,"description",t)},expression:"numericRecord.description"}})],1)],1),1==e.numericRecord.dataRecord?i("v-flex",{staticStyle:{"font-size":"16px","font-weight":"bold"},attrs:{xs12:""}},[e._v("数值记录")]):e._e(),1==e.numericRecord.dataRecord?i("v-layout",{staticStyle:{border:"1px silver solid"},attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:""}},e._l(e.numericRecord.dataList,(function(t){return i("v-layout",{key:t.id,attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs1:""}},[i("span",{staticStyle:{"margin-top":"15px",display:"block","font-size":"16px","font-weight":"bold"}},[e._v(e._s(t.parameterName))])]),e._l(t.recordDataList,(function(a,s){return i("v-flex",{key:s,staticStyle:{"margin-right":"20px"}},[i("v-text-field",{class:t.max<a.paramValue||t.min>a.paramValue?"warnClass":"",attrs:{type:"number",rules:[function(e){return!!e||"必填项"}],disabled:""},model:{value:a.paramValue,callback:function(t){e.$set(a,"paramValue",t)},expression:"data.paramValue"}})],1)}))],2)})),1)],1):e._e()],1):e._e()],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.subDetailComfirmed()}}},[e._v("关闭")])],1)],1)],1),i("comfirmModal",{attrs:{title:"提示",IsShow:e.IsComfirmShow,text:e.deleteTittle},on:{modalComfirmedClose:function(t){return e.modalComfirmedClose()},modalComfirmed:function(t){return e.cofirmDelete()}}})],1)},s=[],r=i("52d6"),n=i("e6e7"),o=i("8333"),c=(i("d5b3"),i("55b3")),l=i("23f5"),d=new o["a"](new n["a"]),u={data:function(){return{fieldName:"equipmentName",recordHeaders:[{align:"center",inlineEdit:!1,sortable:!1,text:"设备",value:"equipmentName"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检位置",value:"part"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检内容",value:"standardViewModel.content"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检目的",value:"purpose"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检方法",value:"standardViewModel.method"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检标准",value:"standardViewModel.standard"},{align:"center",inlineEdit:!1,sortable:!1,text:"设备状态",value:"standardViewModel.eqpStatusName"},{align:"center",inlineEdit:!1,sortable:!1,text:"计划开始时间",value:"startTime",fieldType:"chatField"},{align:"center",inlineEdit:!1,sortable:!1,text:"数值记录",value:"dataRecordName",fieldType:"chatField"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检状态",value:"stutusName"},{align:"center",inlineEdit:!1,sortable:!1,text:"查看记录",fieldType:"btn",value:"id",textValue:"查看记录"}],formatFields:d.getFormatFields(),numericRecord:[],submitData:[],deleteTittle:"",IsComfirmShow:!1,IsShow:!1}},components:{UploadFile2:c["a"],mergeTable:r["a"],comfirmModal:l["a"]},mounted:function(){this.recordHeaders[2].inlineEdit=!0},methods:{subDetailComfirmed:function(){this.IsShow=!1,this.$emit("subDetailClosed")},recordData:function(e,t){this.numericRecord=e,void 0==this.numericRecord.hasException&&null==this.numericRecord.hasException||(0==this.numericRecord.hasException?this.numericRecord.hasException="0":1==this.numericRecord.hasException&&(this.numericRecord.hasException="1")),console.log(this.numericRecord),this.IsShow=!0}},props:["IsShowSubTask","recordDataSource","subTaskDetail"]},m=u,_=(i("1b6f"),i("a380"),i("6691")),h=Object(_["a"])(m,a,s,!1,null,"749468b2",null);t["a"]=h.exports},"8f12":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"9b06":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-dialog",{attrs:{"max-width":"800px",persistent:!0,scrollable:""},model:{value:e.IsShowSubTaskOne,callback:function(t){e.IsShowSubTaskOne=t},expression:"IsShowSubTaskOne"}},[i("v-card",[i("v-card-title",{staticClass:"primary"},[i("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("分配任务")])]),i("v-card-text",[i("v-layout",[i("p",[e._v("该工单只有一个设备，不能再进行拆分,请直接选择负责人")])]),e._l(e.item.subTaskList,(function(t){return e.item&&e.item.subTaskList?i("v-layout",{key:t.id},[i("v-select",{attrs:{items:t.userList,"item-text":"name","item-value":"id"},model:{value:t.assignedUser,callback:function(i){e.$set(t,"assignedUser",i)},expression:"subTask.assignedUser"}})],1):e._e()}))],2),i("v-card-actions",{staticClass:"marginbottom"},[i("v-spacer"),i("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.modalComfirmed()}}},[e._v("确认")]),i("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.modalClosed()}}},[e._v("关闭")])],1)],1)],1)],1)},s=[],r={name:"distributeTaskOne",props:["IsShowSubTaskOne","item"],methods:{modalClosed:function(){this.$emit("subTaskOneClosed")},modalComfirmed:function(){console.log(this.item),this.$emit("subTaskOneComfirmed")}}},n=r,o=i("6691"),c=Object(o["a"])(n,a,s,!1,null,"30b336b3",null);t["a"]=c.exports},a380:function(e,t,i){"use strict";var a=i("2fe6"),s=i.n(a);s.a},a6aa:function(e,t,i){},d0ed:function(e,t,i){"use strict";var a=i("6fdb"),s=i.n(a);s.a},d2ed:function(e,t,i){"use strict";var a=i("301b"),s=i.n(a);s.a},db3e:function(e,t,i){"use strict";var a=i("8cac"),s=i("8f12"),r=i("2137");i("6af6")("search",1,(function(e,t,i,n){return[function(i){var a=e(this),s=void 0==i?void 0:i[t];return void 0!==s?s.call(i,a):new RegExp(i)[t](String(a))},function(e){var t=n(i,e,this);if(t.done)return t.value;var o=a(e),c=String(this),l=o.lastIndex;s(l,0)||(o.lastIndex=0);var d=r(o,c);return s(o.lastIndex,l)||(o.lastIndex=l),null===d?-1:d.index}]}))},e6e7:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var a=i("7300"),s=i("5873"),r=i("ddf2"),n=i("80ea"),o=i("ae0a"),c=i("97a3"),l=i("652a"),d=i("1269"),u=new l["a"],m=function(e){function t(){var e,i;Object(a["a"])(this,t);for(var o=arguments.length,l=new Array(o),d=0;d<o;d++)l[d]=arguments[d];return i=Object(s["a"])(this,(e=Object(r["a"])(t)).call.apply(e,[this].concat(l))),Object(c["a"])(Object(n["a"])(i),"__name","PointInspectionRecord"),Object(c["a"])(Object(n["a"])(i),"pointInspectionItemID",u.charField({require:!1,visible:!1,editable:!1})),Object(c["a"])(Object(n["a"])(i),"equipmentName",u.charField({require:!1,fieldName:"设备"})),Object(c["a"])(Object(n["a"])(i),"part",u.charField({require:!1,fieldName:"点巡检位置"})),Object(c["a"])(Object(n["a"])(i),"status",u.comboBoxField(null,{require:!1,fieldName:"状态",visible:!1,format:function(e){if(e&&e.dname)return e.dname}})),Object(c["a"])(Object(n["a"])(i),"description",u.charField({require:!1,fieldName:"描述"})),Object(c["a"])(Object(n["a"])(i),"hasException",u.boolField({require:!1,fieldName:"是否有异常",visible:!0})),Object(c["a"])(Object(n["a"])(i),"detectionValue",u.charField({require:!1,fieldName:"实际值"})),Object(c["a"])(Object(n["a"])(i),"startTime",u.dateField({require:!1,fieldName:"点巡检开始时间",visible:!1})),Object(c["a"])(Object(n["a"])(i),"endTime",u.dateField({require:!1,fieldName:"点巡检结束时间",visible:!1})),Object(c["a"])(Object(n["a"])(i),"documentViewModel",u.charField({require:!1,fieldName:"附件"})),Object(c["a"])(Object(n["a"])(i),"standardViewModel",u.charField({require:!1,fieldName:"点巡检内容",visible:!1})),Object(c["a"])(Object(n["a"])(i),"dataRecord",u.boolField()),Object(c["a"])(Object(n["a"])(i),"purpose",u.charField({require:!1,fieldName:"保养目的",visible:!1,editable:!1,format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),i}return Object(o["a"])(t,e),t}(d["a"])},e6f0:function(e,t,i){},e903:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-dialog",{attrs:{"max-width":"1100px",persistent:!0,scrollable:""},model:{value:e.IsShowRecord,callback:function(t){e.IsShowRecord=t},expression:"IsShowRecord"}},[i("v-card",[i("v-card-title",{staticClass:"primary"},[i("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("点巡检记录")])]),i("v-card-text",[i("v-container",{staticStyle:{padding:"0px 20px"},attrs:{"grid-list-md":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:"",light:""}},[i("p",[e._v("点巡检任务："+e._s(e.subtask.name+"("+e.subtask.code+")"))])])],1),i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",[i("p",[e._v("点巡检人："+e._s(e.subtask.userName))])]),i("v-flex",[i("p",[e._v("点巡检开始时间："+e._s(e.subtask.startTime))])]),i("v-flex",[i("p",[e._v("点巡检结束时间："+e._s(e.subtask.endTime))])])],1),i("v-layout",{attrs:{row:"",wrap:""}},[i("mergeTable",{ref:"childDataTable",attrs:{headers:e.recordHeaders,items:e.recordDataSource,hideOperation:!0,hideHeaders:!1,fieldName:e.fieldName,formatFields:e.formatFields},on:{recordData:e.recordData}})],1),i("v-divider",{staticStyle:{"border-style":"dashed","border-width":"thin"}}),i("v-form",{directives:[{name:"show",rawName:"v-show",value:e.IsShow,expression:"IsShow"}],ref:"form",attrs:{valid:"true","lazy-validation":""}},[i("v-layout",{attrs:{xs12:""}},[i("v-flex",{staticStyle:{"font-size":"16px","font-weight":"bold"},attrs:{xs12:""}},[e._v("点巡检记录")])],1),i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs3:""}},[i("v-radio-group",{attrs:{label:"是否异常",row:""},model:{value:e.numericRecord.hasException,callback:function(t){e.$set(e.numericRecord,"hasException",t)},expression:"numericRecord.hasException"}},[i("v-radio",{attrs:{label:"是",value:"1"}}),i("v-radio",{attrs:{label:"否",value:"0"}})],1)],1),i("v-flex",{attrs:{xs4:""}},[i("UploadFile2",{ref:"uploadFile2",attrs:{label:"上传附件",uploadBase64:!1,multiple:!0,fileNames:e.numericRecord.fileName},on:{formData:e.getFormData1},model:{value:e.numericRecord.documentList,callback:function(t){e.$set(e.numericRecord,"documentList",t)},expression:"numericRecord.documentList"}})],1),i("v-flex",{attrs:{xs4:""}},[i("p",[i("span",{staticStyle:{"margin-left":"20px","margin-right":"12px","margin-top":"20px","font-size":"14px"}},[e._v("支持上传格式：png，gif，jpg，bmp，jpeg,mp4")])])]),i("v-flex",{attrs:{xs12:""}},[i("v-text-field",{attrs:{label:"备注"},model:{value:e.numericRecord.description,callback:function(t){e.$set(e.numericRecord,"description",t)},expression:"numericRecord.description"}})],1)],1),1==e.numericRecord.dataRecord?i("v-flex",{staticStyle:{"font-size":"16px","font-weight":"bold"},attrs:{xs12:""}},[e._v("数值记录")]):e._e(),1==e.numericRecord.dataRecord?i("v-layout",{staticStyle:{border:"0px silver solid"},attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:""}},e._l(e.numericRecord.dataList,(function(t){return i("v-layout",{key:t.id,attrs:{row:"",wrap:""}},e._l(t.recordDataList,(function(a,s){return i("v-flex",{key:s,staticStyle:{"margin-right":"20px"}},[i("v-text-field",{class:t.max<a.paramValue||t.min>a.paramValue?"warnClass":"",attrs:{type:"number",rules:[function(e){return!!e||"必填项"}],label:t.parameterName,suffix:t.unit,hint:e.setHint(t)},model:{value:a.paramValue,callback:function(t){e.$set(a,"paramValue",t)},expression:"data.paramValue"}})],1)})),1)})),1)],1):e._e(),i("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.comfirmOneRecord()}}},[e._v("保存")])],1)],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.recordComplete()}}},[e._v("自动赋值")]),i("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.recordComfirmed()}}},[e._v("完成")]),i("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.recordClosed()}}},[e._v("取消")])],1)],1)],1),i("v-dialog",{attrs:{width:"500"},model:{value:e.IsComfirmShow,callback:function(t){e.IsComfirmShow=t},expression:"IsComfirmShow"}},[i("v-card",[i("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[e._v("\n        提示\n      ")]),i("v-card-text",[e._v("\n        "+e._s(e.deleteTittle)+"\n      ")]),i("v-divider"),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{color:"primary",flat:""},on:{click:function(t){return e.cofirmEdit()}}},[e._v("\n          是\n        ")]),i("v-btn",{attrs:{color:"primary",flat:""},on:{click:function(t){return e.modalComfirmedClose()}}},[e._v("\n          否\n        ")])],1)],1)],1)],1)},s=[],r=(i("cc1d"),i("7cfd"),i("4634"),i("52d6")),n=i("e6e7"),o=i("8333"),c=i("d5b3"),l=i("3876"),d=i("23f5"),u=new o["a"](new n["a"]),m={data:function(){return{source:[{id:"1",equipmentName:"设备1",part:"头部",content:"查看是否磨损"},{id:"2",equipmentName:"设备1",part:"头部",content:"擦拭"},{id:"3",equipmentName:"设备1",part:"发动机",content:"有无损坏"},{id:"3",equipmentName:"设备1",part:"发动机",content:"是否关闭"}],fieldName:"equipmentName",recordHeaders:[{align:"center",inlineEdit:!1,sortable:!1,text:"设备",value:"equipmentName"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检位置",value:"part"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检内容",value:"standardViewModel.content"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检目的",value:"purpose"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检方法",value:"standardViewModel.method"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检标准",value:"standardViewModel.standard"},{align:"center",inlineEdit:!1,sortable:!1,text:"设备状态",value:"standardViewModel.eqpStatusName"},{align:"center",inlineEdit:!1,sortable:!1,text:"计划开始时间",value:"planStartTime",fieldType:"chatField"},{align:"center",inlineEdit:!1,sortable:!1,text:"数值记录",value:"dataRecordName",fieldType:"chatField"},{align:"center",inlineEdit:!1,sortable:!1,text:"点巡检状态",value:"stutusName"},{align:"center",inlineEdit:!0,sortable:!1,text:"操作",fieldType:"btn",value:"id",textValue:"填写记录"}],formatFields:u.getFormatFields(),numericRecord:[],submitData:[],deleteTittle:"",IsComfirmShow:!1,IsShow:!1}},components:{UploadFile2:l["a"],mergeTable:r["a"],comfirmModal:d["a"]},mounted:function(){},methods:{setHint:function(e){var t="";return t+=e.min?"参考上限:"+e.min:"",t+=e.min&&e.max?" ; ":"",t+=e.max?"参考下限:"+e.max:"",t},recordClosed:function(){this.recordDataSource.forEach((function(e){e.documentID=[]})),this.IsShow=!1,this.$emit("recordClosed")},clearMessage:function(){this.numericRecord={},this.$refs.uploadFile2.clearFile()},recordComfirmed:function(){var e=!1;this.recordDataSource.forEach((function(t){t.stutusName&&"已完成"!=t.stutusName&&(e=!0)})),1==e?c["a"].alert("需要所有点巡检项都完成才能点击完成按钮"):this.$emit("completeTask",this.recordDataSource)},getFormData1:function(e){var t=this,i=e.get("data");if(i){var a=i.name.substring(i.name.lastIndexOf(".")+1,i.name.length);"png"!=a&&"gif"!=a&&"jpg"!=a&&"bmp"!=a&&"jpeg"!=a&&"mp4"!=a&&(c["a"].alert("请检查文件格式是否正确"),t.$refs.uploadFile2.clearFile())}},recordComplete:function(){if(this.submitData=this.recordDataSource.filter((function(e){return 0==e.dataRecord&&0!=e.hasException&&1!=e.hasException})),this.submitData.length>0){var e=[];this.submitData.forEach((function(t){e.push(t)})),e.forEach((function(e){e.hasException=0})),this.$emit("submitNotDataRecord",e)}else c["a"].alert("没有不填写数值的点巡检项")},recordData:function(e,t){this.numericRecord.documentList=[],this.numericRecord.fileName="",this.numericRecord=JSON.parse(JSON.stringify(e)),0!=this.numericRecord.hasException&&1!=this.numericRecord.hasException||(this.numericRecord.hasException=0==this.numericRecord.hasException?"0":"1"),this.IsShow=!0,this.numericRecord.startTime=new Date,1==this.IsShow&&this.$refs.uploadFile2.clearFile()},comfirmOneRecord:function(){var e=!1;if(this.numericRecord.hasException)if(this.$refs.form.validate())if(this.numericRecord.dataList.forEach((function(t){var i=[];t.recordDataList.forEach((function(a){parseFloat(a.paramValue),t.min>a.paramValue||t.max<a.paramValue?(e=!0,i.push(a.paramValue.toString())):i.push(a.paramValue.toString())})),t.parameterValue=i})),1==e)this.deleteTittle="所填数值超过最大值或最小值范围,是否要修改",this.IsComfirmShow=!0;else{var t=[this.numericRecord];this.$emit("submitNotDataRecord",t),this.IsShow=!1}else c["a"].alert("必填项必须填");else c["a"].alert("是否异常为必填项")},cofirmEdit:function(){this.IsComfirmShow=!1},modalComfirmedClose:function(){var e=[this.numericRecord];this.$emit("submitNotDataRecord",e),this.IsComfirmShow=!1}},props:["subtask","subtaskRecord","IsShowRecord","recordDataSource"]},_=m,h=(i("7013"),i("d2ed"),i("6691")),f=Object(h["a"])(_,a,s,!1,null,"65ed3df4",null);t["a"]=f.exports},f017:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-dialog",{attrs:{"max-width":"1100px",persistent:!0,scrollable:""},model:{value:e.IsShow,callback:function(t){e.IsShow=t},expression:"IsShow"}},[i("v-card",[i("v-card-title",{staticClass:"primary"},[i("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("分配负责人")])]),i("v-card-text",[e._t("default")],2),i("v-card-actions",{staticClass:"marginbottom"},[i("v-spacer"),i("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:function(t){return e.modalComfirmed()}}},[e._v("一键分配")]),i("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.modalClosed()}}},[e._v("关闭")])],1)],1)],1)],1)},s=[],r={name:"distributeUser",props:["IsShow"],methods:{modalClosed:function(){this.$emit("modalClosed")},modalComfirmed:function(){this.$emit("modalComfirmed")}}},n=r,o=i("6691"),c=Object(o["a"])(n,a,s,!1,null,"16badffe",null);t["a"]=c.exports},ffdf:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var a=i("7300"),s=i("5873"),r=i("ddf2"),n=i("80ea"),o=i("ae0a"),c=i("97a3"),l=i("652a"),d=i("1269"),u=new l["a"],m=function(e){function t(){var e,i;Object(a["a"])(this,t);for(var o=arguments.length,l=new Array(o),d=0;d<o;d++)l[d]=arguments[d];return i=Object(s["a"])(this,(e=Object(r["a"])(t)).call.apply(e,[this].concat(l))),Object(c["a"])(Object(n["a"])(i),"__name","PointInspectionSubTask"),Object(c["a"])(Object(n["a"])(i),"code",u.charField({require:!1,fieldName:"任务编号"})),Object(c["a"])(Object(n["a"])(i),"name",u.charField({require:!1,fieldName:"任务名称"})),Object(c["a"])(Object(n["a"])(i),"equipmentName",u.charField({require:!1,fieldName:"设备"})),Object(c["a"])(Object(n["a"])(i),"equipmentType",u.charField({require:!1,fieldName:"设备类型"})),Object(c["a"])(Object(n["a"])(i),"assignedUser",u.charField({require:!1,fieldName:"领选人员",visible:!1})),Object(c["a"])(Object(n["a"])(i),"userName",u.charField({require:!1,fieldName:"点巡检人员"})),Object(c["a"])(Object(n["a"])(i),"spendTime",u.charField({require:!1,fieldName:"标准工时"})),Object(c["a"])(Object(n["a"])(i),"startTime",u.charField({require:!1,fieldName:"点巡检开始时间"})),Object(c["a"])(Object(n["a"])(i),"endTime",u.charField({require:!1,fieldName:"点巡检结束时间"})),Object(c["a"])(Object(n["a"])(i),"statusName",u.charField({fieldName:"状态"})),Object(c["a"])(Object(n["a"])(i),"status",u.comboBoxField(null,{require:!1,visible:!1,fieldName:"状态",format:function(e){if(null!=e&&null!=e.dname)return e.dname}})),i}return Object(o["a"])(t,e),t}(d["a"])}}]);