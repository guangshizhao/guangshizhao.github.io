(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-415329ba"],{"0c10":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-form",{ref:"form1",attrs:{"lazy-validation":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"取消原因",rules:[e.rules.required]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            取消原因: "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.item.cancelReason,callback:function(t){e.$set(e.item,"cancelReason",t)},expression:"item.cancelReason"}})],1)],1)],1)],1)],1)},i=[],r=(a("d5b3"),{name:"CancelTask",data:function(){return{rules:{required:function(e){return!!e||"必填项"}}}},props:["item"],methods:{validate:function(){return 1==this.$refs.form1.validate()},resetValid:function(){this.$refs.form1.resetValidation(),this.$refs.form1.reset()}}}),n=r,l=a("6691"),o=Object(l["a"])(n,s,i,!1,null,"058eafcc",null);t["a"]=o.exports},"297e":function(e,t,a){"use strict";var s=a("cb9c"),i=a.n(s);i.a},8584:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContentHeader",{attrs:{title:"设备购置",buttons:e.headerBtns}},[a("v-text-field",{attrs:{label:"请输入编号或申请人",clearable:"","hide-details":"","single-line":"",primary:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1),a("layContent",[a("gridTemplate",{ref:"childGridTemplate",attrs:{title:"购置任务",gridModel:e.eqpPurchaseTask,sort:!0},on:{editorsReCode:e.editorsReCode,beforeEdit:e.beforeEdit,beforeAdd:e.beforeAdd,beforeEditSubmit:e.beforeEditSubmit,rowDbClick:e.rowDbClick,beforeCancel:e.beforeCancel,afterInit:e.afterInit}},[a("v-layout",{attrs:{row:""}},[a("v-flex",{attrs:{xs12:""}},[a("b",[e._v("基本信息")])]),a("v-flex",{attrs:{xs4:""}},[a("v-text-field",{attrs:{label:"购置单编号",rules:[function(e){return!e||/^[\w|-]+$/.test(e)||"只能是数字,字母,下划线"}]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            购置单编号\n                        ")]},proxy:!0}]),model:{value:e.eqpPurchaseTaskModel.purchaseCode,callback:function(t){e.$set(e.eqpPurchaseTaskModel,"purchaseCode",t)},expression:"eqpPurchaseTaskModel.purchaseCode"}})],1),a("v-flex",{attrs:{xs4:""}},[a("datePicker",{attrs:{label:"最迟到货时间",required:!0,rules:[function(e){return e&&""!=e||"必填项"},function(t){return new Date(t)>=new Date(e.today)||"最迟到货时间不能小于当前时间"}],prependIcon:"star",locale:"zh-cn"},model:{value:e.eqpPurchaseTaskModel.latestTime,callback:function(t){e.$set(e.eqpPurchaseTaskModel,"latestTime",t)},expression:"eqpPurchaseTaskModel.latestTime"}})],1),a("v-flex",{attrs:{xs4:""}},[a("selectUser",{ref:"selectUser",attrs:{value:e.item.assignName,required:!0,label:"申请人",multiple:!1,initselect:e.item.selectAssign},on:{changeValue:e.changeValue}})],1),a("v-flex",{attrs:{xs4:""}},[a("v-text-field",{attrs:{label:"数量",type:"number",rules:[function(e){return!!e||"必填项"},function(e){return/^[1-9][0-9]*$/.test(e)||"只能是非零正整数"}],min:"1"},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            数量 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.eqpPurchaseTaskModel.purchaseCount,callback:function(t){e.$set(e.eqpPurchaseTaskModel,"purchaseCount",t)},expression:"eqpPurchaseTaskModel.purchaseCount"}})],1),a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"购置原因"},model:{value:e.eqpPurchaseTaskModel.reason,callback:function(t){e.$set(e.eqpPurchaseTaskModel,"reason",t)},expression:"eqpPurchaseTaskModel.reason"}})],1),a("v-flex",{attrs:{xs12:""}},[a("v-layout",[a("v-flex",{attrs:{xs12:""}},[a("span",{staticStyle:{"font-weight":"normal",width:"100%","padding-top":"20px"}},[e._v("上传附件:")]),a("v-icon",{on:{click:function(t){return e.addUpload()}}},[e._v("add")])],1)],1),e._l(e.eqpPurchaseTaskModel.documentList,(function(t,s){return a("v-layout",{key:s,style:e.selectLocation.includes(t)?"background: #E3F2FD":"",attrs:{row:"",wrap:""},on:{click:function(a){return e.getClick(t,s)}}},[a("v-flex",{attrs:{xs10:""}},[a("fileUploader",{ref:"uploadFile",refInFor:!0,attrs:{label:"上传附件",multiple:!1,fileNames:t.document&&t.document.dname,uploadBase64:!1,userVersion:t},on:{formData:e.getFormData},model:{value:t.document,callback:function(a){e.$set(t,"document",a)},expression:"doc.document"}})],1),a("v-flex",{attrs:{xs2:""}},[a("v-icon",{on:{click:function(t){return e.eqpPurchaseTaskModel.documentList.splice(s,1)}}},[e._v("delete")])],1)],1)}))],2),a("br"),a("v-flex",{attrs:{xs12:""}},[a("b",[e._v("设备信息")]),a("v-radio-group",{attrs:{mandatory:!1,row:""},model:{value:e.displayCheck,callback:function(t){e.displayCheck=t},expression:"displayCheck"}},[a("v-radio",{attrs:{label:"从名录中选择",value:"true"}}),a("v-radio",{attrs:{label:"新增设备",value:"false"}})],1)],1),"true"==e.displayCheck?a("v-flex",{attrs:{xs4:""}},[a("treeView",{ref:"treeView",attrs:{independentCheck:!0,Source:e.equipments,MultipleSelect:!1,label:"设备名称",require:!0,independentSingleCheck:!0,"return-object":""},on:{input:function(t){return e.changeSelected(e.equipmentDirectory)}},model:{value:e.equipmentDirectory,callback:function(t){e.equipmentDirectory=t},expression:"equipmentDirectory"}})],1):e._e(),"true"==e.displayCheck?a("v-flex",{attrs:{xs4:""}},[a("v-combobox",{attrs:{label:"设备类型",disabled:"true"==e.displayCheck,items:e.typeList,"item-text":"dname","item-value":"dvalue"},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            设备类型 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}],null,!1,2686932376),model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1):e._e(),"true"==e.displayCheck?a("v-flex",{attrs:{xs4:""}},[a("v-text-field",{attrs:{disabled:"true"==e.displayCheck,label:"规格型号"},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            规格型号 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}],null,!1,3208526101),model:{value:e.eqpPurchaseTaskModel.model,callback:function(t){e.$set(e.eqpPurchaseTaskModel,"model",t)},expression:"eqpPurchaseTaskModel.model"}})],1):e._e(),"false"==e.displayCheck?a("v-flex",{attrs:{xs4:""}},[a("v-text-field",{attrs:{label:"设备名称",rules:[function(e){return!!e||"必填项"}]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            设备名称 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}],null,!1,205336597),model:{value:e.equipmentDirectory,callback:function(t){e.equipmentDirectory=t},expression:"equipmentDirectory"}})],1):e._e(),"false"==e.displayCheck?a("v-flex",{attrs:{xs4:""}},[a("v-combobox",{attrs:{label:"设备类型",items:e.typeList,"item-text":"dname","item-value":"dvalue",rules:[function(e){return!!e||"必填项"}]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            设备类型 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}],null,!1,2686932376),model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1):e._e(),"false"==e.displayCheck?a("v-flex",{attrs:{xs4:""}},[a("v-text-field",{attrs:{rules:[function(e){return!!e||"必填项"}],label:"规格型号"},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            规格型号 "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}],null,!1,3208526101),model:{value:e.eqpPurchaseTaskModel.model,callback:function(t){e.$set(e.eqpPurchaseTaskModel,"model",t)},expression:"eqpPurchaseTaskModel.model"}})],1):e._e()],1)],1)],1),a("EqpPurchaseTaskDetail",{attrs:{equipmentDirectoryList:e.equipmentDirectoryList,userList:e.userList,isShowDetail:e.isShowDetail,taskDetail:e.taskDetail},on:{detailCancle:e.detailClosed}}),a("eqpPurchaseTaskResult",{attrs:{isShowResult:e.isShowResult,taskDetail:e.taskDetail},on:{resultConfirm:e.resultConfirm,resultCancle:e.resultCancle}}),a(e.currentView,{ref:"componentForm",tag:"component",attrs:{PreviewType:1,objectId:e.objectId},on:{modalComfirmed:e.formComfirmed}}),a("contentModal",{attrs:{title:"取消原因",IsShow:e.IsShowCancelTask,width:"1100"},on:{modalComfirmed:function(t){return e.modalComfirmedCancelTask()},modalClosed:function(t){return e.modalClosedCancelTask()}}},[a("CancelTask",{ref:"CancelTask",attrs:{item:e.detailForUpdate}})],1)],1)},i=[],r=(a("e6d1"),a("3596")),n=(a("7cfd"),a("40c5"),a("4634"),a("0b34"),a("f19a")),l=a("0c10"),o=a("bee9"),c=a("a2a7"),u=a("1d53"),d=a("b9da"),p=a("3edd"),h=a("d685"),m=a("d5b3"),f=a("a7fe"),v=a("d9f7"),k=a("3876"),y=a("8333"),x=a("7300"),D=a("5873"),q=a("ddf2"),T=a("80ea"),b=a("ae0a"),g=a("97a3"),C=a("652a"),_=a("1269"),S=new C["a"],w=(_["a"],function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-dialog",{attrs:{scrollable:"",persistent:!0,width:"1100"},model:{value:e.isShowDetail,callback:function(t){e.isShowDetail=t},expression:"isShowDetail"}},[a("v-card",[a("v-card-title",{staticClass:"primary"},[a("span",{staticClass:"headline",staticStyle:{color:"#fff"}},[e._v("购置任务详情")])]),a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("购置单编号："+e._s(e.taskDetail.purchaseCode))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("最迟到货日期："+e._s(e.taskDetail.latestTime&&e.taskDetail.latestTime.split(" ")[0]))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("申请人："+e._s(e.taskDetail.applicantName))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("数量："+e._s(e.taskDetail.purchaseCount))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("设备名称："+e._s(e.taskDetail.equipmentDirectoryName))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("规格型号："+e._s(e.taskDetail.equipmentDirectoryModel))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("设备类型："+e._s(e.taskDetail.type))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("购置原因："+e._s(e.taskDetail.reason))])])],1),a("v-layout",[e.taskDetail.documentList&&e.taskDetail.documentList.length>0?a("v-flex",{attrs:{xs12:""}},e._l(e.taskDetail.documentList,(function(e,t){return a("div",{key:t},[a("view-file",{attrs:{documentViewModel:e.document}})],1)})),0):e._e()],1),a("v-layout",[e.taskDetail.status&&"已取消"==e.taskDetail.status.dname?a("v-flex",{staticStyle:{"margin-top":"15px"}},[a("p",[e._v("取消原因："+e._s(e.taskDetail.cancelReason))])]):e._e()],1),a("v-layout",[e.taskDetail.status&&0!=e.taskDetail.status.dvalue&&e.isImageSrcShow?a("v-flex",{attrs:{xs12:""}},[a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("任务进度:")])]),e.imageSrc?a("img",{attrs:{src:e.imageSrc}}):e._e()]):e._e()],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{staticStyle:{"margin-right":"30px"},attrs:{color:"primary"},on:{click:e.detailCancle}},[e._v("关闭")])],1)],1)],1)],1)}),P=[],M=(a("bada"),a("551a")),$={name:"EqpPurchaseTaskDetail",data:function(){return{imageSrc:"",isImageSrcShow:!1}},watch:{taskDetail:{handler:function(e){this.isImageSrcShow=!1,e&&e.status&&0!=e.status.dvalue&&this.seeTrace()},deep:!0}},props:["isShowDetail","taskDetail","userList","equipmentDirectoryList"],computed:{uname:function(){var e=this,t=this.userList.find((function(t){return t.id==e.taskDetail.applicant}));return t?t.uname:""},equipemnt:function(){var e=this,t=this.equipmentDirectoryList.find((function(t){return t.id===e.taskDetail.equipmentDirectory}));return t||{}},model:function(){return this.equipemnt.model},type:function(){return this.equipemnt.type}},methods:{detailConfirm:function(){this.imageSrc="",this.$emit("detailConfirm")},detailCancle:function(){this.imageSrc="",this.$emit("detailCancle")},downloadDocument:function(){var e=document.createElement("a");this.taskDetail.document.dname,this.taskDetail.documentName.substring(this.taskDetail.documentName.lastIndexOf("."));e.href="/documents/"+this.taskDetail.documentName,e.download=this.taskDetail.document.dname,e.click()},seeTrace:function(){var e=this;M["a"].http(window.processForUrl.getUrlForInstanceId(e.taskDetail.id),"get","",{success:function(t){if(t.data&&t.data.data&&t.data.data.id){var a=t.data.data.id;e.seeImage(a)}}})},seeImage:function(e){var t=this;M["a"].http(window.processForUrl.getUrlForInstanceTrace(e),"get",{},{success:function(e){t.imageSrc=e.data.data.image,t.isImageSrcShow=!0}})}}},I=$,L=a("6691"),E=Object(L["a"])(I,w,P,!1,null,null,null),U=E.exports,N=a("a627"),R=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("contentModal",{attrs:{title:"购置结果",IsShow:e.isShowResult,width:"1100",isDetails:!0},on:{modalClosed:function(t){return e.resultCancle()}}},[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[e._v("实际到货日期："+e._s(e.taskDetail.latestTime&&e.taskDetail.latestTime.substring(0,10)))])],1),a("h5",{staticClass:"sub-title"},[e._v("购置清单")]),a("v-layout",[a("v-flex",{attrs:{xs6:""}},[e._v("设备名称："+e._s(e.taskDetail.equipmentDirectoryName))]),a("v-flex",{attrs:{xs6:""}},[e._v("规格型号："+e._s(e.taskDetail.equipmentDirectoryModel))]),a("v-flex",{attrs:{xs6:""}},[e._v("设备类型："+e._s(e.taskDetail.type))]),a("v-flex",{attrs:{xs6:""}},[e._v("数量："+e._s(e.taskDetail.purchaseCount))])],1),a("h5",{staticClass:"sub-title"},[e._v("购置验收结果")]),a("v-layout",[a("v-flex",{attrs:{xs12:""}},[a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.dataSource,"hide-actions":""},scopedSlots:e._u([{key:"items",fn:function(t){return[a("tr",e._l(e.headers,(function(s,i){return a("td",{key:i,staticClass:"text-xs-center"},["acceptance"===s.value?a("span",[e._v("\n                                                "+e._s(1===t.item[s.value]?"通过":"未通过")+"\n                                            ")]):"acceptanceResult"===s.value?[e._v("\n                                                "+e._s(1===t.item[s.value]?"通过":0===t.item[s.value]?"未通过":"")+"\n                                            ")]:"acceptanceDepart"===s.value?[e._v("\n                                                "+e._s(e.deptIdToName(t.item[s.value]))+"\n                                            ")]:a("span",[e._v(e._s(t.item[s.value]))])],2)})),0)]}}])})],1)],1)],1)],1)},F=[],G=a("ef3e"),V=a("20d3"),O={name:"EqpPurchaseTaskList",data:function(){return{headers:[{text:"出厂编号",align:"center",sortable:!1,value:"productionNo"},{text:"生产厂商",align:"center",value:"manufacturer",sortable:!1},{text:"验收结果",align:"center",value:"acceptanceResult",sortable:!1},{text:"验收部门",align:"center",value:"acceptanceDepart",sortable:!1},{text:"备注",align:"center",value:"description",sortable:!1}],dataSource:[],organizSelect:[]}},watch:{taskDetail:{handler:function(){var e=this;e.taskDetail.id&&e.$Server.queryAll("EqpPurchaseRecord",{},{purchaseTaskID:e.taskDetail.id}).then((function(t){e.dataSource=t.datas}),(function(e){return Message.alert(e)}))},deep:!0}},props:{isShowResult:Boolean,taskDetail:Object},components:{simpleDataTable:G["a"],contentModal:c["a"]},mounted:function(){var e=this;this.$Server.queryAll((new V["a"]).__name).then((function(t){e.organizSelect=t.datas}))},methods:{resultConfirm:function(){this.$emit("resultConfirm")},resultCancle:function(){this.$emit("resultCancle")},handleRecode:function(){this.isShowRecode=!this.isShowRecode},deptIdToName:function(e){var t="",a=this.organizSelect.find((function(t){return t.id===e}));return a&&(t=a.name?a.name:""),t}}},A=O,j=(a("297e"),Object(L["a"])(A,R,F,!1,null,"f3453ba6",null)),Y=j.exports,J=a("23f5"),z=a("1d18"),B=a("a1de"),K=a("531b"),H=(a("681f"),a("6bf2")),Q=a.n(H),W=new y["a"](new p["a"]),X={name:"EqpPurchaseTask",data:function(){var e=this;return{today:Q()(new Date).format("YYYY-MM-DD"),eqpPurchaseTask:{},IsShowCancelTask:!1,headerBtns:[{disabled:!this.$per("EqpPurchaseTask","c"),text:"添加",icon:"self_add",click:function(){return e.$refs.childGridTemplate.GridAdd()}},{disabled:!this.$per("EqpPurchaseTask","u"),text:"编辑",icon:"self_edit",click:function(){return e.GridEdit()}},{disabled:!this.$per("EqpPurchaseTask","d"),text:"删除",icon:"self_delete",click:function(){return e.GridDelete()}},{disabled:!this.$per("EqpPurchaseTask","exe"),text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}},{disabled:!this.$per("EqpPurchaseTask","cancel"),text:"取消",icon:"self_cancel",click:function(){return e.cancleTask()}},{disabled:!(-1!=JSON.parse(sessionStorage.getItem("permission")).findIndex((function(e){return"/api/EqpPurchaseTask"==e.pvalue&&"查看结果"==e.pname}))),text:"查看结果",icon:"self_look",click:function(){return e.showResult()}}],processKey:window.process.eqpPurchaseTask,equipmentTypes:[],userList:[],typeList:[],type:"",equipmentDirectoryList:[],rules:{required:function(e){return!!e||"必填项."},min:function(e){return e.length>=8||"Min 8 characters"},selectRe:function(e){return!!/^(0)$/.test(e)||!!e||"必填项"}},equipmentDirectory:"",eqpPurchaseTaskModel:{purchaseCode:"",applicant:"",documentList:[],equipmentDirectory:"",type:"",reason:"",purchaseCount:"",model:"",documentVersion:""},backUpEquipmentDirectory:"",isDisabled:!1,error2:!1,errorHints2:"最迟到货时间不能小于当前时间",isShowDetail:!1,taskDetail:{},isShowResult:!1,searchValue:"",documentName:"",isShowConfirm:!1,isConfirm:!1,item:{assignName:"",selectAssign:[]},currentView:"",objectId:"",isAddOp:!1,selectLocation:[],deleteIndex:"",initObject:"",detailForUpdate:{},displayCheck:"true",equipments:[],equipments1:[]}},watch:{displayCheck:{handler:function(e,t){var a=this;this.type="",this.eqpPurchaseTaskModel.model="",this.equipmentDirectory="",this.eqpPurchaseTaskModel.equipmentDirectory="",this.$refs.childGridTemplate.resetValid(),"false"===e&&(this.equipments=[]),"true"===e&&this.$nextTick((function(){a.isAddOp||(a.equipmentDirectory=[a.backUpEquipmentDirectory],a.eqpPurchaseTaskModel.equipmentDirectory=a.backUpEquipmentDirectory),a.equipments=a.equipments1}))}},equipmentDirectoryList:{handler:function(e,t){var a=[],s=[];if(this.equipmentDirectoryList.forEach((function(e){void 0==e.eType||null==e.eType||0==e.eType.length?(e.typeChinese="无",a.push(e)):a.push(e),-1==s.indexOf(e.eType)&&(void 0==e.eType||null==e.eType||0==e.eType.length?s.includes("无")||s.push("无"):s.push(e.eType))})),s.forEach((function(e,t){a.push({name:e,id:t+1,parentId:-1,isshow:!1})})),void 0==this.equipmentDirectoryList||null==this.equipmentDirectoryList||0==this.equipmentDirectoryList.length);else{this.equipmentDirectoryList.forEach((function(e){e.name=e.nameAndModel}));for(var i=0;i<a.length;i++)for(var r=0;r<a.length;r++)if(a[i].eType==a[r].name){a[i].parentId=a[r].id;break}}this.equipments=a,this.equipments1=JSON.parse(JSON.stringify(a))}}},components:{gridTemplate:d["a"],datePicker:u["a"],uploadFile2:k["a"],EqpPurchaseTaskDetail:U,EqpPurchaseTaskCheckList:N["a"],eqpPurchaseTaskResult:Y,comfirmModal:J["a"],selectUser:z["a"],fileUploader:B["a"],contentModal:c["a"],eqpPurchaseDetail:o["a"],CancelTask:l["a"],treeView:n["a"]},mounted:function(){this.eqpPurchaseTask=new p["a"],this.init()},methods:{changeSelected:function(e){var t=this;if(this.$refs.childGridTemplate.resetValid(),0===e.length)return t.type="",t.eqpPurchaseTaskModel.model="",void(t.eqpPurchaseTaskModel.equipmentDirectory="");this.equipmentDirectoryList.forEach((function(a){e[0]==a.id&&(t.type=a.eType,t.eqpPurchaseTaskModel.model=a.model,t.eqpPurchaseTaskModel.equipmentDirectory=a.id)}))},init:function(){var e=this;e.$Server.queryAll((new v["a"]).__name,{}).then((function(t){e.userList=t.datas})),e.$Server.queryAll((new f["a"]).__name,null,{dname:"设备类型"}).then((function(t){e.typeList=t.datas}))},input:function(){},afterInit:function(e){var t=this;e.forEach((function(e){(e.status&&"未开始"==e.status.dname||"已取消"==e.status.dname)&&(e.statusName=t.$Utils.setStart(e.status.dname)),e.status&&"进行中"==e.status.dname&&(e.statusName=t.$Utils.setRed(e.status.dname)),e.status&&"已完成"==e.status.dname&&(e.statusName=t.$Utils.setSuccess(e.status.dname))}))},editorsReCode:function(e){e=e.filter((function(e){return"purchaseCode"!=e.field})),e=e.filter((function(e){return"applicant"!=e.field})),e=e.filter((function(e){return"latestTime"!=e.field})),e=e.filter((function(e){return"reason"!=e.field})),e=e.filter((function(e){return"equipmentDirectory"!=e.field})),e=e.filter((function(e){return"purchaseCount"!=e.field})),e=e.filter((function(e){return"type"!=e.field})),this.$refs.childGridTemplate.editors=e},GridEdit:function(){1!=this.$refs.childGridTemplate.getCheckItems().length?m["a"].alert("请选中一个需要修改的项"):0!=this.$refs.childGridTemplate.getCheckItems()[0].status.dvalue?m["a"].alert("只有未开始的设备购置任务可以编辑！"):this.$refs.childGridTemplate.GridEdit()},beforeEdit:function(e,t){this.isAddOp=!1;var a=this;this.displayCheck="true",this.$Server.queryAll((new h["a"]).__name,{},{all:"all"}).then((function(e){a.equipmentDirectoryList=e.datas,a.item.assignName=t.applicantName,a.eqpPurchaseTaskModel=t,a.backUpEquipmentDirectory=t.equipmentDirectory;t.equipmentDirectory;a.equipmentDirectory=[t.equipmentDirectory]}))},beforeAdd:function(){var e=this;e.$Server.queryAll((new h["a"]).__name,{},{}).then((function(t){e.equipmentDirectoryList=t.datas})),this.eqpPurchaseTaskModel={purchaseCode:"",applicant:"",latestTime:Q()(new Date).format("YYYY-MM-DD"),documentList:[],equipmentDirectory:"",type:"",reason:"",purchaseCount:"",model:"",documentVersion:""},this.equipmentDirectory="",this.isAddOp=!0,this.displayCheck="true";var t=sessionStorage.uname,a=sessionStorage.userId;this.item.assignName=t,this.eqpPurchaseTaskModel.applicant=a,this.item.selectAssign=[{uname:t,id:a,selected:!0,title:t,name:t}]},beforeCancel:function(){this.isAddOp=!1,this.documentName="",this.item.assignName=""},beforeEditSubmit:function(e){e.purchaseCode=this.eqpPurchaseTaskModel.purchaseCode,e.applicant=this.eqpPurchaseTaskModel.applicant,e.reason=this.eqpPurchaseTaskModel.reason,e.documentList=this.eqpPurchaseTaskModel.documentList,e.purchaseCount=this.eqpPurchaseTaskModel.purchaseCount,e.latestTime=this.eqpPurchaseTaskModel.latestTime,e.model=this.eqpPurchaseTaskModel.model,e.type=this.type&&void 0!=this.type.dvalue&&null!=this.type.dvalue?this.type.dvalue:this.type,e.equipmentDirectory="object"==Object(r["a"])(this.equipmentDirectory)&&this.equipmentDirectory.constructor==Array?this.equipmentDirectory[0]:this.equipmentDirectory},rowDbClick:function(e){this.IsShowPlan=!0,this.taskDetail=e,this.isShowDetail=!0},clearMessage:function(){this.like="",this.$refs.childGridTemplate.doSearch({})},detailClosed:function(){this.isShowDetail=!1,this.taskDetail={}},resultConfirm:function(){},resultCancle:function(){this.isShowResult=!1},modalComfirmed:function(){},modalComfirmedClose:function(){},changeValue:function(e){e.length>0&&(this.eqpPurchaseTaskModel.applicant=e[0].id)},getFormData:function(e){console.log(e.get("data"))},validDate:function(e,t){var a=new Date(e),s=new Date(t);return a>=s},GridDelete:function(){var e=this.$refs.childGridTemplate.getSelectedItems();if(e.length<=0)m["a"].alert("请选择删除项");else{var t=!0;e.forEach((function(e){"未开始"!=e.status.dname&&(t=!1)})),t?this.$refs.childGridTemplate.GridDelete():m["a"].alert("只有未开始的设备购置任务可以删除")}},excuteTask:function(){var e=this.$refs.childGridTemplate.getSelectedItems();if(1===e.length){var t=sessionStorage.getItem("userId"),a=e[0];if(this.objectId=a.id,a.applicant!==t)m["a"].alert("这条任务负责人不是你");else{var s=a.status.dname;"未开始"===s?this.initiateProcess():m["a"].alert("只有未开始的任务才能执行")}}else m["a"].alert("请选择一个任务执行")},cancleTask:function(){var e=this.$refs.childGridTemplate.getSelectedItems(),t=this;if(1===e.length){var a=sessionStorage.getItem("userId"),s=e[0];if(s.applicant!==a)m["a"].alert("这条任务的负责人不是你");else{var i=s.status.dname;"进行中"===i?(t.detailForUpdate=JSON.parse(JSON.stringify(s)),t.$refs.CancelTask.resetValid(),t.IsShowCancelTask=!0):m["a"].alert("只有进行中的任务才能取消")}}else m["a"].alert("请选择一个任务")},modalComfirmedCancelTask:function(){var e=this;1==e.$refs.CancelTask.validate()?(e.cofirmCancel(e.detailForUpdate),e.IsShowCancelTask=!1):m["a"].alert("验证错误")},modalClosedCancelTask:function(){var e=this;e.IsShowCancelTask=!1},cofirmCancel:function(e){var t=this;K["a"].http(window.processForUrl.getUrlForInstanceId(e.id),"get","",{success:function(a){a.data&&a.data.data&&a.data.data.id?K["a"].http(window.processForUrl.getUrlForInstance(a.data.data.id),"Delete","",{success:function(a){e.status.dvalue=3,t.$Server.addOrUpdate(W.getModelName(),e,!0).then((function(e){e.success&&(t.$refs.childGridTemplate.init(),m["a"].alert("取消成功","success"))}),(function(e){m["a"].alert(e)}))},error:function(e){m["a"].alert(e)}}):(e.status.dvalue=3,t.$Server.addOrUpdate(W.getModelName(),e,!0).then((function(e){e.success&&(t.$refs.childGridTemplate.init(),m["a"].alert("取消成功","success"))}),(function(e){m["a"].alert(e)})))},error:function(e){m["a"].alert(e)}})},doSearch:function(){this.$refs.childGridTemplate.doSearch({like:this.searchValue})},initiateProcess:function(){var e=this;K["a"].http(window.processForUrl.getUrlForFirst(e.processKey),"get","",{success:function(t){var a=t.data.data,s=t.data.data.formKey,i={},r=e.$getFrom("baseForm");r&&-1!=r&&(e.currentView=r,setTimeout((function(){e.$refs.componentForm.modalOpen(s,i,a)}),200))},error:function(e){m["a"].alert(e)}})},getQueryStringArgs:function(e){if(e&&e.length>0){var t=e.length>0?e.substring(1):"",a={},s=t.length?t.split("&"):[],i=null,r=null,n=null,l=0,o=s.length;for(l=0;l<o;l++)i=s[l].split("="),r=decodeURIComponent(i[0]),n=decodeURIComponent(i[1]),r.length&&(a[r]=n);return a}return{}},showResult:function(){var e=this.$refs.childGridTemplate.getSelectedItems();1!=e.length?m["a"].alert("请选择一条数据查看详情"):2===e[0].status.dvalue?(this.isShowResult=!0,this.taskDetail=e[0]):m["a"].alert("只能查看已完成的购置任务")},formComfirmed:function(){this.$refs.childGridTemplate.init()},getClick:function(e,t){this.selectLocation=[],this.selectLocation.push(e),this.deleteIndex=t},addUpload:function(){this.eqpPurchaseTaskModel.documentList.push({document:{}})},removeUpload:function(){var e=this;this.selectLocation.length>0?e.eqpPurchaseTaskModel.documentList.length>0&&e.eqpPurchaseTaskModel.documentList.splice(this.deleteIndex,1):m["a"].alert("选择一个需要删除的位置")}}},Z=X,ee=Object(L["a"])(Z,s,i,!1,null,"52a08878",null);t["default"]=ee.exports},cb9c:function(e,t,a){}}]);