(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-26e158eb"],{"0c10":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-form",{ref:"form1",attrs:{"lazy-validation":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"取消原因",rules:[e.rules.required]},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                            取消原因: "),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.item.cancelReason,callback:function(t){e.$set(e.item,"cancelReason",t)},expression:"item.cancelReason"}})],1)],1)],1)],1)],1)},s=[],n=(a("d5b3"),{name:"CancelTask",data:function(){return{rules:{required:function(e){return!!e||"必填项"}}}},props:["item"],methods:{validate:function(){return 1==this.$refs.form1.validate()},resetValid:function(){this.$refs.form1.resetValidation(),this.$refs.form1.reset()}}}),i=n,o=a("6691"),l=Object(o["a"])(i,r,s,!1,null,"058eafcc",null);t["a"]=l.exports},"10ab":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layContentHeader",{attrs:{title:"备件盘点",buttons:e.headerBtns}},[a("v-text-field",{staticStyle:{width:"260px"},attrs:{label:"输入盘点单编号或负责人","hide-details":"","single-line":"",primary:"",clearable:""},on:{"click:clear":e.clearMessage},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-icon",{on:{click:function(t){return e.doSearch()}}},[e._v("search")])]},proxy:!0}]),model:{value:e.searchfx,callback:function(t){e.searchfx=t},expression:"searchfx"}})],1),a("layContent",[a("dataTable",{ref:"childDataTable",attrs:{headers:e.headers,sort:e.sort,DataSource:e.DataSource,hideOperation:!0,formatFields:e.formatFields,total:e.total},on:{rowDbClick:e.rowDbClick,initialize:e.initTable,changeItems:e.changeItems}}),a("contentModal",{attrs:{title:e.title,IsShow:e.IsShow,width:"1100"},on:{modalClosed:function(t){return e.modalClosed()},modalComfirmed:function(t){return e.modalComfirmed()}}},[a("sparePartsInventoryDetail",{ref:"addOrUpdate",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:e.titleForSee,IsShow:e.IsShowForSee,width:"1100",isDetails:!0},on:{modalClosed:function(t){return e.modalClosedForSee()}}},[a("sparePartsInventorySee",{ref:"See",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:"盘点任务清单",IsShow:e.IsShowForSpare,width:"1100",isSubmit:!0},on:{modalClosed:function(t){return e.modalClosedForSpare()},modalStorageClosed:function(t){return e.modalComfirmedForSpare()},modalSubmit:function(t){return e.modalSubmit()}}},[a("sparePartsInventoryTask",{ref:"addOrUpdateForSpare",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:"盘点结果",IsShow:e.IsShowForSeeResult,width:"1100",isDetails:!0},on:{modalClosed:function(t){return e.modalClosedForSeeResult()}}},[a("sparePartsInventorySeeResult",{ref:"SeeResult",attrs:{item:e.detailForUpdate}})],1),a("contentModal",{attrs:{title:"取消原因",IsShow:e.IsShowCancelTask,width:"1100"},on:{modalComfirmed:function(t){return e.modalComfirmedCancelTask()},modalClosed:function(t){return e.modalClosedCancelTask()}}},[a("CancelTask",{ref:"CancelTask",attrs:{item:e.detailForUpdate}})],1)],1)],1)},s=[],n=(a("4634"),a("e6d1"),a("de90"),a("0c10")),i=a("73e5"),o=a("d5b3"),l=a("8333"),d=a("a2a7"),c=a("f05f"),u=a("681f"),f=a("531b"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs4:""}},[a("v-text-field",{attrs:{label:"盘点单编号",rules:[function(e){return!e||/^[\w|-]+$/.test(e)||"只能是数字,字母,下划线"}]},model:{value:e.item.inventoryCode,callback:function(t){e.$set(e.item,"inventoryCode",t)},expression:"item.inventoryCode"}})],1),a("v-flex",{attrs:{xs4:""}},[a("datePicker",{attrs:{label:"开始日期",required:!0,rules:[function(e){return e&&""!=e||"必填项"},function(t){return!e.item.endDate||new Date(e.item.endDate)>=new Date(e.item.startDate)||"开始时间不能大于结束时间"}]},model:{value:e.item.startDate,callback:function(t){e.$set(e.item,"startDate",t)},expression:"item.startDate"}})],1),a("v-flex",{attrs:{xs4:""}},[a("datePicker",{attrs:{label:"结束日期",required:!0,rules:[function(e){return e&&""!=e||"必填项"},function(t){return new Date(t)>=new Date(e.today)||"结束时间不能小于当前时间"},function(t){return!e.item.startDate||new Date(e.item.endDate)>=new Date(e.item.startDate)||"开始时间不能大于结束时间"}]},model:{value:e.item.endDate,callback:function(t){e.$set(e.item,"endDate",t)},expression:"item.endDate"}})],1),a("v-flex",{attrs:{xs4:""}},[a("selectUser",{ref:"selectUser",attrs:{value:e.item.assignName,required:!0,label:"负责人",multiple:!1,initselect:e.item.userViewModel}})],1),a("v-flex",{attrs:{xs4:""}},[a("v-select",{attrs:{items:e.inventoryTypes,rules:[function(e){return e+="",""!=e||"必填项"}],"return-object":"","item-text":"dname"},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                        盘点类型"),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.item.inventoryType,callback:function(t){e.$set(e.item,"inventoryType",t)},expression:"item.inventoryType"}})],1),a("v-flex",{attrs:{xs4:""}},[a("v-select",{attrs:{items:e.inventoryDimensions,rules:[function(e){return e+="",""!=e||"必填项"}],"return-object":"","item-text":"dname"},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                        盘点维度"),a("span",{staticStyle:{color:"red"}},[e._v("*")])]},proxy:!0}]),model:{value:e.item.inventoryDimension,callback:function(t){e.$set(e.item,"inventoryDimension",t)},expression:"item.inventoryDimension"}})],1),a("v-flex",{attrs:{xs4:""}},[a("selectUser",{ref:"selectUserP",attrs:{value:e.item.inventoryUser,required:!0,label:"盘点人员",multiple:!0,initselect:e.item.inventoryUserList}})],1)],1)],1),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-flex",{attrs:{xs12:""}},[a("span",{staticStyle:{"font-weight":"bold",width:"100%"}},[e._v("上传附件:")]),a("v-icon",{on:{click:function(t){return e.addUpload()}}},[e._v("add")])],1),a("v-flex",{attrs:{xs12:""}},e._l(e.item.documentList,(function(t,r){return a("v-layout",{key:t.id,attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs9:""}},[a("fileUploader",{ref:"uploadFile",refInFor:!0,attrs:{label:"上传附件",multiple:!1,fileNames:t.documentViewModel.dname,uploadBase64:!1,userVersion:t},on:{formData:e.getFormData},model:{value:t.documentViewModel,callback:function(a){e.$set(t,"documentViewModel",a)},expression:"doc.documentViewModel"}})],1),a("v-flex",{attrs:{xs3:""}},[a("v-icon",{on:{click:function(t){return e.deleteItem(r)}}},[e._v("delete")])],1)],1)})),1)],1)],1)],1)],1)},v=[],h=a("1d53"),p=a("1d18"),S=a("2c75"),b=a("a1de"),g=a("6bf2"),y=a.n(g),x=new l["a"](new S["a"]),w={name:"sparePartsInventoryDetail",data:function(){return{today:y()(new Date).format("YYYY-MM-DD"),valid:!0,inventoryTypes:[],inventoryDimensions:[]}},components:{datePicker:h["a"],selectUser:p["a"],fileUploader:b["a"]},created:function(){var e=this;e.$Server.queryAll("Datadict",{},{dname:"备件盘点类型"}).then((function(t){e.inventoryTypes=t.datas}),(function(e){})),e.$Server.queryAll("Datadict",{},{dname:"备件盘点维度"}).then((function(t){e.inventoryDimensions=t.datas}),(function(e){}))},computed:{formatFields:function(){return x.getFormatFields()}},props:["item"],methods:{validate:function(){if(1==this.$refs.form.validate()){var e=this.$refs.selectUser.getselectUserList();e&&e.length>0&&(this.item.assignedUser=this.$refs.selectUser.getselectUserList()[0].id,this.item.assignName=this.$refs.selectUser.getselectUserList()[0].uname);var t=this.$refs.selectUserP.getselectUserList(),a=[],r=[];return console.log(t),t&&t.length>0&&(t.forEach((function(e){var t={};t=e,r.push(t),a.push(e.uname)})),this.item.inventoryUserList=r,this.item.inventoryUser=a.join(",")),!0}return!1},addUpload:function(){this.item.documentList.push({documentViewModel:{}})},getFormData:function(e){},deleteItem:function(e){this.item.documentList.splice(e,1)}}},I=w,D=a("6691"),T=Object(D["a"])(I,m,v,!1,null,"4060b406",null),k=T.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("盘点单编号："+e._s(e.item.inventoryCode))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("开始日期："+e._s(e.item.startDate?e.item.startDate.substring(0,10):""))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("结束日期："+e._s(e.item.endDate?e.item.endDate.substring(0,10):""))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("负责人："+e._s(e.item.assignName))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("盘点类型："+e._s(e.item.inventoryType?e.item.inventoryType.dname:""))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("盘点维度："+e._s(e.item.inventoryDimension?e.item.inventoryDimension.dname:""))])]),a("v-flex",{attrs:{xs6:""}},[a("p",[e._v("盘点人员："+e._s(e.item.inventoryUser))])]),e.item.documentList&&e.item.documentList.length>0?a("v-flex",{attrs:{xs12:""}},[a("span",{staticStyle:{"font-weight":"bold",width:"100%"}},[e._v("上传附件:")])]):e._e(),a("v-flex",{attrs:{xs12:""}},e._l(e.item.documentList,(function(t,r){return e.item.documentList&&e.item.documentList.length>0?a("v-layout",{key:t.id,attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("view-file",{attrs:{documentViewModel:t.documentViewModel}})],1)],1):e._e()})),1),e.item.status&&"已取消"==e.item.status.dname?a("v-flex",{staticStyle:{"margin-top":"15px"},attrs:{xs12:""}},[a("p",[e._v("取消原因："+e._s(e.item.cancelReason))])]):e._e(),e.isShowImage?a("v-flex",{attrs:{xs12:""}},[a("div",[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("任务进度:")])]),a("img",{attrs:{src:e.imageSrc}})]):e._e()],1)],1)],1)},F=[],U=a("551a"),$={name:"sparePartsInventorySee",data:function(){return{imageSrc:"",isShowImage:!1}},watch:{item:{handler:function(e){this.isShowImage=!1,e&&e.status&&0!=e.status.dvalue&&this.seeTaskImage()},deep:!0}},props:["item"],methods:{seeTaskImage:function(){this.seeTrace()},seeTrace:function(){var e=this;U["a"].http(window.processForUrl.getUrlForInstanceId(e.item.id),"get","",{success:function(t){if(t.data&&t.data.data&&t.data.data.id){var a=t.data.data.id;e.seeImage(a)}}})},seeImage:function(e){var t=this;U["a"].http(window.processForUrl.getUrlForInstanceTrace(e),"get",{},{success:function(e){t.imageSrc=e.data.data.image,t.isShowImage=!0}})}}},_=$,O=Object(D["a"])(_,C,F,!1,null,null,null),L=O.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("实际开始日期："+e._s(e.item.actualStartDate?e.item.actualStartDate.substring(0,10):""))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("实际结束日期："+e._s(e.item.actualEndDate?e.item.actualEndDate.substring(0,10):""))])])],1),a("v-layout",[a("v-flex",[a("p",[a("span",{staticStyle:{"font-size":"20px"}},[e._v("盘点报告：")]),e._v(e._s(e.item.inventoryReport))])])],1),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("div",{staticStyle:{"font-size":"20px"}},[e._v("盘点结果统计： "),a("v-btn",{attrs:{depressed:"",small:"",color:"primary"},on:{click:function(t){return e.changeType(0)}}},[e._v("查看全部")]),a("v-btn",{attrs:{depressed:"",small:"",color:"primary"},on:{click:function(t){return e.changeType(1)}}},[e._v("只查看盈亏")])],1),a("div",{staticStyle:{"min-height":"340px"}},[a("localDataTable",{attrs:{headers:e.headers,formatFields:e.formatFields,hideHeaders:!1,sort:!1,items:e.getItems,allowActive:!1,hideOperation:!0,total:e.totalcount}})],1),a("div",{staticStyle:{"font-size":"20px"}},[e._v("盈亏结果详情： ")]),a("div",{staticStyle:{"min-height":"340px"}},[a("localDataTable",{attrs:{headers:e.detailheaders,formatFields:e.formatFields,hideHeaders:!1,sort:!0,items:e.getItemsForDetail,allowActive:!1,hideOperation:!0,total:e.totaldetail}})],1)])],1)],1)],1)},N=[],P=a("f855"),V=new l["a"](new S["a"]),R={name:"sparePartsInventorySee",data:function(){return{totalcount:0,totaldetail:0,dataSource:[],dataSource1:[],dataSourceForWon:[],sourceType:0,headers:[{text:"备件编号",value:"code",align:"center",sortable:!1},{text:"备件名称",value:"name",align:"center",sortable:!1},{text:"规格型号",value:"model",align:"center",sortable:!1},{text:"库存量",value:"inventory",align:"center",sortable:!1},{text:"实际数量",value:"actualInventory",align:"center",sortable:!1},{text:"盈亏数量",value:"differenceCountStr",align:"center",sortable:!1}],detailheaders:[{text:"序号",align:"center",sortable:!1},{text:"备件编号",value:"code",align:"center",sortable:!1},{text:"备件名称",value:"name",align:"center",sortable:!1},{text:"规格型号",value:"model",align:"center",sortable:!1},{text:"类型",value:"type.dname",align:"center",sortable:!1},{text:"备件位置",value:"positionNames",align:"center",sortable:!1},{text:"原库存量",value:"inventorys",align:"center",sortable:!1},{text:"现库存量",value:"actualInventorys",align:"center",sortable:!1},{text:"盈亏数量",value:"differenceCountStr",align:"center",sortable:!1}]}},components:{localDataTable:P["a"]},watch:{item:{handler:function(e,t){var a=this;a.sourceType=0,e.id&&a.$Server.queryObjectById("SpInventoryResult",e.id).then((function(e){a.dataSource=e.data.data.sparePartsList,a.dataSource1=JSON.parse(JSON.stringify(e.data.data.sparePartsList)),a.dataSource&&(a.dataSource1.forEach((function(e){e.differenceCount<0?e.differenceCountStr='<span style="color:red">'+e.differenceCount+"</span>":e.differenceCount>0?e.differenceCountStr='<span style="color:#83d944">'+e.differenceCount+"</span>":e.differenceCountStr=e.differenceCount})),a.dataSource=a.setSource(a.dataSource))}),(function(e){}))},deep:!0}},computed:{getItemsForDetail:function(){var e=this;return 1==e.sourceType?e.dataSource.filter((function(e){return 0!==e.differenceCount&&null!==e.differenceCount})):e.dataSource},getItems:function(){var e=this,t=[];return 1==e.sourceType?(t=e.dataSource1.filter((function(e){return 0!==e.differenceCount&&null!==e.differenceCount})),e.totalcount=t.length,t):(e.totalcount=e.dataSource.length,e.dataSource1)},formatFields:function(){return V.getFormatFields()}},props:["item"],methods:{changeType:function(e){this.sourceType=e},setSource:function(e){var t=this;t.dataSourceForWon=[];for(var a=0;a<e.length;a++){var r=[],s=[],n=[],i=[],o=[];if(null!=e[a].differenceCount&&0!=e[a].differenceCount&&t.dataSourceForWon.push(e[a]),e[a].recordList)for(var l=0;l<e[a].recordList.length;l++)e[a].recordList[l].positionViewModel&&(r.push(e[a].recordList[l].positionViewModel.positionName),s.push(e[a].recordList[l].actualInventory-e[a].recordList[l].differenceCount)),n.push(e[a].recordList[l].actualInventory?e[a].recordList[l].actualInventory:0),i.push(e[a].recordList[l].differenceCount?e[a].recordList[l].differenceCount:0),e[a].recordList[l].differenceCount<0?o.push('<div style="color:red;">'+e[a].recordList[l].differenceCount+"</div>"):e[a].recordList[l].differenceCount>0?o.push('<div style="color:#83d944;">'+e[a].recordList[l].differenceCount+"</div>"):o.push(e[a].recordList[l].differenceCount);e[a].positionNames=r,e[a].inventorys=s,e[a].actualInventorys=n,e[a].differenceCounts=i,e[a].differenceCountStr=o}return e}}},A=R,J=Object(D["a"])(A,M,N,!1,null,"48f0ea21",null),E=J.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("盘点单编号："+e._s(e.item.inventoryCode))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("开始日期："+e._s(e.item.startDate?e.item.startDate.substring(0,10):""))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("结束日期："+e._s(e.item.endDate?e.item.endDate.substring(0,10):""))])]),a("v-flex",{attrs:{xs3:""}},[a("p",[e._v("负责人："+e._s(e.item.assignName))])]),a("v-flex",{attrs:{xs12:""}},[a("v-btn",{staticStyle:{margin:"0px"},attrs:{depressed:"",small:"",color:"primary"},on:{click:function(t){return e.print()}}},[e._v("打印盘点清单")])],1)],1),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("div",[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("mergeTable",{ref:"childDataTable",attrs:{fieldName:"positionViewModel.positionName",headers:e.merheaders,hideHeaders:!1,sort:!1,items:e.getItems,allowActive:!1,hideOperation:!0}})],1)],1)])],1)],1)],1)},q=[],B=a("52d6"),z={name:"sparePartsInventoryTask",data:function(){return{valid:!0,merheaders:[{text:"备件位置",value:"positionViewModel.positionName",align:"center",sortable:!1},{text:"备件编号",value:"positionViewModel.code",align:"center",sortable:!1},{text:"备件名称",value:"positionViewModel.name",align:"center",sortable:!1},{text:"规格型号",value:"positionViewModel.model",align:"center",sortable:!1},{text:"库存量",value:"positionViewModel.inventory",align:"center",sortable:!1},{text:"实际数量",value:"actualInventory",align:"center",sortable:!1,fieldType:"numberField",inlineEdit:!0,required:!0}]}},computed:{getItems:function(){var e=[];return this.item&&this.item.subTaskList&&this.item.subTaskList.length>0&&(e=this.item.subTaskList[0].recordList?this.item.subTaskList[0].recordList:[]),e}},components:{mergeTable:B["a"]},props:["item"],methods:{validate:function(){return 1==this.$refs.form.validate()},print:function(){var e=this;window.open("/#/sparePartsInventoryPrint?id="+e.item.id,"_blank")}}},H=z,W=(a("3bba"),Object(D["a"])(H,j,q,!1,null,"067d3475",null)),Y=W.exports,G=new l["a"](new i["a"]),Q={name:"sparePartsInventory",data:function(){var e=this;return{initObject:{id:"",inventoryCode:"",startDate:"",endDate:"",assignedUser:"",assignName:"",inventoryUser:"",userViewModel:[],inventoryType:"",inventoryDimension:"",documentList:[],inventoryUserList:[]},IsShowCancelTask:!1,searchfx:"",sort:!0,total:1,DataSource:[],title:"",IsShow:!1,IsAddOp:!0,detailForUpdate:{},IsShowForSee:!1,titleForSee:"",btnexecute:!this.$per("SparePartsInventory","exe"),btninventory:!this.$per("SparePartsInventory","c"),headerBtns:[{disabled:!this.$per("SparePartsInventory","c"),text:"添加",icon:"self_add",click:function(){return e.tableAdd()}},{disabled:!this.$per("SparePartsInventory","u"),text:"编辑",icon:"self_edit",click:function(){return e.tableEdit()}},{disabled:!this.$per("SparePartsInventory","d"),text:"删除",icon:"self_delete",click:function(){return e.tableDelete()}},{disabled:this.btnexecute,text:"执行",icon:"self_execute",click:function(){return e.excuteTask()}},{disabled:this.btninventory,text:"盘点",icon:"self_execute",click:function(){return e.spareTask()}},{disabled:!this.$per("SparePartsInventory","cancel"),text:"取消",icon:"self_cancel",click:function(){return e.cancelTask()}},{disabled:!this.$per("SparePartsInventory","c"),text:"查看结果",icon:"self_look",click:function(){return e.showResult()}}],IsShowForSeeResult:!1,IsShowForSpare:!1}},computed:{headers:function(){var e=G.formatGridHeader();return!0===this.sort&&e.unshift({text:"序号",align:"center",sortable:!1}),e},formatFields:function(){return G.getFormatFields()}},components:{contentModal:d["a"],dataTable:c["a"],sparePartsInventoryDetail:k,sparePartsInventorySee:L,sparePartsInventorySeeResult:E,sparePartsInventoryTask:Y,CancelTask:n["a"]},mounted:function(){},methods:{changeItems:function(e){e&&1==e.length?0==e[0].status.dvalue?(this.headerBtns[3].disabled=this.btnexecute||!1,this.headerBtns[4].disabled=!0):1==e[0].status.dvalue?(this.headerBtns[3].disabled=!0,this.headerBtns[4].disabled=this.btninventory||!1):(this.headerBtns[3].disabled=this.btnexecute||!1,this.headerBtns[4].disabled=this.btninventory||!1):(this.headerBtns[3].disabled=this.btnexecute||!1,this.headerBtns[4].disabled=this.btninventory||!1)},modalClosedForSeeResult:function(){this.IsShowForSeeResult=!1},showResult:function(){var e=this;if(1!=e.$refs.childDataTable.getCheckItems().length)o["a"].alert("请选择一项作为你查看的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0];"按时完成"==t.status.dname||"超期完成"==t.status.dname?(e.detailForUpdate=JSON.parse(JSON.stringify(t)),e.IsShowForSeeResult=!0):o["a"].alert("只有对已完成的盘点任务才能查看！")}},modalComfirmedCancelTask:function(){var e=this;1==e.$refs.CancelTask.validate()?(e.cofirmCancel(e.detailForUpdate),e.IsShowCancelTask=!1):o["a"].alert("验证错误")},modalClosedCancelTask:function(){var e=this;e.IsShowCancelTask=!1},cancelTask:function(){var e=this;1!=e.$refs.childDataTable.getCheckItems().length?o["a"].alert("请选择一项作为你取消的对象"):"进行中"==e.$refs.childDataTable.getCheckItems()[0].status.dname?e.$refs.childDataTable.getCheckItems()[0].assignedUser!==sessionStorage.getItem("userId")?o["a"].alert("您不是该任务的负责人，不能取消"):(e.detailForUpdate=JSON.parse(JSON.stringify(e.$refs.childDataTable.getCheckItems()[0])),e.$refs.CancelTask.resetValid(),e.IsShowCancelTask=!0):o["a"].alert("只有对进行中的盘点任务才能取消！")},cofirmCancel:function(e){var t=this;f["a"].http(window.processForUrl.getUrlForInstanceId(e.id),"get","",{success:function(a){a.data&&a.data.data&&a.data.data.id?f["a"].http(window.processForUrl.getUrlForInstance(a.data.data.id),"Delete","",{success:function(a){e.status.dvalue=4,t.$Server.addOrUpdate(G.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),o["a"].alert("取消成功","success"))}),(function(e){o["a"].alert(e)}))},error:function(e){o["a"].alert(e)}}):(e.status.dvalue=4,t.$Server.addOrUpdate(G.getModelName(),e,!0).then((function(e){e.success&&(t.initTable(),o["a"].alert("取消成功","success"))}),(function(e){o["a"].alert(e)})))},error:function(e){o["a"].alert(e)}})},getQueryStringArgs:function(e){if(e&&e.length>0){var t=e.length>0?e.substring(1):"",a={},r=t.length?t.split("&"):[],s=null,n=null,i=null,o=0,l=r.length;for(o=0;o<l;o++)s=r[o].split("="),n=decodeURIComponent(s[0]),i=decodeURIComponent(s[1]),n.length&&(a[n]=i);return a}return{}},excuteTask:function(){var e=this;if(1!=e.$refs.childDataTable.getCheckItems().length)o["a"].alert("请选择一项作为你执行的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0],a=sessionStorage.getItem("userId");"未开始"==t.status.dname?a==t.assignedUser?(t.isExcute=!0,t.status.dvalue=1,e.$Server.addOrUpdate(G.getModelName(),t,!0).then((function(t){t.success&&(e.IsShow=!1,e.initTable(),o["a"].alert("执行成功","success"))}),(function(e){o["a"].alert(e)}))):o["a"].alert("这条任务的负责人不是你！"):o["a"].alert("只有对未开始的盘点任务才能执行！")}},modalClosedForSpare:function(){this.IsShowForSpare=!1},modalSubmit:function(){var e=this;1==e.$refs.addOrUpdateForSpare.validate()&&(e.detailForUpdate.subTaskList[0].status=2,e.$Server.addOrUpdate("SpInventorySubTask",e.detailForUpdate.subTaskList[0],!e.IsAddOp).then((function(t){t.success&&(e.IsShowForSpare=!1,e.initTable(),o["a"].alert("提交成功","success"))}),(function(e){o["a"].alert(e)})))},modalComfirmedForSpare:function(){var e=this;1==e.$refs.addOrUpdateForSpare.validate()&&e.$Server.addOrUpdate("SpInventorySubTask",e.detailForUpdate.subTaskList[0],!e.IsAddOp).then((function(t){t.success&&(e.IsShowForSpare=!1,e.initTable(),o["a"].alert("保存成功","success"))}),(function(e){o["a"].alert(e)}))},spareTask:function(){var e=this;e.resetFormValidation(),1!=e.$refs.childDataTable.getCheckItems().length?o["a"].alert("请选择一项作为你盘点的对象"):"进行中"==e.$refs.childDataTable.getCheckItems()[0].status.dname?e.$Server.queryObjectById(G.getModelName(),e.$refs.childDataTable.getCheckItems()[0].id).then((function(t){var a=t.data.data;a.subTaskList&&a.subTaskList.length>0?0==a.subTaskList[0].status||1==a.subTaskList[0].status?(e.IsAddOp=!1,e.title="盘点任务清单",e.detailForUpdate=JSON.parse(JSON.stringify(a)),e.IsShowForSpare=!0):o["a"].alert("你已经盘点完了此任务！"):o["a"].alert("这条任务的盘点人不是你！")}),(function(e){o["a"].alert(e)})):o["a"].alert("只有对进行中的盘点任务才能盘点！")},tableAdd:function(){this.resetForm(),this.IsAddOp=!0,this.detailForUpdate=JSON.parse(JSON.stringify(this.initObject)),this.title="添加盘点任务",this.IsShow=!0},tableEdit:function(){var e=this;if(e.resetFormValidation(),e.IsAddOp=!1,e.title="编辑盘点任务",1!=e.$refs.childDataTable.getCheckItems().length)o["a"].alert("请选择一项作为你修改的对象");else{var t=e.$refs.childDataTable.getCheckItems()[0];null==t.documentList&&(t.documentList=[]),"未开始"==t.status.dname?(e.detailForUpdate=JSON.parse(JSON.stringify(t)),e.detailForUpdate.userViewModel&&(e.detailForUpdate.userViewModel=[e.detailForUpdate.userViewModel]),e.IsShow=!0):o["a"].alert("只有对未开始的盘点任务才能编辑！")}},doSearch:function(){var e=this.$refs.childDataTable.getPagination();1==e.page?this.initTable(e):this.$refs.childDataTable.setPage(1)},clearMessage:function(){this.searchfx="",this.doSearch()},initTable:function(e){var t=this;e&&e.page||(e=this.$refs.childDataTable.getPagination()),t.$Server.queryAll(G.getModelName(),{page:e.page,rowsPerPage:e.rowsPerPage},{searchfx:t.searchfx}).then((function(e){t.$refs.childDataTable.unCheckItems(),t.DataSource=e.datas,t.total=e.page.total,t.DataSource&&t.DataSource.length>0&&t.DataSource.forEach((function(e){e.status&&e.status.dname&&("未开始"==e.status.dname||"已取消"==e.status.dname)?e.statusName=t.$Utils.setStart(e.status.dname):e.status&&e.status.dname&&"进行中"==e.status.dname?e.statusName=t.$Utils.setRed(e.status.dname):e.status&&e.status.dname&&"按时完成"==e.status.dname?e.statusName=t.$Utils.setSuccess(e.status.dname):e.status&&e.status.dname&&"超期完成"==e.status.dname&&(e.statusName=t.$Utils.setWarn(e.status.dname))}))}),(function(e){}))},rowDbClick:function(e){var t=this;t.detailForUpdate=JSON.parse(JSON.stringify(e)),t.titleForSee="查看任务详情",t.IsShowForSee=!0},modalComfirmed:function(){var e=this;if(1==e.$refs.addOrUpdate.validate()){if(e.detailForUpdate.userViewModel&&(e.detailForUpdate.userViewModel=e.detailForUpdate.userViewModel[0]),e.detailForUpdate.inventoryDimension&&0!==e.detailForUpdate.inventoryDimension.dvalue)return void e.$Server.queryAll("SystemConfig",null,{inventoryDimension:e.detailForUpdate.inventoryDimension}).then((function(t){var a=t.datas;2===a.length?a[1].systemValue>a[0].systemValue?u["a"].confirm("该备件已盘点完成,确定再次盘点?","提示",500,(function(){e.$Server.addOrUpdate(G.getModelName(),e.detailForUpdate,!e.IsAddOp).then((function(t){t.success&&(e.IsShow=!1,e.initTable(),o["a"].alert("保存成功","success"))}),(function(e){o["a"].alert(e)}))}),(function(){})):e.$Server.addOrUpdate(G.getModelName(),e.detailForUpdate,!e.IsAddOp).then((function(t){t.success&&(e.IsShow=!1,e.initTable(),o["a"].alert("保存成功","success"))}),(function(e){o["a"].alert(e)})):o["a"].alert("无法获取该类备件盘点次数")})).catch(o["a"].alert);e.$Server.addOrUpdate(G.getModelName(),e.detailForUpdate,!e.IsAddOp).then((function(t){t.success&&(e.IsShow=!1,e.initTable(),o["a"].alert("保存成功","success"))}),(function(e){o["a"].alert(e)}))}},modalClosed:function(){this.IsShow=!1},resetFormValidation:function(){this.$refs.addOrUpdate.$refs.form.resetValidation(),this.$refs.addOrUpdateForSpare.$refs.form.resetValidation()},resetForm:function(){this.$refs.addOrUpdate.$refs.form.reset(),this.$refs.addOrUpdate.$refs.form.resetValidation(),this.$refs.addOrUpdateForSpare.$refs.form.reset(),this.$refs.addOrUpdateForSpare.$refs.form.resetValidation()},modalClosedForSee:function(){this.IsShowForSee=!1},cofirmDelete:function(){var e=this,t=this.$refs.childDataTable.getCheckItems();e.$Server.batchDelete(G.getModelName(),t).then((function(){e.initTable()}),(function(e){o["a"].alert(e)}))},tableDelete:function(){var e=this;if(e.$refs.childDataTable.getCheckItems().length<=0)o["a"].alert("请选中需要删除的对象");else{for(var t=!0,a=0;a<e.$refs.childDataTable.getCheckItems().length;a++)if("未开始"!=e.$refs.childDataTable.getCheckItems()[a].status.dname){t=!1;break}t?u["a"].confirm("确定删除所选备件盘点?","提示",500,(function(){e.cofirmDelete()}),(function(){})):o["a"].alert("只有对未开始的盘点任务才能删除！")}}}},K=Q,X=Object(D["a"])(K,r,s,!1,null,null,null);t["default"]=X.exports},"3bba":function(e,t,a){"use strict";var r=a("8e26"),s=a.n(r);s.a},"8e26":function(e,t,a){}}]);